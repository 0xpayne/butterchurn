!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("butterchurn",[],e):"object"==typeof exports?exports.butterchurn=e():t.butterchurn=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=35)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}},function(t,e,i){var s=i(30),r=i(31),a=i(32),o=i(33);t.exports=function(t){return s(t)||r(t)||a(t)||o()}},function(t,e,i){t.exports=i(20)},function(t,e,i){"use strict";var s=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t};e.__esModule=!0,e.arrayJoin=function(t,e){for(var i=[],s=0;s<t.length;s++){i.push(t[s]),s===t.length-1||i.push(e)}return i},e.flatten=function(t){var e=[];return t.forEach((function(t){e.push.apply(e,r(t))})),e},e.flattenTwice=function(t){return[].concat.apply([],t)},e.times=function(t,e){return new Array(t).fill(null).map((function(t,i){return e(i)}))},e.repeat=function(t,e){return new Array(t).fill(e).join("")};var a=function(){function t(){this._list=[]}return t.prototype.get=function(t,e){var i=this._list.findIndex((function(i){var r=s(i,2),a=r[0],o=r[1];return a===t&&o===e}));return-1===i?(this._list.push([t,e]),this._list.length-1):i},t.prototype.size=function(){return this._list.length},t}();e.ScopedIdMap=a,e.formatList=function(t){if(0===t.length)throw new Error("Cannot format an empty list");if(1===t.length)return t[0];var e=t.map((function(t){return'"'+t+'"'})),i=e.pop();return e.join(", ")+" and "+i}},function(t,e,i){"use strict";e.__esModule=!0;var s={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,atan2:Math.atan2,rand:function(t){return Math.random()*t},pow:Math.pow,log:Math.log,log10:Math.log10,exp:Math.exp,sigmoid:function(t,e){var i=1+Math.exp(-t*e);return Math.abs(i)>1e-5?1/i:0}};e.default=s},function(t,e,i){"use strict";var s=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t},a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};e.__esModule=!0;var o=a(i(28)),n=i(4);function h(t){var e=new Uint8Array(8);return o.write(e,t),e}function A(t){var e=[];do{var i=127&t;0!==(t>>>=7)&&(i|=128),e.push(i)}while(0!==t);return e}function l(t){for(var e=[],i=0,s=Math.ceil(Math.log2(Math.abs(t))),r=t<0,a=!0;a;)i=127&t,t>>=7,r&&(t|=-(1<<s-7)),0==t&&0==(64&i)||-1==t&&64==(64&i)?a=!1:i|=128,e.push(i);return e}e.MAGIC=[0,97,115,109],e.WASM_VERSION=[1,0,0,0],e.EPSILON=1e-5,e.SECTION={TYPE:1,IMPORT:2,FUNC:3,MEMORY:5,GLOBAL:6,EXPORT:7,CODE:10},e.EXPORT_TYPE={FUNC:0,TABLE:1,MEMORY:2,GLOBAL:3},e.op={block:function(t){return[2,t]},loop:function(t){return[3,t]},if:function(t){return[4,t]},else:5,end:11,br_if:function(t){return r([13],A(t))},call:function(t){return r([16],A(t))},drop:26,select:27,local_get:function(t){return r([32],A(t))},local_set:function(t){return r([33],A(t))},local_tee:function(t){return r([34],A(t))},global_get:function(t){return r([35],A(t))},global_set:function(t){return r([36],A(t))},f64_load:function(t,e){return r([43],A(t),A(e))},f64_store:function(t,e){return r([57],A(t),A(e))},i32_const:function(t){return r([65],l(t))},f64_const:function(t){return r([68],h(t))},i32_eqz:69,i32_ne:71,i32_lt_s:72,i32_lt_u:73,i32_gt_s:74,i32_le_s:76,i32_le_u:77,i32_ge_s:78,f64_eq:97,f64_ne:98,f64_lt:99,f64_gt:100,f64_le:101,f64_ge:102,i32_add:106,i32_sub:107,i32_mul:108,i32_and:113,i32_or:114,i64_rem_s:129,i64_and:131,i64_or:132,f64_abs:153,f64_neg:154,f64_ceil:155,f64_floor:156,f64_sqrt:159,f64_add:160,f64_sub:161,f64_mul:162,f64_div:163,f64_min:164,f64_max:165,i32_trunc_f64_s:170,i64_trunc_s_f64:176,f64_convert_i64_s:185,f64_convert_i32_s:183},e.VAL_TYPE={i32:127,i64:126,f32:125,f64:124},e.MUTABILITY={const:0,var:1},e.BLOCK={void:64,i32:127,i64:126,f32:125,f64:124},e.FUNCTION_TYPE=96,e.MEMORY_IDX=2,e.GLOBAL_TYPE=3,e.TYPE_IDX=0,e.IS_ZEROISH=r([e.op.f64_abs],e.op.f64_const(e.EPSILON),[e.op.f64_lt]),e.IS_NOT_ZEROISH=r([e.op.f64_abs],e.op.f64_const(e.EPSILON),[e.op.f64_gt]),e.encodef64=h,e.encodeString=function(t){return r([t.length],t.split("").map((function(t){return t.charCodeAt(0)})))},e.unsignedLEB128=A,e.signedLEB128=l,e.encodeVector=function(t){return r(A(t.length),n.flattenTwice(t))},e.encodeSection=function(t,i){return 0===i.length?[]:r([t],e.encodeVector(e.encodeVector(i)))}},function(t,e,i){"use strict";e.__esModule=!0;e.MAX_LOOP_COUNT=1048576,e.BUFFER_SIZE=8388608,e.WASM_MEMORY_SIZE=Math.ceil(8*e.BUFFER_SIZE*2/65536)},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e){function i(t,e,i,s,r,a,o){try{var n=t[a](o),h=n.value}catch(t){return void i(t)}n.done?e(h):Promise.resolve(h).then(s,r)}t.exports=function(t){return function(){var e=this,s=arguments;return new Promise((function(r,a){var o=t.apply(e,s);function n(t){i(o,r,a,n,h,"next",t)}function h(t){i(o,r,a,n,h,"throw",t)}n(void 0)}))}}},function(t,e,i){var s;void 0===(s=function(){return{baseVals:{gammaadj:1.25,wave_g:.5,mv_x:12,warpscale:1,brighten:0,mv_y:9,wave_scale:1,echo_alpha:0,additivewave:0,sx:1,sy:1,warp:.01,red_blue:0,wave_mode:0,wave_brighten:0,wrap:0,zoomexp:1,fshader:0,wave_r:.5,echo_zoom:1,wave_smoothing:.75,warpanimspeed:1,wave_dots:0,wave_x:.5,wave_y:.5,zoom:1,solarize:0,modwavealphabyvolume:0,dx:0,cx:.5,dy:0,darken_center:0,cy:.5,invert:0,bmotionvectorson:0,rot:0,modwavealphaend:.95,wave_mystery:-.2,decay:.9,wave_a:1,wave_b:.5,rating:5,modwavealphastart:.75,darken:0,echo_orient:0,ib_r:.5,ib_g:.5,ib_b:.5,ib_a:0,ib_size:0,ob_r:.5,ob_g:.5,ob_b:.5,ob_a:0,ob_size:0,mv_dx:0,mv_dy:0,mv_a:0,mv_r:.5,mv_g:.5,mv_b:.5,mv_l:0},init_eqs:function(){return{}},frame_eqs:function(t){return t.rkeys=["warp"],t.zoom=1.01+.02*t.treb_att,t.warp=.15+.25*t.bass_att,t},pixel_eqs:function(t){return t.warp=t.warp+.15*t.rad,t},waves:[{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t},point_eqs:""},{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t},point_eqs:""},{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t},point_eqs:""},{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t},point_eqs:""}],shapes:[{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t}},{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t}},{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t}},{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(t){return t.rkeys=[],t},frame_eqs:function(t){return t}}],warp:"shader_body {\nret = texture2D(sampler_main, uv).rgb;\nret -= 0.004;\n}\n",comp:"shader_body {\nret = texture2D(sampler_main, uv).rgb;\nret *= hue_shader;\n}\n"}}.apply(e,[]))||(t.exports=s)},function(t,e,i){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o};e.__esModule=!0;var a=i(21),o=i(22),n=i(26),h=i(12);function A(t,e){var i=a.getLoc(e,t.first_column),s=a.getLoc(e,t.last_column);return{first_column:i.column,last_column:s.column,first_line:i.line,last_line:s.line}}e.parse=function(t){var e=r(a.preProcess(t),2),i=e[0],l=e[1];try{var c=o.parse(i);return n.mapAst(c,(function(e){if(1!==e.loc.first_line||1!=e.loc.last_line)throw h.createCompilerError("Unexpected multiline",e.loc,t);return s(s({},e),{loc:A(e.loc,l)})}))}catch(e){if(null==e.hash)throw e;throw h.createUserError("Parse Error: "+e.message.split("\n")[3],A(e.hash.loc,l),t)}}},function(t,e,i){"use strict";var s,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var a=i(4);function o(t,e,i){void 0===i&&(i=1);var s=Math.max(t.first_line-1-i,0),r=t.last_line+i,o=e.split("\n").slice(s,r).map((function(e,i){var r=i+s+1;return(r>=t.first_line&&r<=t.last_line?">":" ")+" "+r+" | "+e}));if(t.first_line===t.last_line){var n=a.repeat(t.first_column," "),h=a.repeat(t.last_column-t.first_column,"^"),A=t.first_line-s;o.splice(A,0,"    | "+n+h)}return o.join("\n")}e.printLoc=o;var n=function(t){function e(e,i,s){var r=t.call(this,e)||this;return r.sourceContext=o(i,s),r.loc=i,r}return r(e,t),e}(Error),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(n);e.createUserError=function(t,e,i){return new h(t,e,i)},e.createCompilerError=function(t,e,i){return new n(t,e,i)}},function(t,e,i){"use strict";var s=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};e.__esModule=!0;var n=i(11),h=i(27),A=i(6),l=a(i(5)),c=o(i(4)),u=i(14),g=i(7);e.compileModule=function(t){var e=t.pools,i=t.functions,a=t.eelVersion,o=void 0===a?2:a,m=t.preParsed,f=void 0!==m&&m;if(Object.keys(e).includes("shims"))throw new Error('You may not name a pool "shims". "shims" is reserved for injected JavaScript functions.');var p=[];Object.entries(e).forEach((function(t){var e=s(t,2),i=e[0];e[1].forEach((function(t){p.push([i,t])}))}));var d=new c.ScopedIdMap;p.forEach((function(t){var e=s(t,2),i=e[0],r=e[1];d.get(i,r)}));var v=Object.entries(l.default).map((function(t){var e=s(t,2),i=e[0],r=e[1];return{args:new Array(r.length).fill(null).map((function(t){return A.VAL_TYPE.f64})),returns:[A.VAL_TYPE.f64],name:i}})),_=[],E=[];Object.entries(i).forEach((function(t){var i=s(t,2),a=i[0],l=i[1],g=l.pool,m=l.code;if(null==e[g]){var p=Object.keys(e);if(0===p.length)throw new Error('The function "'+a+'" was declared as using a variable pool named "'+g+'" but no pools were defined.');throw new Error('The function "'+a+'" was declared as using a variable pool named "'+g+'" which is not among the variable pools defined. The defined variable pools are: '+c.formatList(p)+".")}var b=f?m:n.parse(m);if("string"==typeof b)throw new Error("Got passed unparsed code without setting the preParsed flag");if("SCRIPT"!==b.type)throw new Error("Invalid AST");if(0!==b.body.length){var x=[],y={resolveVar:function(t){return/^reg\d\d$/.test(t)?d.get(null,t):d.get(g,t)},resolveLocal:function(t){return x.push(t),x.length-1},resolveFunc:function(t){var e=v.findIndex((function(e){return e.name===t}));if(-1!==e){var i=A.op.call(e);return"rand"===t&&1===o?r(i,[A.op.f64_floor]):i}if(null==u.localFuncMap[t])return null;var s=_.indexOf(t);return-1===s&&(_.push(t),s=_.length-1),A.op.call(s+v.length)},rawSource:m},T=h.emit(b,y);E.push({binary:T,exportName:a,args:[],returns:[],localVariables:x})}}));var b=_.map((function(t){var e=u.localFuncMap[t];if(null==e)throw new Error('Undefined local function "'+t+'"');return e})),x=function(t){return r(t.args,["|"],t.returns).join("-")},y=[],T=new Map;function w(t){var e=x(t),i=T.get(e);if(null==i)throw new Error("Failed to get a type index for key "+e);return i}r(v,b,E).forEach((function(t){var e=x(t);T.has(e)||(y.push(r([A.FUNCTION_TYPE],A.encodeVector(t.args),A.encodeVector(t.returns))),T.set(e,y.length-1))}));var S=r(p.map((function(t){var e=s(t,2),i=e[0],a=e[1];return r(A.encodeString(i),A.encodeString(a),[A.GLOBAL_TYPE,A.VAL_TYPE.f64,A.MUTABILITY.var])})),v.map((function(t,e){var i=w(t);return r(A.encodeString("shims"),A.encodeString(t.name),r([A.TYPE_IDX],A.unsignedLEB128(i)))}))),P=r(b,E).map((function(t){var e=w(t);return A.unsignedLEB128(e)})),I=[r([1],A.unsignedLEB128(g.WASM_MEMORY_SIZE),A.unsignedLEB128(g.WASM_MEMORY_SIZE))],R=d.size()-p.length,B=c.times(R,(function(){return r([A.VAL_TYPE.f64,A.MUTABILITY.var],A.op.f64_const(0),[A.op.end])})),L=r(E).map((function(t,e){var i=e+v.length+b.length;return r(A.encodeString(t.exportName),[A.EXPORT_TYPE.FUNC],A.unsignedLEB128(i))})),C=r(b,E).map((function(t){var e,i=(null!==(e=t.localVariables)&&void 0!==e?e:[]).map((function(t){return r(A.unsignedLEB128(1),[t])}));return A.encodeVector(r(A.encodeVector(i),t.binary,[A.op.end]))}));return new Uint8Array(r(A.MAGIC,A.WASM_VERSION,A.encodeSection(A.SECTION.TYPE,y),A.encodeSection(A.SECTION.IMPORT,S),A.encodeSection(A.SECTION.FUNC,P),A.encodeSection(A.SECTION.MEMORY,I),A.encodeSection(A.SECTION.GLOBAL,B),A.encodeSection(A.SECTION.EXPORT,L),A.encodeSection(A.SECTION.CODE,C)))}},function(t,e,i){"use strict";var s=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t};e.__esModule=!0;var a=i(6),o=i(7);e.localFuncMap={sqr:{args:[a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.local_get(0),a.op.local_get(0),[a.op.f64_mul])},bor:{args:[a.VAL_TYPE.f64,a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.local_get(0),a.IS_NOT_ZEROISH,a.op.local_get(1),a.IS_NOT_ZEROISH,[a.op.i32_or],a.op.i32_const(0),[a.op.i32_ne,a.op.f64_convert_i32_s])},band:{args:[a.VAL_TYPE.f64,a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.local_get(0),a.IS_NOT_ZEROISH,a.op.local_get(1),a.IS_NOT_ZEROISH,[a.op.i32_and],a.op.i32_const(0),[a.op.i32_ne,a.op.f64_convert_i32_s])},sign:{args:[a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.f64_const(0),a.op.local_get(0),[a.op.f64_lt],a.op.local_get(0),a.op.f64_const(0),[a.op.f64_lt,a.op.i32_sub,a.op.f64_convert_i32_s])},mod:{args:[a.VAL_TYPE.f64,a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.local_get(1),a.op.f64_const(0),[a.op.f64_ne],a.op.if(a.BLOCK.f64),a.op.local_get(0),[a.op.i64_trunc_s_f64],a.op.local_get(1),[a.op.i64_trunc_s_f64,a.op.i64_rem_s,a.op.f64_convert_i64_s,a.op.else],a.op.f64_const(0),[a.op.end])},bitwiseOr:{args:[a.VAL_TYPE.f64,a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.local_get(0),[a.op.i64_trunc_s_f64],a.op.local_get(1),[a.op.i64_trunc_s_f64,a.op.i64_or,a.op.f64_convert_i64_s])},bitwiseAnd:{args:[a.VAL_TYPE.f64,a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],binary:r(a.op.local_get(0),[a.op.i64_trunc_s_f64],a.op.local_get(1),[a.op.i64_trunc_s_f64,a.op.i64_and,a.op.f64_convert_i64_s])},div:{args:[a.VAL_TYPE.f64,a.VAL_TYPE.f64],returns:[a.VAL_TYPE.f64],localVariables:[a.VAL_TYPE.i32],binary:r(a.op.local_get(1),a.op.f64_const(0),[a.op.f64_ne],a.op.if(a.BLOCK.f64),a.op.local_get(0),a.op.local_get(1),[a.op.f64_div,a.op.else],a.op.f64_const(0),[a.op.end])},_getBufferIndex:{args:[a.VAL_TYPE.f64],returns:[a.VAL_TYPE.i32],localVariables:[a.VAL_TYPE.f64,a.VAL_TYPE.i32],binary:r(a.op.f64_const(a.EPSILON),a.op.local_get(0),[a.op.f64_add],a.op.local_tee(1),[a.op.i32_trunc_f64_s],a.op.local_set(2),a.op.i32_const(-1),a.op.local_get(2),a.op.i32_const(8),[a.op.i32_mul],a.op.local_get(2),a.op.i32_const(0),[a.op.i32_lt_s],a.op.local_get(2),a.op.i32_const(o.BUFFER_SIZE-1),[a.op.i32_gt_s,a.op.i32_or,a.op.select])}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};e.__esModule=!0;var r=i(11);e.parse=r.parse;var a=i(13);e.compileModule=a.compileModule;var o=s(i(5));e.shims=o.default;var n=i(29);e.loadModule=n.loadModule},function(t,e){t.exports=()=>"AGFzbQEAAAABPQpgAABgAXwBfGACfHwBfGACf38AYAR/f39/AGAJf39/f3x8fHx8AGADf399AGABfwF/YAJ/fwF/YAF+AX8CuBWMAQNlbnYFYWJvcnQABAhwaXhlbEVxcwtwZXJQaXhlbEVxcwAADHBpeGVsVmFyUG9vbAR3YXJwA3wBDHBpeGVsVmFyUG9vbAR6b29tA3wBDHBpeGVsVmFyUG9vbAd6b29tZXhwA3wBDHBpeGVsVmFyUG9vbAJjeAN8AQxwaXhlbFZhclBvb2wCY3kDfAEMcGl4ZWxWYXJQb29sAnN4A3wBDHBpeGVsVmFyUG9vbAJzeQN8AQxwaXhlbFZhclBvb2wCZHgDfAEMcGl4ZWxWYXJQb29sAmR5A3wBDHBpeGVsVmFyUG9vbANyb3QDfAEMcGl4ZWxWYXJQb29sA3JhZAN8AQxwaXhlbFZhclBvb2wDYW5nA3wBDHBpeGVsVmFyUG9vbAF4A3wBDHBpeGVsVmFyUG9vbAF5A3wBCHFWYXJQb29sAnExA3wBCHFWYXJQb29sAnEyA3wBCHFWYXJQb29sAnEzA3wBCHFWYXJQb29sAnE0A3wBCHFWYXJQb29sAnE1A3wBCHFWYXJQb29sAnE2A3wBCHFWYXJQb29sAnE3A3wBCHFWYXJQb29sAnE4A3wBCHFWYXJQb29sAnE5A3wBCHFWYXJQb29sA3ExMAN8AQhxVmFyUG9vbANxMTEDfAEIcVZhclBvb2wDcTEyA3wBCHFWYXJQb29sA3ExMwN8AQhxVmFyUG9vbANxMTQDfAEIcVZhclBvb2wDcTE1A3wBCHFWYXJQb29sA3ExNgN8AQhxVmFyUG9vbANxMTcDfAEIcVZhclBvb2wDcTE4A3wBCHFWYXJQb29sA3ExOQN8AQhxVmFyUG9vbANxMjADfAEIcVZhclBvb2wDcTIxA3wBCHFWYXJQb29sA3EyMgN8AQhxVmFyUG9vbANxMjMDfAEIcVZhclBvb2wDcTI0A3wBCHFWYXJQb29sA3EyNQN8AQhxVmFyUG9vbANxMjYDfAEIcVZhclBvb2wDcTI3A3wBCHFWYXJQb29sA3EyOAN8AQhxVmFyUG9vbANxMjkDfAEIcVZhclBvb2wDcTMwA3wBCHFWYXJQb29sA3EzMQN8AQhxVmFyUG9vbANxMzIDfAEIdFZhclBvb2wCdDEDfAEIdFZhclBvb2wCdDIDfAEIdFZhclBvb2wCdDMDfAEIdFZhclBvb2wCdDQDfAEIdFZhclBvb2wCdDUDfAEIdFZhclBvb2wCdDYDfAEIdFZhclBvb2wCdDcDfAEIdFZhclBvb2wCdDgDfAEKc2hhcGVQb29sMAN4XzADfAEKc2hhcGVQb29sMAN5XzADfAEKc2hhcGVQb29sMAVyYWRfMAN8AQpzaGFwZVBvb2wwBWFuZ18wA3wBCnNoYXBlUG9vbDADcl8wA3wBCnNoYXBlUG9vbDADZ18wA3wBCnNoYXBlUG9vbDADYl8wA3wBCnNoYXBlUG9vbDADYV8wA3wBCnNoYXBlUG9vbDAEcjJfMAN8AQpzaGFwZVBvb2wwBGcyXzADfAEKc2hhcGVQb29sMARiMl8wA3wBCnNoYXBlUG9vbDAEYTJfMAN8AQpzaGFwZVBvb2wwCmJvcmRlcl9yXzADfAEKc2hhcGVQb29sMApib3JkZXJfZ18wA3wBCnNoYXBlUG9vbDAKYm9yZGVyX2JfMAN8AQpzaGFwZVBvb2wwCmJvcmRlcl9hXzADfAEKc2hhcGVQb29sMA50aGlja291dGxpbmVfMAN8AQpzaGFwZVBvb2wwCnRleHR1cmVkXzADfAEKc2hhcGVQb29sMAp0ZXhfem9vbV8wA3wBCnNoYXBlUG9vbDAJdGV4X2FuZ18wA3wBCnNoYXBlUG9vbDAKYWRkaXRpdmVfMAN8AQpzaGFwZVBvb2wxA3hfMQN8AQpzaGFwZVBvb2wxA3lfMQN8AQpzaGFwZVBvb2wxBXJhZF8xA3wBCnNoYXBlUG9vbDEFYW5nXzEDfAEKc2hhcGVQb29sMQNyXzEDfAEKc2hhcGVQb29sMQNnXzEDfAEKc2hhcGVQb29sMQNiXzEDfAEKc2hhcGVQb29sMQNhXzEDfAEKc2hhcGVQb29sMQRyMl8xA3wBCnNoYXBlUG9vbDEEZzJfMQN8AQpzaGFwZVBvb2wxBGIyXzEDfAEKc2hhcGVQb29sMQRhMl8xA3wBCnNoYXBlUG9vbDEKYm9yZGVyX3JfMQN8AQpzaGFwZVBvb2wxCmJvcmRlcl9nXzEDfAEKc2hhcGVQb29sMQpib3JkZXJfYl8xA3wBCnNoYXBlUG9vbDEKYm9yZGVyX2FfMQN8AQpzaGFwZVBvb2wxDnRoaWNrb3V0bGluZV8xA3wBCnNoYXBlUG9vbDEKdGV4dHVyZWRfMQN8AQpzaGFwZVBvb2wxCnRleF96b29tXzEDfAEKc2hhcGVQb29sMQl0ZXhfYW5nXzEDfAEKc2hhcGVQb29sMQphZGRpdGl2ZV8xA3wBCnNoYXBlUG9vbDIDeF8yA3wBCnNoYXBlUG9vbDIDeV8yA3wBCnNoYXBlUG9vbDIFcmFkXzIDfAEKc2hhcGVQb29sMgVhbmdfMgN8AQpzaGFwZVBvb2wyA3JfMgN8AQpzaGFwZVBvb2wyA2dfMgN8AQpzaGFwZVBvb2wyA2JfMgN8AQpzaGFwZVBvb2wyA2FfMgN8AQpzaGFwZVBvb2wyBHIyXzIDfAEKc2hhcGVQb29sMgRnMl8yA3wBCnNoYXBlUG9vbDIEYjJfMgN8AQpzaGFwZVBvb2wyBGEyXzIDfAEKc2hhcGVQb29sMgpib3JkZXJfcl8yA3wBCnNoYXBlUG9vbDIKYm9yZGVyX2dfMgN8AQpzaGFwZVBvb2wyCmJvcmRlcl9iXzIDfAEKc2hhcGVQb29sMgpib3JkZXJfYV8yA3wBCnNoYXBlUG9vbDIOdGhpY2tvdXRsaW5lXzIDfAEKc2hhcGVQb29sMgp0ZXh0dXJlZF8yA3wBCnNoYXBlUG9vbDIKdGV4X3pvb21fMgN8AQpzaGFwZVBvb2wyCXRleF9hbmdfMgN8AQpzaGFwZVBvb2wyCmFkZGl0aXZlXzIDfAEKc2hhcGVQb29sMwN4XzMDfAEKc2hhcGVQb29sMwN5XzMDfAEKc2hhcGVQb29sMwVyYWRfMwN8AQpzaGFwZVBvb2wzBWFuZ18zA3wBCnNoYXBlUG9vbDMDcl8zA3wBCnNoYXBlUG9vbDMDZ18zA3wBCnNoYXBlUG9vbDMDYl8zA3wBCnNoYXBlUG9vbDMDYV8zA3wBCnNoYXBlUG9vbDMEcjJfMwN8AQpzaGFwZVBvb2wzBGcyXzMDfAEKc2hhcGVQb29sMwRiMl8zA3wBCnNoYXBlUG9vbDMEYTJfMwN8AQpzaGFwZVBvb2wzCmJvcmRlcl9yXzMDfAEKc2hhcGVQb29sMwpib3JkZXJfZ18zA3wBCnNoYXBlUG9vbDMKYm9yZGVyX2JfMwN8AQpzaGFwZVBvb2wzCmJvcmRlcl9hXzMDfAEKc2hhcGVQb29sMw50aGlja291dGxpbmVfMwN8AQpzaGFwZVBvb2wzCnRleHR1cmVkXzMDfAEKc2hhcGVQb29sMwp0ZXhfem9vbV8zA3wBCnNoYXBlUG9vbDMJdGV4X2FuZ18zA3wBCnNoYXBlUG9vbDMKYWRkaXRpdmVfMwN8AQMZGAgDBwkBAQICAQYFAAAAAAAAAAAAAAAAAAUDAQABBuwMigF8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt8AUQAAAAAAAAAAAt/AUEAC3wBRAAAAAAAAAAAC3wBRAAAAAAAAAAAC34BQgALB9kBDwZtZW1vcnkCABJjcmVhdGVGbG9hdDMyQXJyYXkABBFydW5QaXhlbEVxdWF0aW9ucwAMBnNhdmVRcwANCXJlc3RvcmVRcwAOBnNhdmVUcwAPCXJlc3RvcmVUcwAQC3NoYXBlMF9zYXZlABEOc2hhcGUwX3Jlc3RvcmUAEgtzaGFwZTFfc2F2ZQATDnNoYXBlMV9yZXN0b3JlABQLc2hhcGUyX3NhdmUAFQ5zaGFwZTJfcmVzdG9yZQAWC3NoYXBlM19zYXZlABcOc2hhcGUzX3Jlc3RvcmUAGAgBGQraQRi0AQEGfyAAQez///8DSwRAAAsgAEEQaiICQfz///8DSwRAAAsjkAIhBiOQAkEEaiIEIAJBE2pBcHFBBGsiB2oiAj8AIgVBEHRBD2pBcHEiA0sEQCAFIAIgA2tB//8DakGAgHxxQRB2IgMgAyAFSBtAAEEASARAIANAAEEASARAAAsLCyACJJACIAYgBzYCACAEQQRrIgJBADYCBCACQQA2AgggAiABNgIMIAIgADYCECAEQRBqC7sCAQF/AkAgAUUNACAAQQA6AAAgACABakEEayICQQA6AAMgAUECTQ0AIABBADoAASAAQQA6AAIgAkEAOgACIAJBADoAASABQQZNDQAgAEEAOgADIAJBADoAACABQQhNDQAgAEEAIABrQQNxIgJqIgBBADYCACAAIAEgAmtBfHEiAmpBHGsiAUEANgIYIAJBCE0NACAAQQA2AgQgAEEANgIIIAFBADYCECABQQA2AhQgAkEYTQ0AIABBADYCDCAAQQA2AhAgAEEANgIUIABBADYCGCABQQA2AgAgAUEANgIEIAFBADYCCCABQQA2AgwgACAAQQRxQRhqIgFqIQAgAiABayEBA0AgAUEgTwRAIABCADcDACAAQgA3AwggAEIANwMQIABCADcDGCABQSBrIQEgAEEgaiEADAELCwsLdwECfwJ/QQxBAxACIgFFBEBBDEECEAIhAQsgAQtBADYCACABQQA2AgQgAUEANgIIIABB/////wBLBEBBoAhB0AhBEkE5EAAACyAAQQJ0IgBBABACIgIgABADIAEoAgAaIAEgAjYCACABIAI2AgQgASAANgIIIAELuwQDAX8KfgF8IABC////////////AINCNIhClQh9IgVCBoenQQN0QYAJaiIBKQMAIQcgASkDCCEEIAEpAxAhAiAFQj+DIgVCAFIEQAJ+IAcgBYYgBELAACAFfSIDiIQhByAEIAWGIAIgA4iEIQQgAiAFhiABKQMYIAOIhAshAgsgAEL/////////B4NCgICAgICAgAiEIgVC/////w+DIgMgBEIgiCIIfiAEQv////8PgyIGIAN+IglCIIh8IQQgBiAFQiCIIgZ+IARC/////w+DfCEDIAYgCH4gBEIgiHwgA0IgiHwkkwIgBUIghyACQiCIfiIEIAlC/////w+DIANCIIZ8fCECIAIgBFStI5MCIAUgB358fCIIQgKGIAJCPoiEIgdCP4ciBUIBhyAHhSIDeSEEIAMgBIYgBSACQgKGhSIGQsAAIAR9iIQiAkL/////D4MhAyACQiCIIglCtISjiwJ+IANCorW/yAx+IANCtISjiwJ+IgpCIIh8IgtC/////w+DfCEDIAlCorW/yAx+IAtCIIh8IANCIIh8JJMCIApC/////w+DIANCIIZ8IgMgArpEhBtwUcyYOD+iIAYgBIa6RBgtRFT7ITk/oqCxIgJUrSOTAiIGQguIfLokkQIgAiAGQjWGIANCC4iEfLpEAAAAAAAA8DuiJJICI5ECQoCAgICAgIDYPCAEQjSGfSAAIAeFQoCAgICAgICAgH+DhL8iDKIkkQIjkgIgDKIkkgIgCEI+hyAFfacLlQYDAn8BfgR8IAC9IgNCIIinIgFBH3YhAiABQf////8HcSIBQfvDpP8DTQRAIAFBnsGa8gNJBEBEAAAAAAAA8D8PC0QAAAAAAADwPyAAIACiIgVEAAAAAAAA4D+iIgahIgREAAAAAAAA8D8gBKEgBqEgBSAFIAUgBUSQFcsZoAH6PqJEd1HBFmzBVr+gokRMVVVVVVWlP6CiIAUgBaIiBiAGoiAFIAVE1DiIvun6qL2iRMSxtL2e7iE+oKJErVKcgE9+kr6goqCiIABEAAAAAAAAAACioaCgDwsgAUGAgMD/B08EQCAAIAChDwsCfyADQiCIp0H/////B3EiAUH7w+SJBEkEQAJ8IAFBFHYiAiAAIABEg8jJbTBf5D+iniIFRAAAQFT7Ifk/oqEiACAFRDFjYhphtNA9oiIGoSIEvUIgiKdBFHZB/w9xa0EQSwRAAnwgBURzcAMuihmjO6IgACAAIAVEAABgGmG00D2iIgahIgChIAahoSEGIAIgACAGoSIEvUIgiKdBFHZB/w9xa0ExSwR8IAVEwUkgJZqDezmiIAAgACAFRAAAAC6KGaM7oiIGoSIAoSAGoaEhBiAAIAahBSAECwshBAsgBAskkQIgACAEoSAGoSSSAiAFqgwBC0EAIAMQBSIBayABIAIbCyECI5ECIQUjkgIhBiACQQFxBHwgBSAFoiIAIAWiIQQgBSAAIAZEAAAAAAAA4D+iIAQgACAARH3+sVfjHcc+okTVYcEZoAEqv6CiRKb4EBEREYE/oCAAIAAgAKKiIABEfNXPWjrZ5T2iROucK4rm5Vq+oKKgoqGiIAahIARESVVVVVVVxb+ioaEFRAAAAAAAAPA/IAUgBaIiAEQAAAAAAADgP6IiBKEiB0QAAAAAAADwPyAHoSAEoSAAIAAgACAARJAVyxmgAfo+okR3UcEWbMFWv6CiRExVVVVVVaU/oKIgACAAoiIEIASiIAAgAETUOIi+6fqovaJExLG0vZ7uIT6gokStUpyAT36SvqCioKIgBSAGoqGgoAsiAJogACACQQFqQQJxGwu8BAICfwN8IAAhAyAAvUIgiKdB/////wdxIgFBgIDAoARPBEAgACAAYgRAIAAPC0QYLURU+yH5PyADpg8LIAFBgIDw/gNJBEAgAUGAgIDyA0kEQCAADwtBfyECBSAAmSEAIAFBgIDM/wNJBHwgAUGAgJj/A0kEfCAAIACgRAAAAAAAAPA/oSAARAAAAAAAAABAoKMFQQEhAiAARAAAAAAAAPA/oSAARAAAAAAAAPA/oKMLBSABQYCAjoAESQR8QQIhAiAARAAAAAAAAPg/oSAARAAAAAAAAPg/okQAAAAAAADwP6CjBUEDIQJEAAAAAAAA8L8gAKMLCyEACyAAIACiIgUgBaIhBCAAIAUgBCAEIAQgBCAERBHaIuM6rZA/okTrDXYkS3upP6CiRFE90KBmDbE/oKJEbiBMxc1Ftz+gokT/gwCSJEnCP6CiRA1VVVVVVdU/oKIgBCAEIAQgBCAERC9saixEtKK/okSa/d5SLd6tv6CiRG2adK/ysLO/oKJEcRYj/sZxvL+gokTE65iZmZnJv6CioKIhBCACQQBIBEAgACAEoQ8LAkACQAJAAkACQAJAIAIOBAABAgMEC0RPu2EFZ6zdPyAEROJlLyJ/K3o8oSAAoaEhAAwEC0QYLURU+yHpPyAERAdcFDMmpoE8oSAAoaEhAAwDC0Sb9oHSC3PvPyAERL3L8HqIB3A8oSAAoaEhAAwCC0QYLURU+yH5PyAERAdcFDMmppE8oSAAoaEhAAwBCwALIAAgA6YLvgMCBX8BfkEBIAAgAGIgASABYhsEQCABIACgDwsgAL0iB0IgiKchBCAHpyEDIAG9IgenIgYgB0IgiKciBUGAgMD/A2tyRQRAIAAQBw8LIAVBHnZBAnEgBEEfdnIhAiAFQf////8HcSEFIARB/////wdxIgQgA3JFBEACQAJAAkACQCACRQ0AAkAgAkEBaw4DAQIDAAsMAwsgAA8LRBgtRFT7IQlADwtEGC1EVPshCcAPCwsCQCAFIAZyRQ0AIAVBgIDA/wdGBEBE0iEzf3zZAkBEGC1EVPsh6T8gAkECcRtEGC1EVPshCUBEAAAAAAAAAAAgAkECcRsgBEGAgMD/B0YbIgCaIAAgAkEBcRsPC0EBIARBgIDA/wdGIAQgBUGAgIAgaksbDQAgBSAEQYCAgCBqS0EAIAJBAnEbBHxEAAAAAAAAAAAFIAAgAaOZEAcLIQACQAJAAkACQCACIgMEQCADQQFrDgMBAgMECyAADwsgAJoPC0QYLURU+yEJQCAARAdcFDMmpqE8oaEPCyAARAdcFDMmpqE8oUQYLURU+yEJQKEPCwALRBgtRFT7Ifm/RBgtRFT7Ifk/IAJBAXEbC4ESAwl/AX4IfAJAAkACQAJAIAGZRAAAAAAAAABAZQRAIAFEAAAAAAAAAEBhDQEgAUQAAAAAAADgP2EEQCAAn5lEAAAAAAAA8H8gAEQAAAAAAADw/2IbDwsgAUQAAAAAAADwv2ENAiABRAAAAAAAAPA/YQRAIAAPCyABRAAAAAAAAAAAYQRARAAAAAAAAPA/DwsLIAC9IgunIQcgC0IgiKciBkH/////B3EhBCABvSILQiCIpyIDQf////8HcSIFIAunIghyRQRARAAAAAAAAPA/DwtBASAIQQAgBUGAgMD/B0YbQQEgBUGAgMD/B0tBASAHQQAgBEGAgMD/B0YbIARBgIDA/wdKGxsbBEAgACABoA8LIAZBAEgEfyAFQYCAgJoETwR/QQIFIAVBgIDA/wNPBH9BAiAIIAUgBUEUdkH/B2siAkEUSiIJGyIKQTRBFCAJGyACayICdiIJQQFxa0EAIAogCSACdEYbBUEACwsFQQALIQIgCEUEQCAFQYCAwP8HRgRAIAcgBEGAgMD/A2tyBEAgBEGAgMD/A04EQCABRAAAAAAAAAAAIANBAE4bDwVEAAAAAAAAAAAgAZogA0EAThsPCwAFRAAAAAAAAPh/DwsACyAFQYCAwP8DRgRAIANBAE4EQCAADwsMAwsgA0GAgICABEYNASADQYCAgP8DRgRAIAZBAE4EQCAAnw8LCwsgAJkhDCAHRQRAQQEgBEGAgMD/A0YgBEGAgMD/B0ZBASAEGxsEQEQAAAAAAADwPyAMoyAMIANBAEgbIQAgBkEASAR8IAIgBEGAgMD/A2tyBHwgAJogACACQQFGGwUgACAAoSIAIACjCwUgAAsPCwsgBkEASAR8IAJFBEAgACAAoSIAIACjDwtEAAAAAAAA8L9EAAAAAAAA8D8gAkEBRhsFRAAAAAAAAPA/CyEOIAVBgICAjwRLBHwgBUGAgMCfBEsEQCAEQf//v/8DTARARAAAAAAAAPB/RAAAAAAAAAAAIANBAEgbDwsgBEGAgMD/A04EQEQAAAAAAADwf0QAAAAAAAAAACADQQBKGw8LCyAEQf//v/8DSARAIA5EnHUAiDzkN36iRJx1AIg85Dd+oiAORFnz+MIfbqUBokRZ8/jCH26lAaIgA0EASBsPCyAEQYCAwP8DSgRAIA5EnHUAiDzkN36iRJx1AIg85Dd+oiAORFnz+MIfbqUBokRZ8/jCH26lAaIgA0EAShsPCyAMRAAAAAAAAPA/oSIARAAAAGBHFfc/oiIMIABERN9d+AuuVD6iIAAgAKJEAAAAAAAA4D8gAERVVVVVVVXVPyAARAAAAAAAANA/oqGioaJE/oIrZUcV9z+ioSINoL1CgICAgHCDvyEAIA0gACAMoaEFIARBgIDAAEgEfyAMRAAAAAAAAEBDoiIMvUIgiKchBEFLBUEACyAEQRR1Qf8Ha2ohAyAEQf//P3EiAkGAgMD/A3IhBCACQY6xDkwEf0EABSACQfrsLkgEf0EBBSADQQFqIQMgBEGAgEBqIQRBAAsLIQIgDL1C/////w+DIASsQiCGhL8iD0QAAAAAAAD4P0QAAAAAAADwPyACGyIQoSISRAAAAAAAAPA/IA8gEKCjIhOiIg29QoCAgIBwg78iDCAMoiERIAwgEUQAAAAAAAAIQKAgDSANoiIAIACiIAAgACAAIAAgAETvTkVKKH7KP6JEZdvJk0qGzT+gokQBQR2pYHTRP6CiRE0mj1FVVdU/oKJE/6tv27Zt2z+gokQDMzMzMzPjP6CiIBMgEiAMIARBAXVBgICAgAJyQYCAIGogAkESdGqsQiCGvyIAoqEgDCAPIAAgEKGhoqGiIg8gDCANoKKgIgygvUKAgICAcIO/IgCiIhAgDyAAoiAMIABEAAAAAAAACEChIBGhoSANoqAiDKC9QoCAgIBwg78iAEQAAADgCcfuP6IiDSAARPUBWxTgLz6+oiAMIAAgEKGhRP0DOtwJx+4/oqBEBtDPQ+v9TD5EAAAAAAAAAAAgAhugIgygRAAAAEADuOI/RAAAAAAAAAAAIAIbIg+gIAO3IhCgvUKAgICAcIO/IQAgDCAAIBChIA+hIA2hoQshDCABIAG9QoCAgIBwg78iDaEgAKIgASAMoqAiASANIACiIgCgIgy9IgunIQMgC0IgiKciAkGAgMCEBE4EQCADIAJBgIDAhARrciABRP6CK2VHFZc8oCAMIAChZHINAwUgAkH/////B3FBgJjDhARPQQAgAyACQYCYw4R8a3IgASAMIAChZXIbDQQLIAJB/////wdxIgRBFHZB/wdrIQVBACEDIAECfCAEQYCAgP8DSgRAAnwgAkGAgMAAIAVBAWp1aiIEQf////8HcUEUdkH/B2shBUEAIARB//8/cUGAgMAAckEUIAVrdSIDayADIAJBAEgbIQMgACAEQf//PyAFdUF/c3GsQiCGv6ELIQALIAALoL1CgICAgHCDvyIMRAAAAABDLuY/oiINIAEgDCAAoaFE7zn6/kIu5j+iIAxEOWyoDGFcIL6ioCIMoCIAIACiIQEgDkQAAAAAAADwPyAAIAAgASABIAEgASABRNCkvnJpN2Y+okTxa9LFQb27vqCiRCzeJa9qVhE/oKJEk72+FmzBZr+gokQ+VVVVVVXFP6CioSIBoiABRAAAAAAAAABAoaMgDCAAIA2hoSIBIAAgAaKgoSAAoaEiAL1CIIinIANBFHRqIgJBFHVBAEwEfCADIgJB/wdKBHwgAEQAAAAAAADgf6IhACACQf8HayICQf8HSgR8IAJB/wdrIgJB/wcgAkH/B0gbIQIgAEQAAAAAAADgf6IFIAALBSACQYJ4SAR8IABEAAAAAAAAYAOiIQAgAkHJB2oiAkGCeEgEfCACQckHaiICQYJ4IAJBgnhKGyECIABEAAAAAAAAYAOiBSAACwUgAAsLIAKsQv8HfEI0hr+iBSAAvUL/////D4MgAqxCIIaEvwuiDwsgACAAog8LRAAAAAAAAPA/IACjDwsgDkScdQCIPOQ3fqJEnHUAiDzkN36iDwsgDkRZ8/jCH26lAaJEWfP4wh9upQGiC9QFAwJ/AX4EfCAAvSIDQiCIpyIBQR92IQIgAUH/////B3EiAUH7w6T/A00EQCABQYCAwPIDSQRAIAAPCyAAIAAgAKIiBSAAoiAFIAUgBUR9/rFX4x3HPqJE1WHBGaABKr+gokSm+BARERGBP6AgBSAFIAWioiAFRHzVz1o62eU9okTrnCuK5uVavqCioKJESVVVVVVVxb+goqAPCyABQYCAwP8HTwRAIAAgAKEPCwJ/IANCIIinQf////8HcSIBQfvD5IkESQRAAnwgAUEUdiICIAAgAESDyMltMF/kP6KeIgVEAABAVPsh+T+ioSIAIAVEMWNiGmG00D2iIgahIgS9QiCIp0EUdkH/D3FrQRBLBEACfCAFRHNwAy6KGaM7oiAAIAAgBUQAAGAaYbTQPaIiBqEiAKEgBqGhIQYgAiAAIAahIgS9QiCIp0EUdkH/D3FrQTFLBHwgBUTBSSAlmoN7OaIgACAAIAVEAAAALooZozuiIgahIgChIAahoSEGIAAgBqEFIAQLCyEECyAECySRAiAAIAShIAahJJICIAWqDAELQQAgAxAFIgFrIAEgAhsLIQIjkQIhBSOSAiEGIAJBAXEEfEQAAAAAAADwPyAFIAWiIgBEAAAAAAAA4D+iIgShIgdEAAAAAAAA8D8gB6EgBKEgACAAIAAgAESQFcsZoAH6PqJEd1HBFmzBVr+gokRMVVVVVVWlP6CiIAAgAKIiBCAEoiAAIABE1DiIvun6qL2iRMSxtL2e7iE+oKJErVKcgE9+kr6goqCiIAUgBqKhoKAFIAUgBaIiACAFoiEEIAUgACAGRAAAAAAAAOA/oiAEIAAgAER9/rFX4x3HPqJE1WHBGaABKr+gokSm+BARERGBP6AgACAAIACioiAARHzVz1o62eU9okTrnCuK5uVavqCioKKhoiAGoSAERElVVVVVVcW/oqGhCyIAmiAAIAJBAnEbCxIAIAAoAgQgAUECdGogAjgCAAuTCAIFfwl8IAJBAWohDCADQQFqIQ1EAAAAAAAA8D8gBqMhECAEIAWiIgVEz/dT46Wb9j+iRAAAAAAAACRAoBAGRAAAAAAAABBAokRcj8L1KFwnQKAhFCAFRAIrhxbZzvE/okQAAAAAAAAcQKAQBkQAAAAAAAAIQKJECtejcD2KIUCgIRIgBUTufD81XrrzP6JEAAAAAAAACECgEAZEAAAAAAAACECiRBSuR+F6FCVAoCETIAVEQmDl0CLb7T+iRAAAAAAAABRAoBAGRAAAAAAAABBAokR7FK5H4fomQKAhFSMAJIoBIwEkiwEjAiSMASMDJI0BIwQkjgEjBSSPASMGJJABIwckkQEjCCSSASMJJJMBA0AgCiANSARAQQAhCQNAIAkgDEgEQCAJtyACt6MiBCAEoEQAAAAAAADwP6EiBiAGoiAHoiAHoiAKtyADt6MiBCAEoEQAAAAAAADwP6EiDyAPoiAIoiAIoqCfJAogAQRAIAm3IAK3RAAAAAAAAOA/omFBACAKtyADt0QAAAAAAADgP6JhGwRARAAAAAAAAAAAJAsFIA8gCKIgBiAHohAIIgREAAAAAAAAAABjBHwgBEQYLURU+yEZQKAFIAQLJAsLIAZEAAAAAAAA4D+iIAeiRAAAAAAAAOA/oCQMIA9EAAAAAAAA4L+iIAiiRAAAAAAAAOA/oCQNI4oBJAAjiwEkASOMASQCI40BJAMjjgEkBCOPASQFI5ABJAYjkQEkByOSASQII5MBJAkQAQsgBkQAAAAAAADgP6IgB6JEAAAAAAAA8D8jASMCIwoiBCAEoEQAAAAAAADwP6EQCRAJoyIOokQAAAAAAADgP6AjA6EjBaMjA6AhBCAPRAAAAAAAAOC/oiAIoiAOokQAAAAAAADgP6AjBKEjBqMjBKAhDiMARAAAAAAAAAAAYgRAAnwgBCMARHnpJjEIrGw/oiAFRB1aZDvfT9U/oiAQIAYgFKIiESAPIBWiIhahoqAQCqKgIQQgDiMARHnpJjEIrGw/oiAFRAAAAAAAANg/oiAQIAYgE6IgDyASoqCioRAGoqAhDiAEIwBEeekmMQisbD+iIAVEf2q8dJMY6D+iIBAgBiASoiAPIBOioaKhEAaioCEEIA4jAER56SYxCKxsP6IgBURmZmZmZmbqP6IgECARIBagoqAQCqKgCyEOCyAEIwOhIQQgDiMEoSEGIwkQBiEPIAQjCRAKIg6iIAYgD6KgIwSgIwihRAAAAAAAAOA/oSAIo0QAAAAAAADgP6AhESAAIAsgBCAPoiAGIA6ioSMDoCMHoUQAAAAAAADgP6EgB6NEAAAAAAAA4D+gthALIAAgC0EBaiARthALIAtBAmohCyAJQQFqIQkMAQsLIApBAWohCgwBCwsLogEAIw4klAEjDySVASMQJJYBIxEklwEjEiSYASMTJJkBIxQkmgEjFSSbASMWJJwBIxcknQEjGCSeASMZJJ8BIxokoAEjGyShASMcJKIBIx0kowEjHiSkASMfJKUBIyAkpgEjISSnASMiJKgBIyMkqQEjJCSqASMlJKsBIyYkrAEjJyStASMoJK4BIykkrwEjKiSwASMrJLEBIywksgEjLSSzAQuiAQAjlAEkDiOVASQPI5YBJBAjlwEkESOYASQSI5kBJBMjmgEkFCObASQVI5wBJBYjnQEkFyOeASQYI58BJBkjoAEkGiOhASQbI6IBJBwjowEkHSOkASQeI6UBJB8jpgEkICOnASQhI6gBJCIjqQEkIyOqASQkI6sBJCUjrAEkJiOtASQnI64BJCgjrwEkKSOwASQqI7EBJCsjsgEkLCOzASQtCyoAIy4ktAEjLyS1ASMwJLYBIzEktwEjMiS4ASMzJLkBIzQkugEjNSS7AQsqACO0ASQuI7UBJC8jtgEkMCO3ASQxI7gBJDIjuQEkMyO6ASQ0I7sBJDULawAjNiS8ASM3JL0BIzgkvgEjOSS/ASM6JMABIzskwQEjPCTCASM9JMMBIz4kxAEjPyTFASNAJMYBI0EkxwEjQiTIASNDJMkBI0QkygEjRSTLASNGJMwBI0ckzQEjSCTOASNJJM8BI0ok0AELawAjvAEkNiO9ASQ3I74BJDgjvwEkOSPAASQ6I8EBJDsjwgEkPCPDASQ9I8QBJD4jxQEkPyPGASRAI8cBJEEjyAEkQiPJASRDI8oBJEQjywEkRSPMASRGI80BJEcjzgEkSCPPASRJI9ABJEoLawAjSyTRASNMJNIBI00k0wEjTiTUASNPJNUBI1Ak1gEjUSTXASNSJNgBI1Mk2QEjVCTaASNVJNsBI1Yk3AEjVyTdASNYJN4BI1kk3wEjWiTgASNbJOEBI1wk4gEjXSTjASNeJOQBI18k5QELawAj0QEkSyPSASRMI9MBJE0j1AEkTiPVASRPI9YBJFAj1wEkUSPYASRSI9kBJFMj2gEkVCPbASRVI9wBJFYj3QEkVyPeASRYI98BJFkj4AEkWiPhASRbI+IBJFwj4wEkXSPkASReI+UBJF8LawAjYCTmASNhJOcBI2Ik6AEjYyTpASNkJOoBI2Uk6wEjZiTsASNnJO0BI2gk7gEjaSTvASNqJPABI2sk8QEjbCTyASNtJPMBI24k9AEjbyT1ASNwJPYBI3Ek9wEjciT4ASNzJPkBI3Qk+gELawAj5gEkYCPnASRhI+gBJGIj6QEkYyPqASRkI+sBJGUj7AEkZiPtASRnI+4BJGgj7wEkaSPwASRqI/EBJGsj8gEkbCPzASRtI/QBJG4j9QEkbyP2ASRwI/cBJHEj+AEkciP5ASRzI/oBJHQLdQAjdST7ASN2JPwBI3ck/QEjeCT+ASN5JP8BI3okgAIjeySBAiN8JIICI30kgwIjfiSEAiN/JIUCI4ABJIYCI4EBJIcCI4IBJIgCI4MBJIkCI4QBJIoCI4UBJIsCI4YBJIwCI4cBJI0CI4gBJI4CI4kBJI8CC3UAI/sBJHUj/AEkdiP9ASR3I/4BJHgj/wEkeSOAAiR6I4ECJHsjggIkfCODAiR9I4QCJH4jhQIkfyOGAiSAASOHAiSBASOIAiSCASOJAiSDASOKAiSEASOLAiSFASOMAiSGASONAiSHASOOAiSIASOPAiSJAQsIAEHMCiSQAgsLvAIDAEGMCAsvLAAAAAEAAAAAAAAAAQAAABwAAABJAG4AdgBhAGwAaQBkACAAbABlAG4AZwB0AGgAQbwICzk8AAAAAQAAAAAAAAABAAAAJgAAAH4AbABpAGIALwBhAHIAcgBhAHkAYgB1AGYAZgBlAHIALgB0AHMAQYAJC8ABboP5ogAAAADRVyf8KRVETpmVYtvA3TT1q2NR/kGQQzw6biS3YcW73uouSQbg0k1CHOsd/hyS0Qn1NYLoPqcpsSZwnOmERLsuOdaROUF+X7SLX4Sc9DlTg/+X+B87KPm9ixEv7w+YBd7PfjZtH20KWmY/Rk+3Ccsnx7ondS3qX573OQc9e/Hl67Ff+2vqklKKRjADVghdjR8gvM/wq2t7/GGR46kdNvSaX4WZZQgb5l6A2P+NQGigFFcVBgYxJ3NN"},function(t,e,i){"use strict";{const t=(t,e)=>{var i="function"==typeof e,s="function"==typeof e,r="function"==typeof e;Object.defineProperty(Math,t,{configurable:i,enumerable:r,writable:s,value:e})};t("DEG_PER_RAD",Math.PI/180),t("RAD_PER_DEG",180/Math.PI);const e=new Float32Array(1);t("scale",(function(t,e,i,s,r){return 0===arguments.length||Number.isNaN(t)||Number.isNaN(e)||Number.isNaN(i)||Number.isNaN(s)||Number.isNaN(r)?NaN:t===1/0||t===-1/0?t:(t-e)*(r-s)/(i-e)+s})),t("fscale",(function(t,i,s,r,a){return e[0]=Math.scale(t,i,s,r,a),e[0]})),t("clamp",(function(t,e,i){return Math.min(i,Math.max(e,t))})),t("radians",(function(t){return t*Math.DEG_PER_RAD})),t("degrees",(function(t){return t*Math.RAD_PER_DEG}))}},function(t,e){window.sqr=function(t){return t*t},window.sqrt=function(t){return Math.sqrt(Math.abs(t))},window.log10=function(t){return Math.log(t)*Math.LOG10E},window.sign=function(t){return t>0?1:t<0?-1:0},window.rand=function(t){var e=Math.floor(t);return e<1?Math.random():Math.random()*e},window.randint=function(t){return Math.floor(rand(t))},window.bnot=function(t){return Math.abs(t)<1e-5?1:0},window.pow=function(t,e){var i,s=Math.pow(t,e);return i=s,!isFinite(i)||isNaN(i)?0:s},window.div=function(t,e){return 0===e?0:t/e},window.mod=function(t,e){return 0===e?0:Math.floor(t)%Math.floor(e)},window.bitor=function(t,e){return Math.floor(t)|Math.floor(e)},window.bitand=function(t,e){return Math.floor(t)&Math.floor(e)},window.sigmoid=function(t,e){var i=1+Math.exp(-t*e);return Math.abs(i)>1e-5?1/i:0},window.bor=function(t,e){return Math.abs(t)>1e-5||Math.abs(e)>1e-5?1:0},window.band=function(t,e){return Math.abs(t)>1e-5&&Math.abs(e)>1e-5?1:0},window.equal=function(t,e){return Math.abs(t-e)<1e-5?1:0},window.above=function(t,e){return t>e?1:0},window.below=function(t,e){return t<e?1:0},window.ifcond=function(t,e,i){return Math.abs(t)>1e-5?e:i},window.memcpy=function(t,e,i,s){var r=e,a=i,o=s;return a<0&&(o+=a,r-=a,a=0),r<0&&(o+=r,a-=r,r=0),o>0&&t.copyWithin(r,a,o),e}},function(t,e,i){var s=function(t){"use strict";var e=Object.prototype,i=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",o=s.toStringTag||"@@toStringTag";function n(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{n({},"")}catch(t){n=function(t,e,i){return t[e]=i}}function h(t,e,i,s){var r=e&&e.prototype instanceof c?e:c,a=Object.create(r.prototype),o=new y(s||[]);return a._invoke=function(t,e,i){var s="suspendedStart";return function(r,a){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===r)throw a;return w()}for(i.method=r,i.arg=a;;){var o=i.delegate;if(o){var n=E(o,i);if(n){if(n===l)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===s)throw s="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s="executing";var h=A(t,e,i);if("normal"===h.type){if(s=i.done?"completed":"suspendedYield",h.arg===l)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(s="completed",i.method="throw",i.arg=h.arg)}}}(t,i,o),a}function A(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var l={};function c(){}function u(){}function g(){}var m={};m[r]=function(){return this};var f=Object.getPrototypeOf,p=f&&f(f(T([])));p&&p!==e&&i.call(p,r)&&(m=p);var d=g.prototype=c.prototype=Object.create(m);function v(t){["next","throw","return"].forEach((function(e){n(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){var s;this._invoke=function(r,a){function o(){return new e((function(s,o){!function s(r,a,o,n){var h=A(t[r],t,a);if("throw"!==h.type){var l=h.arg,c=l.value;return c&&"object"==typeof c&&i.call(c,"__await")?e.resolve(c.__await).then((function(t){s("next",t,o,n)}),(function(t){s("throw",t,o,n)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return s("throw",t,o,n)}))}n(h.arg)}(r,a,s,o)}))}return s=s?s.then(o,o):o()}}function E(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,E(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var s=A(i,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,l;var r=s.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function y(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function T(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,a=function e(){for(;++s<t.length;)if(i.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return u.prototype=d.constructor=g,g.constructor=u,u.displayName=n(g,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===u||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,n(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t},t.awrap=function(t){return{__await:t}},v(_.prototype),_.prototype[a]=function(){return this},t.AsyncIterator=_,t.async=function(e,i,s,r,a){void 0===a&&(a=Promise);var o=new _(h(e,i,s,r),a);return t.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},v(d),n(d,o,"Generator"),d[r]=function(){return this},d.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var s=e.pop();if(s in t)return i.value=s,i.done=!1,i}return i.done=!0,i}},t.values=T,y.prototype={constructor:y,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(i,s){return o.type="throw",o.arg=t,e.next=i,s&&(e.method="next",e.arg=void 0),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),h=i.call(a,"finallyLoc");if(n&&h){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),x(i),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var s=i.completion;if("throw"===s.type){var r=s.arg;x(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:T(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=s}catch(t){Function("r","regeneratorRuntime = r")(s)}},function(t,e,i){"use strict";e.__esModule=!0,e.getLoc=function(t,e){var i={destCol:1,srcCol:1,srcLine:1};t.forEach((function(t){t.destCol>e||(i=t)}));var s=e-i.destCol;return{column:i.srcCol+s,line:i.srcLine}},e.preProcess=function(t){for(var e=[],i=1,s="",r=0,a=!1,o=!1,n=!1,h=0;h<t.length;h++){var A=t[h];if(n){var l=s.length+1,c=h-r+1;e.push({destCol:l,srcCol:c,srcLine:i}),n=!1}"\n"===A?(a=!1,i++,r=h+1,n=!0):"\r"===A&&"\n"===t[h+1]?(a=!1,i++,r=++h+1,n=!0):o&&"*"===A&&"/"===t[h+1]?(o=!1,h++,n=!0):"\\"===A&&"\\"===t[h+1]||"/"===A&&"/"===t[h+1]?(a=!0,h++):"/"===A&&"*"===t[h+1]?(o=!0,h++):a||o||(s+=A)}return[s,e]}},function(t,e,i){var s=i(23);t.exports={parse:s.parse}},function(t,e,i){(function(t,s){var r=function(){var t=function(t,e,i,s){for(i=i||{},s=t.length;s--;i[t[s]]=e);return i},e=[1,18],i=[1,7],s=[1,19],r=[1,20],a=[1,14],o=[1,15],n=[1,16],h=[1,33],A=[1,31],l=[1,23],c=[1,22],u=[1,24],g=[1,25],m=[1,26],f=[1,27],p=[1,28],d=[1,29],v=[1,30],_=[5,8,15,18,20,28,29,32,33,34,35,36,37,38],E=[5,15,18],b=[5,12,15,17,18,24,25,28,29,30],x=[1,57],y=[5,8,12,15,17,18,24,25,28,29,30],T=[15,18],w=[5,8,15,18,28,29,38],S=[5,8,15,18,28,29,32,33,38],P=[5,8,15,18,28,29,32,33,34,37,38],I=[5,8,15,18,28,29,32,33,34,35,36,37,38],R=[5,8,15,18],B=[5,8,15,18,20,22,28,29,32,33,34,35,36,37,38],L={trace:function(){},yy:{},symbols_:{error:2,SCRIPT:3,expression:4,EOF:5,expressionsOptionalTrailingSemi:6,separator:7,";":8,expressions:9,EXPRESSION_BLOCK:10,IDENTIFIER:11,IDENTIFIER_TOKEN:12,argument:13,arguments:14,",":15,FUNCTION_CALL:16,"(":17,")":18,LOGICAL_EXPRESSION:19,LOGICAL_OPERATOR_TOKEN:20,ASSIGNMENT:21,ASSIGNMENT_OPERATOR_TOKEN:22,number:23,DIGITS_TOKEN:24,".":25,NUMBER_LITERAL:26,UNARY_EXPRESSION:27,"-":28,"+":29,"!":30,BINARY_EXPRESSION:31,"*":32,"/":33,"%":34,"&":35,"|":36,"^":37,COMPARISON_TOKEN:38,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:";",12:"IDENTIFIER_TOKEN",15:",",17:"(",18:")",20:"LOGICAL_OPERATOR_TOKEN",22:"ASSIGNMENT_OPERATOR_TOKEN",24:"DIGITS_TOKEN",25:".",28:"-",29:"+",30:"!",32:"*",33:"/",34:"%",35:"&",36:"|",37:"^",38:"COMPARISON_TOKEN"},productions_:[0,[3,2],[3,2],[3,1],[7,1],[7,2],[9,2],[9,3],[6,1],[6,2],[10,1],[11,1],[13,1],[13,1],[14,1],[14,3],[16,3],[16,4],[19,3],[21,3],[21,3],[23,1],[23,2],[23,3],[23,2],[23,1],[26,1],[27,2],[27,2],[27,2],[31,3],[31,3],[31,3],[31,3],[31,3],[31,3],[31,3],[31,3],[31,3],[4,1],[4,1],[4,3],[4,1],[4,1],[4,1],[4,1],[4,1],[4,3]],performAction:function(t,e,i,s,r,a,o){var n=a.length-1;switch(r){case 1:return{type:"SCRIPT",body:[a[n-1]],loc:this._$};case 2:return{type:"SCRIPT",body:a[n-1],loc:this._$};case 3:return{type:"SCRIPT",body:[],loc:this._$};case 6:this.$=[a[n-1]];break;case 7:this.$=a[n-2].concat([a[n-1]]);break;case 8:this.$=a[n];break;case 9:this.$=a[n-1].concat([a[n]]);break;case 10:this.$={type:"EXPRESSION_BLOCK",body:a[n],loc:this._$};break;case 11:this.$={type:"IDENTIFIER",value:a[n].toLowerCase(),loc:this._$};break;case 14:this.$=[a[n]];break;case 15:this.$=a[n-2].concat([a[n]]);break;case 16:this.$={type:"CALL_EXPRESSION",callee:a[n-2],arguments:[],loc:this._$};break;case 17:this.$={type:"CALL_EXPRESSION",callee:a[n-3],arguments:a[n-1],loc:this._$};break;case 18:this.$={type:"LOGICAL_EXPRESSION",left:a[n-2],right:a[n],operator:a[n-1],loc:this._$};break;case 19:case 20:this.$={type:"ASSIGNMENT_EXPRESSION",left:a[n-2],operator:a[n-1],right:a[n],loc:this._$};break;case 21:this.$=Number(a[n]);break;case 22:this.$=Number(a[n-1]);break;case 23:this.$=Number(a[n-2]+a[n-1]+a[n]);break;case 24:this.$=Number("0"+a[n-1]+a[n]);break;case 25:this.$=0;break;case 26:this.$={type:"NUMBER_LITERAL",value:a[n],loc:this._$};break;case 27:case 28:case 29:this.$={type:"UNARY_EXPRESSION",value:a[n],operator:a[n-1],loc:this._$};break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:this.$={type:"BINARY_EXPRESSION",left:a[n-2],right:a[n],operator:a[n-1],loc:this._$};break;case 41:case 47:this.$=a[n-1]}},table:[{3:1,4:2,5:[1,4],6:3,9:13,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{1:[3]},{5:[1,21],7:32,8:h,20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v},{5:[1,34]},{1:[2,3]},t(_,[2,39]),t(_,[2,40]),{4:35,6:37,9:13,10:36,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},t(_,[2,42]),t(_,[2,43]),t(_,[2,44],{22:[1,38]}),t(_,[2,45],{17:[1,40],22:[1,39]}),t(_,[2,46]),t(E,[2,8],{31:5,27:6,26:8,21:9,16:10,11:11,19:12,23:17,4:41,12:e,17:i,24:s,25:r,28:a,29:o,30:n}),{4:42,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:43,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:44,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},t(_,[2,26]),t([5,8,15,17,18,20,22,28,29,32,33,34,35,36,37,38],[2,11]),t(_,[2,21],{25:[1,45]}),t(_,[2,25],{24:[1,46]}),{1:[2,1]},{4:47,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:48,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:49,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:50,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:51,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:52,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:53,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:54,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:55,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:56,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},t(b,[2,6],{8:x}),t(y,[2,4]),{1:[2,2]},{7:32,8:h,18:[1,58],20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v},{18:[1,59]},t(T,[2,10]),{4:60,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:61,11:11,12:e,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},{4:65,6:37,9:13,10:66,11:11,12:e,13:64,14:63,16:10,17:i,18:[1,62],19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},t(E,[2,9],{7:67,8:h,20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v}),t(w,[2,27],{20:A,32:u,33:g,34:m,35:f,36:p,37:d}),t(w,[2,28],{20:A,32:u,33:g,34:m,35:f,36:p,37:d}),t(w,[2,29],{20:A,32:u,33:g,34:m,35:f,36:p,37:d}),t(_,[2,22],{24:[1,68]}),t(_,[2,24]),t(w,[2,30],{20:A,32:u,33:g,34:m,35:f,36:p,37:d}),t(w,[2,31],{20:A,32:u,33:g,34:m,35:f,36:p,37:d}),t(S,[2,32],{20:A,34:m,35:f,36:p,37:d}),t(S,[2,33],{20:A,34:m,35:f,36:p,37:d}),t(P,[2,34],{20:A,35:f,36:p}),t(I,[2,35],{20:A}),t(I,[2,36],{20:A}),t(P,[2,37],{20:A,35:f,36:p}),t(R,[2,38],{20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v}),t(_,[2,18]),t(y,[2,5]),t(_,[2,41]),t(_,[2,47]),t(R,[2,20],{20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v}),t(R,[2,19],{20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v}),t(B,[2,16]),{15:[1,70],18:[1,69]},t(T,[2,14]),t(T,[2,12],{7:32,8:h,20:A,28:l,29:c,32:u,33:g,34:m,35:f,36:p,37:d,38:v}),t(T,[2,13]),t(b,[2,7],{8:x}),t(_,[2,23]),t(B,[2,17]),{4:65,6:37,9:13,10:66,11:11,12:e,13:71,16:10,17:i,19:12,21:9,23:17,24:s,25:r,26:8,27:6,28:a,29:o,30:n,31:5},t(T,[2,15])],defaultActions:{4:[2,3],21:[2,1],34:[2,2]},parseError:function(t,e){if(!e.recoverable){var i=new Error(t);throw i.hash=e,i}this.trace(t)},parse:function(t){var e=this,i=[0],s=[null],r=[],a=this.table,o="",n=0,h=0,A=0,l=2,c=1,u=r.slice.call(arguments,1),g=Object.create(this.lexer),m={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(m.yy[f]=this.yy[f]);g.setInput(t,m.yy),m.yy.lexer=g,m.yy.parser=this,void 0===g.yylloc&&(g.yylloc={});var p=g.yylloc;r.push(p);var d=g.options&&g.options.ranges;"function"==typeof m.yy.parseError?this.parseError=m.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var v,_,E,b,x,y,T,w,S,P=function(){var t;return"number"!=typeof(t=g.lex()||c)&&(t=e.symbols_[t]||t),t},I={};;){if(E=i[i.length-1],this.defaultActions[E]?b=this.defaultActions[E]:(null==v&&(v=P()),b=a[E]&&a[E][v]),void 0===b||!b.length||!b[0]){var R="";for(y in S=[],a[E])this.terminals_[y]&&y>l&&S.push("'"+this.terminals_[y]+"'");R=g.showPosition?"Parse error on line "+(n+1)+":\n"+g.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(n+1)+": Unexpected "+(v==c?"end of input":"'"+(this.terminals_[v]||v)+"'"),this.parseError(R,{text:g.match,token:this.terminals_[v]||v,line:g.yylineno,loc:p,expected:S})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+E+", token: "+v);switch(b[0]){case 1:i.push(v),s.push(g.yytext),r.push(g.yylloc),i.push(b[1]),v=null,_?(v=_,_=null):(h=g.yyleng,o=g.yytext,n=g.yylineno,p=g.yylloc,A>0&&A--);break;case 2:if(T=this.productions_[b[1]][1],I.$=s[s.length-T],I._$={first_line:r[r.length-(T||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(T||1)].first_column,last_column:r[r.length-1].last_column},d&&(I._$.range=[r[r.length-(T||1)].range[0],r[r.length-1].range[1]]),void 0!==(x=this.performAction.apply(I,[o,h,n,m.yy,b[1],s,r].concat(u))))return x;T&&(i=i.slice(0,-1*T*2),s=s.slice(0,-1*T),r=r.slice(0,-1*T)),i.push(this.productions_[b[1]][0]),s.push(I.$),r.push(I._$),w=a[i[i.length-2]][i[i.length-1]],i.push(w);break;case 3:return!0}}return!0}},C={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var s=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===s.length?this.yylloc.first_column:0)+s[s.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,s,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(s=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var a in r)this[a]=r[a];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,i,s;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;a<r.length;a++)if((i=this._input.match(this.rules[r[a]]))&&(!e||i[0].length>e[0].length)){if(e=i,s=a,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,r[a])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[s]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,s){switch(i){case 0:break;case 1:return 24;case 2:return 38;case 3:return 22;case 4:return 20;case 5:return 12;case 6:return 5;case 7:return e.yytext[0]}},rules:[/^(?:\s+)/,/^(?:[0-9]+)/,/^(?:(==|!=|<=|>=|<|>))/,/^(?:[+\-*/%]?=)/,/^(?:(\&\&)|\|\|)/,/^(?:[a-zA-Z_][a-zA-Z0-9._]*)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7],inclusive:!0}}};function U(){this.yy={}}return L.lexer=C,U.prototype=L,L.Parser=U,new U}();e.parser=r,e.Parser=r.Parser,e.parse=function(){return r.parse.apply(r,arguments)},e.main=function(){},i.c[i.s]===t&&e.main(s.argv.slice(1))}).call(this,i(24)(t),i(25))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){var i,s,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function n(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(t){i=a}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(t){s=o}}();var h,A=[],l=!1,c=-1;function u(){l&&h&&(l=!1,h.length?A=h.concat(A):c=-1,A.length&&g())}function g(){if(!l){var t=n(u);l=!0;for(var e=A.length;e;){for(h=A,A=[];++c<e;)h&&h[c].run();c=-1,e=A.length}h=null,l=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function f(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];A.push(new m(t,e)),1!==A.length||l||n(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};e.__esModule=!0;var r={ASSIGNMENT_EXPRESSION:[{type:"NODE",key:"right"}],SCRIPT:[{type:"ARRAY",key:"body"}],EXPRESSION_BLOCK:[{type:"ARRAY",key:"body"}],UNARY_EXPRESSION:[{type:"NODE",key:"value"}],NUMBER_LITERAL:[],IDENTIFIER:[],CALL_EXPRESSION:[{type:"ARRAY",key:"arguments"},{type:"NODE",key:"callee"}],BINARY_EXPRESSION:[{type:"NODE",key:"left"},{type:"NODE",key:"right"}],LOGICAL_EXPRESSION:[{type:"NODE",key:"left"},{type:"NODE",key:"right"}]};e.mapAst=function t(e,i){var a=r[e.type],o=e;if(null==a)throw new Error("Unknown children definition for "+e.type);return a.forEach((function(r){var a,n;if("NODE"===r.type){var h=e[r.key],A=t(h,i);A!==h&&(o=s(s({},o),((a={})[r.key]=A,a)))}else if("ARRAY"===r.type){var l=e[r.key],c=l.map((function(e){return t(e,i)}));l.some((function(t,e){return t!==c[e]}))&&(o=s(s({},o),((n={})[r.key]=c,n)))}})),i(o)}},function(t,e,i){"use strict";var s=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};e.__esModule=!0;var o=i(6),n=a(i(5)),h=i(12),A=i(14),l=i(4),c=i(7);function u(t,e){switch(t.type){case"SCRIPT":var i=t.body.map((function(t,i){return r(u(t,e),[o.op.drop])}));return l.flatten(i);case"EXPRESSION_BLOCK":return g(t.body,e);case"BINARY_EXPRESSION":var a=u(t.left,e),f=u(t.right,e);if(null==(k={"+":[o.op.f64_add],"-":[o.op.f64_sub],"*":[o.op.f64_mul],"/":e.resolveFunc("div"),"%":e.resolveFunc("mod"),"|":e.resolveFunc("bitwiseOr"),"&":e.resolveFunc("bitwiseAnd"),"^":e.resolveFunc("pow"),"==":r([o.op.f64_sub],o.IS_ZEROISH,[o.op.f64_convert_i32_s]),"!=":r([o.op.f64_sub],o.IS_NOT_ZEROISH,[o.op.f64_convert_i32_s]),"<":[o.op.f64_lt,o.op.f64_convert_i32_s],">":[o.op.f64_gt,o.op.f64_convert_i32_s],"<=":[o.op.f64_le,o.op.f64_convert_i32_s],">=":[o.op.f64_ge,o.op.f64_convert_i32_s]}[t.operator]))throw h.createCompilerError("Unknown binary expression operator "+t.operator,t.loc,e.rawSource);return r(a,f,k);case"CALL_EXPRESSION":var p=t.callee.value,d=t.arguments,v=function(i){if(d.length<i)throw h.createUserError("Too few arguments passed to `"+p+"()`. Expected "+i+" but only got "+d.length+".",t.loc,e.rawSource);if(d.length>i)throw h.createUserError("Too many arguments passed to `"+p+"()`. Expected "+i+" but got "+d.length+".",d[i].loc,e.rawSource)};switch(p){case"exec2":return v(2),g(t.arguments,e);case"exec3":return v(3),g(t.arguments,e);case"if":v(3);var _=s(t.arguments,3);return function(t,e,i,s){return r(u(t,s),o.IS_NOT_ZEROISH,o.op.if(o.BLOCK.f64),u(e,s),[o.op.else],u(i,s),[o.op.end])}(_[0],_[1],_[2],e);case"while":return v(1),function(t,e){var i=u(t,e),s=e.resolveLocal(o.VAL_TYPE.i32);return r(o.op.i32_const(0),o.op.local_set(s),o.op.loop(o.BLOCK.void),o.op.local_get(s),o.op.i32_const(1),[o.op.i32_add],o.op.local_tee(s),o.op.i32_const(c.MAX_LOOP_COUNT),[o.op.i32_lt_u],i,o.IS_NOT_ZEROISH,[o.op.i32_and],o.op.br_if(0),[o.op.end],o.op.f64_const(0))}(t.arguments[0],e);case"loop":return v(2),function(t,e,i){var s=u(e,i),a=i.resolveLocal(o.VAL_TYPE.i32);return r(o.op.block(o.BLOCK.void),u(t,i),[o.op.i32_trunc_f64_s],o.op.local_tee(a),o.op.i32_const(0),[o.op.i32_le_s],o.op.br_if(1),o.op.loop(o.BLOCK.void),s,[o.op.drop],o.op.local_get(a),o.op.i32_const(1),[o.op.i32_sub],o.op.local_tee(a),o.op.i32_const(0),[o.op.i32_ne],o.op.br_if(0),[o.op.end,o.op.end],o.op.f64_const(0))}(t.arguments[0],t.arguments[1],e);case"megabuf":case"gmegabuf":v(1);var E=e.resolveLocal(o.VAL_TYPE.i32);return r(u(t.arguments[0],e),e.resolveFunc("_getBufferIndex"),o.op.local_tee(E),o.op.i32_const(-1),[o.op.i32_ne],o.op.if(o.BLOCK.f64),o.op.local_get(E),o.op.f64_load(3,m(p)),[o.op.else],o.op.f64_const(0),[o.op.end]);case"assign":v(2);var b=t.arguments[0];if("IDENTIFIER"!=b.type)throw h.createUserError("Expected the first argument of `assign()` to be an identifier.",b.loc,e.rawSource);var x=e.resolveVar(b.value);return r(u(t.arguments[1],e),o.op.global_set(x),o.op.global_get(x))}var y=l.flatten(t.arguments.map((function(t){return u(t,e)})));switch(p){case"abs":return v(1),r(y,[o.op.f64_abs]);case"sqrt":return v(1),r(y,[o.op.f64_abs,o.op.f64_sqrt]);case"int":return v(1),r(y,[o.op.f64_floor]);case"min":return v(2),r(y,[o.op.f64_min]);case"max":return v(2),r(y,[o.op.f64_max]);case"above":return v(2),r(y,[o.op.f64_gt,o.op.f64_convert_i32_s]);case"below":return v(2),r(y,[o.op.f64_lt,o.op.f64_convert_i32_s]);case"equal":return v(2),r(y,[o.op.f64_sub],o.IS_ZEROISH,[o.op.f64_convert_i32_s]);case"bnot":return v(1),r(y,o.IS_ZEROISH,[o.op.f64_convert_i32_s]);case"floor":return v(1),r(y,[o.op.f64_floor]);case"ceil":return v(1),r(y,[o.op.f64_ceil])}var T=e.resolveFunc(p);if(null==T||p.startsWith("_"))throw h.createUserError('"'+p+'" is not defined.',t.callee.loc,e.rawSource);if(null!=n.default[p])v(n.default[p].length);else{if(null==A.localFuncMap[p])throw h.createCompilerError("Missing arity information for the function `"+p+"()`",t.callee.loc,e.rawSource);v(A.localFuncMap[p].args.length)}return r(y,T);case"ASSIGNMENT_EXPRESSION":a=t.left;var w=u(t.right,e),S=function(t,e){var i={"+=":[o.op.f64_add],"-=":[o.op.f64_sub],"*=":[o.op.f64_mul],"/=":[o.op.f64_div],"%=":e.resolveFunc("mod"),"=":null}[t.operator];if(void 0===i)throw h.createCompilerError('Unknown assignment operator "'+t.operator+'"',t.loc,e.rawSource);return i}(t,e);if("IDENTIFIER"===a.type){x=e.resolveVar(a.value);var P=o.op.global_get(x),I=o.op.global_set(x);return null===S?r(w,I,P):r(P,w,S,I,P)}if("CALL_EXPRESSION"!==a.type)throw h.createCompilerError("Unexpected left hand side type for assignment: "+a.type,t.loc,e.rawSource);var R=e.resolveLocal(o.VAL_TYPE.i32);if(1!==a.arguments.length)throw h.createUserError("Expected 1 argument when assinging to a buffer but got "+a.arguments.length+".",0===a.arguments.length?a.loc:a.arguments[1].loc,e.rawSource);var B=a.callee.value;if("gmegabuf"!==B&&"megabuf"!==B)throw h.createUserError("The only function calls which may be assigned to are `gmegabuf()` and `megabuf()`.",a.callee.loc,e.rawSource);var L=m(B);if(null===S){var C=e.resolveLocal(o.VAL_TYPE.i32),U=e.resolveLocal(o.VAL_TYPE.f64);return r(w,o.op.local_set(U),u(a.arguments[0],e),e.resolveFunc("_getBufferIndex"),o.op.local_tee(C),o.op.i32_const(0),[o.op.i32_lt_s],o.op.if(o.BLOCK.f64),o.op.f64_const(0),[o.op.else],o.op.local_get(C),o.op.local_tee(R),o.op.local_get(U),o.op.f64_store(3,L),o.op.local_get(U),[o.op.end])}E=e.resolveLocal(o.VAL_TYPE.i32);var M=e.resolveLocal(o.VAL_TYPE.i32),F=e.resolveLocal(o.VAL_TYPE.f64),Q=e.resolveLocal(o.VAL_TYPE.f64);return r(w,o.op.local_set(F),u(a.arguments[0],e),e.resolveFunc("_getBufferIndex"),o.op.local_tee(E),o.op.i32_const(-1),[o.op.i32_ne],o.op.local_tee(M),o.op.if(o.BLOCK.f64),o.op.local_get(E),o.op.f64_load(3,L),[o.op.else],o.op.f64_const(0),[o.op.end],o.op.local_get(F),S,o.op.local_tee(Q),o.op.local_get(M),o.op.if(o.BLOCK.void),o.op.local_get(E),o.op.local_get(Q),o.op.f64_store(3,L),[o.op.end]);case"LOGICAL_EXPRESSION":a=u(t.left,e),f=u(t.right,e);var V={"&&":{comparison:o.IS_ZEROISH,shortCircutValue:0},"||":{comparison:o.IS_NOT_ZEROISH,shortCircutValue:1}}[t.operator];if(null==V)throw h.createCompilerError("Unknown logical expression operator "+t.operator,t.loc,e.rawSource);var D=V.comparison,q=V.shortCircutValue;return r(a,D,o.op.if(o.BLOCK.f64),o.op.f64_const(q),[o.op.else],f,o.IS_NOT_ZEROISH,[o.op.f64_convert_i32_s,o.op.end]);case"UNARY_EXPRESSION":var k,z=u(t.value,e);if(null==(k={"-":[o.op.f64_neg],"+":[],"!":r(o.IS_ZEROISH,[o.op.f64_convert_i32_s])}[t.operator]))throw h.createCompilerError("Unknown logical unary operator "+t.operator,t.loc,e.rawSource);return r(z,k);case"IDENTIFIER":var N=t.value;return o.op.global_get(e.resolveVar(N));case"NUMBER_LITERAL":return o.op.f64_const(t.value);default:throw h.createCompilerError("Unknown AST node type "+t.type,t.loc,e.rawSource)}}function g(t,e){var i=t.map((function(t,i){return u(t,e)}));return l.flatten(l.arrayJoin(i,[o.op.drop]))}function m(t){switch(t){case"gmegabuf":return 8*c.BUFFER_SIZE;case"megabuf":return 0}}e.emit=u},function(t,e,i){"use strict";e.__esModule=!0,e.write=function(t,e){var i,s,r,a=52,o=64-a-1,n=(1<<o)-1,h=n>>1,A=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,l=0,c=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,i=n):(i=Math.floor(Math.log(e)/Math.LN2),e*(r=Math.pow(2,-i))<1&&(i--,r*=2),(e+=i+h>=1?A/r:A*Math.pow(2,1-h))*r>=2&&(i++,r/=2),i+h>=n?(s=0,i=n):i+h>=1?(s=(e*r-1)*Math.pow(2,a),i+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,a),i=0));a>=8;t[0+l]=255&s,l+=1,s/=256,a-=8);for(i=i<<a|s,o+=a;o>0;t[0+l]=255&i,l+=1,i/=256,o-=8);t[0+l-1]|=128*c}},function(t,e,i){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(r,a){function o(t){try{h(s.next(t))}catch(t){a(t)}}function n(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,n)}h((s=s.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var i,s,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function n(a){return function(n){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,n])}}},o=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};e.__esModule=!0;var h=n(i(5)),A=i(13);e.loadModule=function(t){var e=t.pools,i=t.functions,n=t.eelVersion,l=void 0===n?2:n;return r(this,void 0,void 0,(function(){var t,r,n,c;return a(this,(function(a){switch(a.label){case 0:return t={},Object.entries(e).forEach((function(e){var i=o(e,2),s=i[0],r=i[1];t[s]=new Set(Object.keys(r))})),r=A.compileModule({pools:t,functions:i,eelVersion:l}),[4,WebAssembly.compile(r)];case 1:return n=a.sent(),c=s(s({},e),{shims:h.default}),[4,WebAssembly.instantiate(n,c)];case 2:return[2,a.sent()]}}))}))}},function(t,e,i){var s=i(15);t.exports=function(t){if(Array.isArray(t))return s(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e,i){var s=i(15);t.exports=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},,function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return At}));var s=i(0),r=i.n(s),a=i(1),o=i.n(a),n=(i(18),i(19),i(8)),h=i.n(n),A=i(3),l=i.n(A),c=i(9),u=i.n(c),g=i(16);const m="undefined"!=typeof BigUint64Array,f=Symbol(),p=new TextDecoder("utf-16le");function d(t,e){const i=new Uint32Array(t)[e+-4>>>2]>>>1,s=new Uint16Array(t,e,i);return i<=32?String.fromCharCode.apply(String,s):p.decode(s)}function v(t){const e={};function i(t,e){return t?d(t.buffer,e):"<yet unknown>"}const s=t.env=t.env||{};return s.abort=s.abort||function(t,r,a,o){const n=e.memory||s.memory;throw Error(`abort: ${i(n,t)} at ${i(n,r)}:${a}:${o}`)},s.trace=s.trace||function(t,r,...a){const o=e.memory||s.memory;console.log(`trace: ${i(o,t)}${r?" ":""}${a.slice(0,r).join(", ")}`)},s.seed=s.seed||Date.now,t.Math=t.Math||Math,t.Date=t.Date||Date,e}function _(t,e){const i=e.exports,s=i.memory,r=i.table,a=i.__new,o=i.__retain,n=i.__rtti_base||-1;function h(t){const e=function(t){const e=new Uint32Array(s.buffer);if((t>>>=0)>=e[n>>>2])throw Error("invalid id: "+t);return e[(n+4>>>2)+2*t]}(t);if(!(7&e))throw Error(`not an array: ${t}, flags=${e}`);return e}function A(t){const e=new Uint32Array(s.buffer);if((t>>>=0)>=e[n>>>2])throw Error("invalid id: "+t);return e[(n+4>>>2)+2*t+1]}function l(t){return 31-Math.clz32(t>>>6&31)}function c(t,e,i){const r=s.buffer;if(i)switch(t){case 2:return new Float32Array(r);case 3:return new Float64Array(r)}else switch(t){case 0:return new(e?Int8Array:Uint8Array)(r);case 1:return new(e?Int16Array:Uint16Array)(r);case 2:return new(e?Int32Array:Uint32Array)(r);case 3:return new(e?BigInt64Array:BigUint64Array)(r)}throw Error("unsupported align: "+t)}function u(t){const e=new Uint32Array(s.buffer),i=h(e[t+-8>>>2]),r=l(i);let a=4&i?t:e[t+4>>>2];const o=2&i?e[t+12>>>2]:e[a+-4>>>2]>>>r;return c(r,2048&i,4096&i).subarray(a>>>=r,a+o)}function g(t,e,i){return new t(f(t,e,i))}function f(t,e,i){const r=s.buffer,a=new Uint32Array(r),o=a[i+4>>>2];return new t(r,o,a[o+-4>>>2]>>>e)}function p(e,i,s){t["__get"+i]=g.bind(null,e,s),t[`__get${i}View`]=f.bind(null,e,s)}return t.__newString=function(t){if(null==t)return 0;const e=t.length,i=a(e<<1,1),r=new Uint16Array(s.buffer);for(var o=0,n=i>>>1;o<e;++o)r[n+o]=t.charCodeAt(o);return i},t.__getString=function(t){if(!t)return null;const e=s.buffer;if(1!==new Uint32Array(e)[t+-8>>>2])throw Error("not a string: "+t);return d(e,t)},t.__newArray=function(t,e){const i=h(t),r=l(i),n=e.length,A=a(n<<r,4&i?t:0);let u;if(4&i)u=A;else{const e=a(2&i?16:12,t),h=new Uint32Array(s.buffer);h[e+0>>>2]=o(A),h[e+4>>>2]=A,h[e+8>>>2]=n<<r,2&i&&(h[e+12>>>2]=n),u=e}const g=c(r,2048&i,4096&i);if(16384&i)for(let t=0;t<n;++t)g[(A>>>r)+t]=o(e[t]);else g.set(e,A>>>r);return u},t.__getArrayView=u,t.__getArray=function(t){const e=u(t),i=e.length,s=new Array(i);for(let t=0;t<i;t++)s[t]=e[t];return s},t.__getArrayBuffer=function(t){const e=s.buffer,i=new Uint32Array(e)[t+-4>>>2];return e.slice(t,t+i)},[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].forEach(t=>{p(t,t.name,31-Math.clz32(t.BYTES_PER_ELEMENT))}),m&&[BigUint64Array,BigInt64Array].forEach(t=>{p(t,t.name.slice(3),3)}),t.__instanceof=function(t,e){const i=new Uint32Array(s.buffer);let r=i[t+-8>>>2];if(r<=i[n>>>2])do{if(r==e)return!0;r=A(r)}while(r);return!1},t.memory=t.memory||s,t.table=t.table||r,T(i,t)}function E(t){return"undefined"!=typeof Response&&t instanceof Response}function b(t){return t instanceof WebAssembly.Module}async function x(t,e={}){if(E(t=await t))return y(t,e);const i=b(t)?t:await WebAssembly.compile(t),s=v(e),r=await WebAssembly.instantiate(i,e);return{module:i,instance:r,exports:_(s,r)}}async function y(t,e={}){if(!WebAssembly.instantiateStreaming)return x(E(t=await t)?t.arrayBuffer():t,e);const i=v(e),s=await WebAssembly.instantiateStreaming(t,e),r=_(i,s.instance);return{...s,exports:r}}function T(t,e={}){const i=t.__argumentsLength?e=>{t.__argumentsLength.value=e}:t.__setArgumentsLength||t.__setargc||(()=>{});for(let s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const r=t[s];let a=s.split("."),o=e;for(;a.length>1;){let t=a.shift();Object.prototype.hasOwnProperty.call(o,t)||(o[t]={}),o=o[t]}let n=a[0],h=n.indexOf("#");if(h>=0){const e=n.substring(0,h),a=o[e];if(void 0===a||!a.prototype){const t=function(...e){return t.wrap(t.prototype.constructor(0,...e))};t.prototype={valueOf(){return this[f]}},t.wrap=function(e){return Object.create(t.prototype,{[f]:{value:e,writable:!1}})},a&&Object.getOwnPropertyNames(a).forEach(e=>Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))),o[e]=t}if(n=n.substring(h+1),o=o[e].prototype,/^(get|set):/.test(n)){if(!Object.prototype.hasOwnProperty.call(o,n=n.substring(4))){let e=t[s.replace("set:","get:")],i=t[s.replace("get:","set:")];Object.defineProperty(o,n,{get(){return e(this[f])},set(t){i(this[f],t)},enumerable:!0})}}else"constructor"===n?(o[n]=(...t)=>(i(t.length),r(...t))).original=r:(o[n]=function(...t){return i(t.length),r(this[f],...t)}).original=r}else/^(get|set):/.test(n)?Object.prototype.hasOwnProperty.call(o,n=n.substring(4))||Object.defineProperty(o,n,{get:t[s.replace("set:","get:")],set:t[s.replace("get:","set:")],enumerable:!0}):"function"==typeof r&&r!==i?(o[n]=(...t)=>(i(t.length),r(...t))).original=r:o[n]=r}return e}var w={instantiate:x,instantiateSync:function(t,e={}){const i=b(t)?t:new WebAssembly.Module(t),s=v(e),r=new WebAssembly.Instance(i,e);return{module:i,instance:r,exports:_(s,r)}},instantiateStreaming:y,demangle:T},S=function(){function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r()(this,t),this.samplesIn=e,this.samplesOut=i,this.equalize=s,this.NFREQ=2*i,this.equalize&&this.initEqualizeTable(),this.initBitRevTable(),this.initCosSinTable()}return o()(t,[{key:"initEqualizeTable",value:function(){this.equalizeArr=new Float32Array(this.samplesOut);for(var t=1/this.samplesOut,e=0;e<this.samplesOut;e++)this.equalizeArr[e]=-.02*Math.log((this.samplesOut-e)*t)}},{key:"initBitRevTable",value:function(){this.bitrevtable=new Uint16Array(this.NFREQ);for(var t=0;t<this.NFREQ;t++)this.bitrevtable[t]=t;for(var e=0,i=0;i<this.NFREQ;i++){if(e>i){var s=this.bitrevtable[i];this.bitrevtable[i]=this.bitrevtable[e],this.bitrevtable[e]=s}for(var r=this.NFREQ>>1;r>=1&&e>=r;)e-=r,r>>=1;e+=r}}},{key:"initCosSinTable",value:function(){for(var t=2,e=0;t<=this.NFREQ;)e+=1,t<<=1;this.cossintable=[new Float32Array(e),new Float32Array(e)],t=2;for(var i=0;t<=this.NFREQ;){var s=-2*Math.PI/t;this.cossintable[0][i]=Math.cos(s),this.cossintable[1][i]=Math.sin(s),i+=1,t<<=1}}},{key:"timeToFrequencyDomain",value:function(t){for(var e=new Float32Array(this.NFREQ),i=new Float32Array(this.NFREQ),s=0;s<this.NFREQ;s++){var r=this.bitrevtable[s];r<this.samplesIn?e[s]=t[r]:e[s]=0,i[s]=0}for(var a=2,o=0;a<=this.NFREQ;){for(var n=this.cossintable[0][o],h=this.cossintable[1][o],A=1,l=0,c=a>>1,u=0;u<c;u++){for(var g=u;g<this.NFREQ;g+=a){var m=g+c,f=A*e[m]-l*i[m],p=A*i[m]+l*e[m];e[m]=e[g]-f,i[m]=i[g]-p,e[g]+=f,i[g]+=p}var d=A;A=d*n-l*h,l=l*n+d*h}a<<=1,o+=1}var v=new Float32Array(this.samplesOut);if(this.equalize)for(var _=0;_<this.samplesOut;_++)v[_]=this.equalizeArr[_]*Math.sqrt(e[_]*e[_]+i[_]*i[_]);else for(var E=0;E<this.samplesOut;E++)v[E]=Math.sqrt(e[E]*e[E]+i[E]*i[E]);return v}}]),t}(),P=function(){function t(e){r()(this,t),this.numSamps=512,this.fftSize=2*this.numSamps,this.fft=new S(this.fftSize,512,!0),e&&(this.audioContext=e,this.audible=e.createDelay(),this.analyser=e.createAnalyser(),this.analyser.smoothingTimeConstant=0,this.analyser.fftSize=this.fftSize,this.audible.connect(this.analyser),this.analyserL=e.createAnalyser(),this.analyserL.smoothingTimeConstant=0,this.analyserL.fftSize=this.fftSize,this.analyserR=e.createAnalyser(),this.analyserR.smoothingTimeConstant=0,this.analyserR.fftSize=this.fftSize,this.splitter=e.createChannelSplitter(2),this.audible.connect(this.splitter),this.splitter.connect(this.analyserL,0),this.splitter.connect(this.analyserR,1)),this.timeByteArray=new Uint8Array(this.fftSize),this.timeByteArrayL=new Uint8Array(this.fftSize),this.timeByteArrayR=new Uint8Array(this.fftSize),this.timeArray=new Int8Array(this.fftSize),this.timeByteArraySignedL=new Int8Array(this.fftSize),this.timeByteArraySignedR=new Int8Array(this.fftSize),this.tempTimeArrayL=new Int8Array(this.fftSize),this.tempTimeArrayR=new Int8Array(this.fftSize),this.timeArrayL=new Int8Array(this.numSamps),this.timeArrayR=new Int8Array(this.numSamps)}return o()(t,[{key:"sampleAudio",value:function(){this.analyser.getByteTimeDomainData(this.timeByteArray),this.analyserL.getByteTimeDomainData(this.timeByteArrayL),this.analyserR.getByteTimeDomainData(this.timeByteArrayR),this.processAudio()}},{key:"updateAudio",value:function(t,e,i){this.timeByteArray.set(t),this.timeByteArrayL.set(e),this.timeByteArrayR.set(i),this.processAudio()}},{key:"processAudio",value:function(){for(var t=0,e=0,i=0;t<this.fftSize;t++)this.timeArray[t]=this.timeByteArray[t]-128,this.timeByteArraySignedL[t]=this.timeByteArrayL[t]-128,this.timeByteArraySignedR[t]=this.timeByteArrayR[t]-128,this.tempTimeArrayL[t]=.5*(this.timeByteArraySignedL[t]+this.timeByteArraySignedL[i]),this.tempTimeArrayR[t]=.5*(this.timeByteArraySignedR[t]+this.timeByteArraySignedR[i]),t%2==0&&(this.timeArrayL[e]=this.tempTimeArrayL[t],this.timeArrayR[e]=this.tempTimeArrayR[t],e+=1),i=t;this.freqArray=this.fft.timeToFrequencyDomain(this.timeArray),this.freqArrayL=this.fft.timeToFrequencyDomain(this.timeByteArraySignedL),this.freqArrayR=this.fft.timeToFrequencyDomain(this.timeByteArraySignedR)}},{key:"connectAudio",value:function(t){t.connect(this.audible)}},{key:"disconnectAudio",value:function(t){t.disconnect(this.audible)}}]),t}(),I=function(){function t(e){r()(this,t),this.audio=e;var i=(this.audio.audioContext?this.audio.audioContext.sampleRate:44100)/this.audio.fftSize,s=Math.clamp(Math.round(20/i)-1,0,this.audio.numSamps-1),a=Math.clamp(Math.round(320/i)-1,0,this.audio.numSamps-1),o=Math.clamp(Math.round(2800/i)-1,0,this.audio.numSamps-1),n=Math.clamp(Math.round(11025/i)-1,0,this.audio.numSamps-1);this.starts=[s,a,o],this.stops=[a,o,n],this.val=new Float32Array(3),this.imm=new Float32Array(3),this.att=new Float32Array(3),this.avg=new Float32Array(3),this.longAvg=new Float32Array(3),this.att.fill(1),this.avg.fill(1),this.longAvg.fill(1)}return o()(t,[{key:"updateAudioLevels",value:function(e,i){if(this.audio.freqArray.length>0){var s=e;!t.isFiniteNumber(s)||s<15?s=15:s>144&&(s=144),this.imm.fill(0);for(var r=0;r<3;r++)for(var a=this.starts[r];a<this.stops[r];a++)this.imm[r]+=this.audio.freqArray[a];for(var o=0;o<3;o++){var n=void 0;n=this.imm[o]>this.avg[o]?.2:.5,n=t.adjustRateToFPS(n,30,s),this.avg[o]=this.avg[o]*n+this.imm[o]*(1-n),n=i<50?.9:.992,n=t.adjustRateToFPS(n,30,s),this.longAvg[o]=this.longAvg[o]*n+this.imm[o]*(1-n),this.longAvg[o]<.001?(this.val[o]=1,this.att[o]=1):(this.val[o]=this.imm[o]/this.longAvg[o],this.att[o]=this.avg[o]/this.longAvg[o])}}}},{key:"bass",get:function(){return this.val[0]}},{key:"bass_att",get:function(){return this.att[0]}},{key:"mid",get:function(){return this.val[1]}},{key:"mid_att",get:function(){return this.att[1]}},{key:"treb",get:function(){return this.val[2]}},{key:"treb_att",get:function(){return this.att[2]}}],[{key:"isFiniteNumber",value:function(t){return Number.isFinite(t)&&!Number.isNaN(t)}},{key:"adjustRateToFPS",value:function(t,e,i){return Math.pow(t,e/i)}}]),t}(),R=i(10),B=i.n(R),L=i(2),C=i.n(L),U=function(){function t(){r()(this,t)}return o()(t,null,[{key:"atan2",value:function(t,e){var i=Math.atan2(t,e);return i<0&&(i+=2*Math.PI),i}},{key:"cloneVars",value:function(t){return Object.assign({},t)}},{key:"range",value:function(t,e){return void 0===e?C()(Array(t).keys()):Array.from({length:e-t},(function(e,i){return i+t}))}},{key:"pick",value:function(t,e){for(var i={},s=0;s<e.length;s++){var r=e[s];i[r]=t[r]||0}return i}},{key:"omit",value:function(t,e){for(var i=Object.assign({},t),s=0;s<e.length;s++){delete i[e[s]]}return i}},{key:"setWasm",value:function(t,e,i){for(var s=0;s<i.length;s++){var r=i[s];t[r].value=e[r]}}},{key:"pickWasm",value:function(t,e){for(var i={},s=0;s<e.length;s++){var r=e[s];i[r]=t[r].value}return i}}]),t}(),M=function(){function t(e,i,s){r()(this,t),this.preset=e,this.texsizeX=s.texsizeX,this.texsizeY=s.texsizeY,this.mesh_width=s.mesh_width,this.mesh_height=s.mesh_height,this.aspectx=s.aspectx,this.aspecty=s.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.qs=U.range(1,33).map((function(t){return"q".concat(t)})),this.ts=U.range(1,9).map((function(t){return"t".concat(t)})),this.regs=U.range(100).map((function(t){return t<10?"reg0".concat(t):"reg".concat(t)})),this.initializeEquations(i)}return o()(t,[{key:"initializeEquations",value:function(t){this.runVertEQs=""!==this.preset.pixel_eqs,this.mdVSQInit=null,this.mdVSRegs=null,this.mdVSFrame=null,this.mdVSUserKeys=null,this.mdVSFrameMap=null,this.mdVSShapes=null,this.mdVSUserKeysShapes=null,this.mdVSFrameMapShapes=null,this.mdVSWaves=null,this.mdVSUserKeysWaves=null,this.mdVSFrameMapWaves=null,this.mdVSQAfterFrame=null,this.gmegabuf=new Array(1048576).fill(0);var e={frame:t.frame,time:t.time,fps:t.fps,bass:t.bass,bass_att:t.bass_att,mid:t.mid,mid_att:t.mid_att,treb:t.treb,treb_att:t.treb_att,meshx:this.mesh_width,meshy:this.mesh_height,aspectx:this.invAspectx,aspecty:this.invAspecty,pixelsx:this.texsizeX,pixelsy:this.texsizeY,gmegabuf:this.gmegabuf};this.mdVS=Object.assign({},this.preset.baseVals,e),this.mdVS.megabuf=new Array(1048576).fill(0),this.mdVS.rand_start=new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()]),this.mdVS.rand_preset=new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()]);var i=this.qs.concat(this.regs,Object.keys(this.mdVS)),s=this.preset.init_eqs(U.cloneVars(this.mdVS));this.mdVSQInit=U.pick(s,this.qs),this.mdVSRegs=U.pick(s,this.regs);var r=U.pick(s,Object.keys(U.omit(s,i)));if(r.megabuf=s.megabuf,r.gmegabuf=s.gmegabuf,this.mdVSFrame=this.preset.frame_eqs(Object.assign({},this.mdVS,this.mdVSQInit,this.mdVSRegs,r)),this.mdVSUserKeys=Object.keys(U.omit(this.mdVSFrame,i)),this.mdVSFrameMap=U.pick(this.mdVSFrame,this.mdVSUserKeys),this.mdVSQAfterFrame=U.pick(this.mdVSFrame,this.qs),this.mdVSRegs=U.pick(this.mdVSFrame,this.regs),this.mdVSWaves=[],this.mdVSTWaveInits=[],this.mdVSUserKeysWaves=[],this.mdVSFrameMapWaves=[],this.preset.waves&&this.preset.waves.length>0)for(var a=0;a<this.preset.waves.length;a++){var o=this.preset.waves[a],n=o.baseVals;if(0!==n.enabled){var h=Object.assign({},n,e),A=this.qs.concat(this.ts,this.regs,Object.keys(h));Object.assign(h,this.mdVSQAfterFrame,this.mdVSRegs),h.megabuf=new Array(1048576).fill(0),o.init_eqs&&(h=o.init_eqs(h),this.mdVSRegs=U.pick(h,this.regs),Object.assign(h,n)),this.mdVSWaves.push(h),this.mdVSTWaveInits.push(U.pick(h,this.ts)),this.mdVSUserKeysWaves.push(Object.keys(U.omit(h,A))),this.mdVSFrameMapWaves.push(U.pick(h,this.mdVSUserKeysWaves[a]))}else this.mdVSWaves.push({}),this.mdVSTWaveInits.push({}),this.mdVSUserKeysWaves.push([]),this.mdVSFrameMapWaves.push({})}if(this.mdVSShapes=[],this.mdVSTShapeInits=[],this.mdVSUserKeysShapes=[],this.mdVSFrameMapShapes=[],this.preset.shapes&&this.preset.shapes.length>0)for(var l=0;l<this.preset.shapes.length;l++){var c=this.preset.shapes[l],u=c.baseVals;if(0!==u.enabled){var g=Object.assign({},u,e),m=this.qs.concat(this.ts,this.regs,Object.keys(g));Object.assign(g,this.mdVSQAfterFrame,this.mdVSRegs),g.megabuf=new Array(1048576).fill(0),c.init_eqs&&(g=c.init_eqs(g),this.mdVSRegs=U.pick(g,this.regs),Object.assign(g,u)),this.mdVSShapes.push(g),this.mdVSTShapeInits.push(U.pick(g,this.ts)),this.mdVSUserKeysShapes.push(Object.keys(U.omit(g,m))),this.mdVSFrameMapShapes.push(U.pick(g,this.mdVSUserKeysShapes[l]))}else this.mdVSShapes.push({}),this.mdVSTShapeInits.push({}),this.mdVSUserKeysShapes.push([]),this.mdVSFrameMapShapes.push({})}}},{key:"updatePreset",value:function(t,e){this.preset=t,this.initializeEquations(e)}},{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"runFrameEquations",value:function(t){return this.mdVSFrame=Object.assign({},this.mdVS,this.mdVSQInit,this.mdVSFrameMap,t),this.mdVSFrame=this.preset.frame_eqs(this.mdVSFrame),this.mdVSFrameMap=U.pick(this.mdVSFrame,this.mdVSUserKeys),this.mdVSQAfterFrame=U.pick(this.mdVSFrame,this.qs),this.mdVSFrame}},{key:"runPixelEquations",value:function(t){return this.preset.pixel_eqs(t)}},{key:"runShapeFrameEquations",value:function(t,e){return this.preset.shapes[t].frame_eqs(e)}},{key:"runWaveFrameEquations",value:function(t,e){return this.preset.waves[t].frame_eqs(e)}},{key:"runWavePointEquations",value:function(t,e){return this.preset.waves[t].point_eqs(e)}}]),t}(),F=function(){function t(e,i,s){r()(this,t),this.preset=e,this.texsizeX=s.texsizeX,this.texsizeY=s.texsizeY,this.mesh_width=s.mesh_width,this.mesh_height=s.mesh_height,this.aspectx=s.aspectx,this.aspecty=s.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.qs=U.range(1,33).map((function(t){return"q".concat(t)})),this.ts=U.range(1,9).map((function(t){return"t".concat(t)})),this.regs=U.range(100).map((function(t){return t<10?"reg0".concat(t):"reg".concat(t)})),this.globalKeys=["frame","time","fps","bass","bass_att","mid","mid_att","treb","treb_att","meshx","meshy","aspectx","aspecty","pixelsx","pixelsy"],this.frameKeys=["decay","wave_a","wave_r","wave_g","wave_b","wave_x","wave_y","wave_scale","wave_smoothing","wave_mode","old_wave_mode","wave_mystery","ob_size","ob_r","ob_g","ob_b","ob_a","ib_size","ib_r","ib_g","ib_b","ib_a","mv_x","mv_y","mv_dx","mv_dy","mv_l","mv_r","mv_g","mv_b","mv_a","echo_zoom","echo_alpha","echo_orient","wave_dots","wave_thick","additivewave","wave_brighten","modwavealphabyvolume","modwavealphastart","modwavealphaend","darken_center","gammaadj","warp","warpanimspeed","warpscale","zoom","zoomexp","rot","cx","cy","dx","dy","sx","sy","fshader","wrap","invert","brighten","darken","solarize","bmotionvectorson","b1n","b2n","b3n","b1x","b2x","b3x","b1ed"],this.waveFrameKeys=["samples","sep","scaling","spectrum","smoothing","r","g","b","a"],this.waveFrameInputKeys=["samples","r","g","b","a"],this.initializeEquations(i)}return o()(t,[{key:"getQVars",value:function(t){return U.pickWasm(this.preset.globalPools[t],this.qs)}},{key:"getTVars",value:function(t){return U.pickWasm(this.preset.globalPools[t],this.ts)}},{key:"initializeEquations",value:function(t){this.runVertEQs=!!this.preset.pixel_eqs,this.mdVSQInit=null,this.mdVSQAfterFrame=null;var e={frame:t.frame,time:t.time,fps:t.fps,bass:t.bass,bass_att:t.bass_att,mid:t.mid,mid_att:t.mid_att,treb:t.treb,treb_att:t.treb_att,meshx:this.mesh_width,meshy:this.mesh_height,aspectx:this.invAspectx,aspecty:this.invAspecty,pixelsx:this.texsizeX,pixelsy:this.texsizeY};if(this.mdVS=Object.assign({},this.preset.baseVals,e),U.setWasm(this.preset.globalPools.perFrame,this.mdVS,Object.keys(this.mdVS)),this.rand_start=new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()]),this.rand_preset=new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()]),this.preset.init_eqs(),this.mdVSQInit=this.getQVars("perFrame"),this.preset.frame_eqs(),this.mdVSQAfterFrame=this.getQVars("perFrame"),this.mdVSTWaveInits=[],this.preset.waves&&this.preset.waves.length>0)for(var i=0;i<this.preset.waves.length;i++){var s=this.preset.waves[i],r=s.baseVals;0!==r.enabled?(U.setWasm(this.preset.globalPools["wavePerFrame".concat(i)],r,Object.keys(r)),s.init_eqs&&(s.init_eqs(),U.setWasm(this.preset.globalPools["wavePerFrame".concat(i)],r,Object.keys(r))),this.mdVSTWaveInits.push(this.getTVars("wavePerFrame".concat(i)))):this.mdVSTWaveInits.push({})}if(this.mdVSTShapeInits=[],this.preset.shapes&&this.preset.shapes.length>0)for(var a=0;a<this.preset.shapes.length;a++){var o=this.preset.shapes[a],n=o.baseVals;0!==n.enabled?(U.setWasm(this.preset.globalPools["shapePerFrame".concat(a)],n,Object.keys(n)),o.init_eqs&&(o.init_eqs(),U.setWasm(this.preset.globalPools["shapePerFrame".concat(a)],n,Object.keys(n))),this.mdVSTShapeInits.push(this.getTVars("shapePerFrame".concat(a)))):this.mdVSTShapeInits.push({})}}},{key:"updatePreset",value:function(t,e){this.preset=t,this.initializeEquations(e)}},{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"runFrameEquations",value:function(t){U.setWasm(this.preset.globalPools.perFrame,this.mdVS,this.frameKeys),U.setWasm(this.preset.globalPools.perFrame,this.mdVSQInit,this.qs),U.setWasm(this.preset.globalPools.perFrame,t,this.globalKeys),this.preset.frame_eqs(),this.preset.save_qs(),this.mdVSQAfterFrame=this.getQVars("perFrame");var e=U.pickWasm(this.preset.globalPools.perFrame,[].concat(C()(this.frameKeys),C()(this.globalKeys)));return e.rand_preset=this.rand_preset,e.rand_start=this.rand_start,e}},{key:"runWaveFrameEquations",value:function(t,e){var i=this.preset.waves[t].baseVals;return U.setWasm(this.preset.globalPools["wavePerFrame".concat(t)],i,this.waveFrameInputKeys),U.setWasm(this.preset.globalPools["wavePerFrame".concat(t)],this.mdVSQAfterFrame,this.qs),U.setWasm(this.preset.globalPools["wavePerFrame".concat(t)],this.mdVSTWaveInits[t],this.ts),U.setWasm(this.preset.globalPools["wavePerFrame".concat(t)],e,this.globalKeys),this.preset.waves[t].frame_eqs(),U.pickWasm(this.preset.globalPools["wavePerFrame".concat(t)],this.waveFrameKeys)}}]),t}(),Q=/uniform sampler2D sampler_(?:.+?);/g,V=/uniform sampler2D sampler_(.+?);/,D=function(){function t(){r()(this,t)}return o()(t,null,[{key:"getShaderParts",value:function(t){var e=t.indexOf("shader_body");if(t&&e>-1){var i=t.substring(0,e),s=t.substring(e),r=s.indexOf("{"),a=s.lastIndexOf("}");return[i,s.substring(r+1,a)]}return["",t]}},{key:"getFragmentFloatPrecision",value:function(t){return t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0?"highp":t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}},{key:"getUserSamplers",value:function(t){var e=[],i=t.match(Q);if(i&&i.length>0)for(var s=0;s<i.length;s++){var r=i[s].match(V);if(r&&r.length>0){var a=r[1];e.push({sampler:a})}}return e}}]),t}(),q=function(){function t(){r()(this,t)}return o()(t,null,[{key:"smoothWave",value:function(t,e,i){for(var s,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=-.15,o=1.15,n=1.15,h=-.15,A=1/(a+o+n+h),l=0,c=0,u=1,g=0;g<i-1;g++){s=u,u=Math.min(i-1,g+2);for(var m=0;m<3;m++)e[3*l+m]=t[3*g+m];if(r)for(var f=0;f<3;f++)e[3*(l+1)+f]=(a*t[3*c+f]+o*t[3*g+f]+n*t[3*s+f]+h*t[3*u+f])*A;else{for(var p=0;p<2;p++)e[3*(l+1)+p]=(a*t[3*c+p]+o*t[3*g+p]+n*t[3*s+p]+h*t[3*u+p])*A;e[3*(l+1)+2]=0}c=g,l+=2}for(var d=0;d<3;d++)e[3*l+d]=t[3*(i-1)+d]}},{key:"smoothWaveAndColor",value:function(t,e,i,s,r){for(var a,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=-.15,h=1.15,A=1.15,l=-.15,c=1/(n+h+A+l),u=0,g=0,m=1,f=0;f<r-1;f++){a=m,m=Math.min(r-1,f+2);for(var p=0;p<3;p++)i[3*u+p]=t[3*f+p];if(o)for(var d=0;d<3;d++)i[3*(u+1)+d]=(n*t[3*g+d]+h*t[3*f+d]+A*t[3*a+d]+l*t[3*m+d])*c;else{for(var v=0;v<2;v++)i[3*(u+1)+v]=(n*t[3*g+v]+h*t[3*f+v]+A*t[3*a+v]+l*t[3*m+v])*c;i[3*(u+1)+2]=0}for(var _=0;_<4;_++)s[4*u+_]=e[4*f+_],s[4*(u+1)+_]=e[4*f+_];g=f,u+=2}for(var E=0;E<3;E++)i[3*u+E]=t[3*(r-1)+E];for(var b=0;b<4;b++)s[4*u+b]=e[4*(r-1)+b]}}]),t}(),k=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r()(this,t),this.gl=e;var s=512;this.positions=new Float32Array(3*s),this.positions2=new Float32Array(3*s),this.oldPositions=new Float32Array(3*s),this.oldPositions2=new Float32Array(3*s),this.smoothedPositions=new Float32Array(3*(2*s-1)),this.smoothedPositions2=new Float32Array(3*(2*s-1)),this.color=[0,0,0,1],this.texsizeX=i.texsizeX,this.texsizeY=i.texsizeY,this.aspectx=i.aspectx,this.aspecty=i.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader(),this.vertexBuf=this.gl.createBuffer()}return o()(t,[{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      in vec3 aPos;\n      uniform vec2 thickOffset;\n      void main(void) {\n        gl_Position = vec4(aPos + vec3(thickOffset, 0.0), 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      out vec4 fragColor;\n      uniform vec4 u_color;\n      void main(void) {\n        fragColor = u_color;\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.aPosLoc=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.colorLoc=this.gl.getUniformLocation(this.shaderProgram,"u_color"),this.thickOffsetLoc=this.gl.getUniformLocation(this.shaderProgram,"thickOffset")}},{key:"generateWaveform",value:function(e,i,s,r,a){var o=a.wave_a,n=(a.bass+a.mid+a.treb)/3;if(n>-.01&&o>.001&&s.length>0){var h=t.processWaveform(s,a),A=t.processWaveform(r,a),l=Math.floor(a.wave_mode)%8,c=Math.floor(a.old_wave_mode)%8,u=2*a.wave_x-1,g=2*a.wave_y-1;this.numVert=0,this.oldNumVert=0;for(var m=e&&l!==c?2:1,f=0;f<m;f++){var p=0===f?l:c,d=a.wave_mystery;0!==p&&1!==p&&4!==p||!(d<-1||d>1)||(d=.5*d+.5,d-=Math.floor(d),d=2*(d=Math.abs(d))-1);var v=void 0,_=void 0,E=void 0;if(0===f?(_=this.positions,E=this.positions2):(_=this.oldPositions,E=this.oldPositions2),o=a.wave_a,0===p){if(a.modwavealphabyvolume>0){var b=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/b}o=Math.clamp(o,0,1);for(var x=1/((v=Math.floor(h.length/2)+1)-1),y=Math.floor((h.length-v)/2),T=0;T<v-1;T++){var w=.5+.4*A[T+y]+d,S=T*x*2*Math.PI+.2*a.time;if(T<v/10){var P=T/(.1*v);w=(1-(P=.5-.5*Math.cos(P*Math.PI)))*(.5+.4*A[T+v+y]+d)+w*P}_[3*T+0]=w*Math.cos(S)*this.aspecty+u,_[3*T+1]=w*Math.sin(S)*this.aspectx+g,_[3*T+2]=0}_[3*(v-1)+0]=_[0],_[3*(v-1)+1]=_[1],_[3*(v-1)+2]=0}else if(1===p){if(o*=1.25,a.modwavealphabyvolume>0){var I=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/I}o=Math.clamp(o,0,1),v=Math.floor(h.length/2);for(var R=0;R<v;R++){var B=.53+.43*A[R]+d,L=.5*h[R+32]*Math.PI+2.3*a.time;_[3*R+0]=B*Math.cos(L)*this.aspecty+u,_[3*R+1]=B*Math.sin(L)*this.aspectx+g,_[3*R+2]=0}}else if(2===p){if(this.texsizeX<1024?o*=.09:this.texsizeX>=1024&&this.texsizeX<2048?o*=.11:o*=.13,a.modwavealphabyvolume>0){var C=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/C}o=Math.clamp(o,0,1),v=h.length;for(var U=0;U<h.length;U++)_[3*U+0]=A[U]*this.aspecty+u,_[3*U+1]=h[(U+32)%h.length]*this.aspectx+g,_[3*U+2]=0}else if(3===p){if(this.texsizeX<1024?o*=.15:this.texsizeX>=1024&&this.texsizeX<2048?o*=.22:o*=.33,o*=1.3,o*=a.treb*a.treb,a.modwavealphabyvolume>0){var M=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/M}o=Math.clamp(o,0,1),v=h.length;for(var F=0;F<h.length;F++)_[3*F+0]=A[F]*this.aspecty+u,_[3*F+1]=h[(F+32)%h.length]*this.aspectx+g,_[3*F+2]=0}else if(4===p){if(a.modwavealphabyvolume>0){var Q=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/Q}o=Math.clamp(o,0,1),(v=h.length)>this.texsizeX/3&&(v=Math.floor(this.texsizeX/3));for(var V=1/v,D=Math.floor((h.length-v)/2),k=.45+.5*(.5*d+.5),z=1-k,N=0;N<v;N++){var X=2*N*V+(u-1)+.44*A[(N+25+D)%h.length],O=.47*h[N+D]+g;N>1&&(X=X*z+k*(2*_[3*(N-1)+0]-_[3*(N-2)+0]),O=O*z+k*(2*_[3*(N-1)+1]-_[3*(N-2)+1])),_[3*N+0]=X,_[3*N+1]=O,_[3*N+2]=0}}else if(5===p){if(this.texsizeX<1024?o*=.09:this.texsizeX>=1024&&this.texsizeX<2048?o*=.11:o*=.13,a.modwavealphabyvolume>0){var G=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/G}o=Math.clamp(o,0,1);var Y=Math.cos(.3*a.time),W=Math.sin(.3*a.time);v=h.length;for(var j=0;j<h.length;j++){var J=(j+32)%h.length,K=A[j]*h[J]+h[j]*A[J],H=A[j]*A[j]-h[J]*h[J];_[3*j+0]=(K*Y-H*W)*(this.aspecty+u),_[3*j+1]=(K*W+H*Y)*(this.aspectx+g),_[3*j+2]=0}}else if(6===p||7===p){if(a.modwavealphabyvolume>0){var Z=a.modwavealphaend-a.modwavealphastart;o*=(n-a.modwavealphastart)/Z}o=Math.clamp(o,0,1),(v=Math.floor(h.length/2))>this.texsizeX/3&&(v=Math.floor(this.texsizeX/3));for(var $=Math.floor((h.length-v)/2),tt=.5*Math.PI*d,et=Math.cos(tt),it=Math.sin(tt),st=[u*Math.cos(tt+.5*Math.PI)-3*et,u*Math.cos(tt+.5*Math.PI)+3*et],rt=[u*Math.sin(tt+.5*Math.PI)-3*it,u*Math.sin(tt+.5*Math.PI)+3*it],at=0;at<2;at++)for(var ot=0;ot<4;ot++){var nt=void 0,ht=!1;switch(ot){case 0:st[at]>1.1&&(nt=(1.1-st[1-at])/(st[at]-st[1-at]),ht=!0);break;case 1:st[at]<-1.1&&(nt=(-1.1-st[1-at])/(st[at]-st[1-at]),ht=!0);break;case 2:rt[at]>1.1&&(nt=(1.1-rt[1-at])/(rt[at]-rt[1-at]),ht=!0);break;case 3:rt[at]<-1.1&&(nt=(-1.1-rt[1-at])/(rt[at]-rt[1-at]),ht=!0)}if(ht){var At=st[at]-st[1-at],lt=rt[at]-rt[1-at];st[at]=st[1-at]+At*nt,rt[at]=rt[1-at]+lt*nt}}et=(st[1]-st[0])/v,it=(rt[1]-rt[0])/v;var ct=Math.atan2(it,et),ut=Math.cos(ct+.5*Math.PI),gt=Math.sin(ct+.5*Math.PI);if(6===p)for(var mt=0;mt<v;mt++){var ft=h[mt+$];_[3*mt+0]=st[0]+et*mt+.25*ut*ft,_[3*mt+1]=rt[0]+it*mt+.25*gt*ft,_[3*mt+2]=0}else if(7===p){for(var pt=Math.pow(.5*g+.5,2),dt=0;dt<v;dt++){var vt=h[dt+$];_[3*dt+0]=st[0]+et*dt+ut*(.25*vt+pt),_[3*dt+1]=rt[0]+it*dt+gt*(.25*vt+pt),_[3*dt+2]=0}for(var _t=0;_t<v;_t++){var Et=A[_t+$];E[3*_t+0]=st[0]+et*_t+ut*(.25*Et-pt),E[3*_t+1]=rt[0]+it*_t+gt*(.25*Et-pt),E[3*_t+2]=0}}}0===f?(this.positions=_,this.positions2=E,this.numVert=v,this.alpha=o):(this.oldPositions=_,this.oldPositions2=E,this.oldNumVert=v,this.oldAlpha=o)}var bt=.5-.5*Math.cos(i*Math.PI),xt=1-bt;this.oldNumVert>0&&(o=bt*this.alpha+xt*this.oldAlpha);var yt=Math.clamp(a.wave_r,0,1),Tt=Math.clamp(a.wave_g,0,1),wt=Math.clamp(a.wave_b,0,1);if(0!==a.wave_brighten){var St=Math.max(yt,Tt,wt);St>.01&&(yt/=St,Tt/=St,wt/=St)}if(this.color=[yt,Tt,wt,o],this.oldNumVert>0)if(7===l){for(var Pt=(this.oldNumVert-1)/(2*this.numVert),It=0;It<this.numVert;It++){var Rt=It*Pt,Bt=Math.floor(Rt),Lt=Rt-Bt,Ct=this.oldPositions[3*Bt+0]*(1-Lt)+this.oldPositions[3*(Bt+1)+0]*Lt,Ut=this.oldPositions[3*Bt+1]*(1-Lt)+this.oldPositions[3*(Bt+1)+1]*Lt;this.positions[3*It+0]=this.positions[3*It+0]*bt+Ct*xt,this.positions[3*It+1]=this.positions[3*It+1]*bt+Ut*xt,this.positions[3*It+2]=0}for(var Mt=0;Mt<this.numVert;Mt++){var Ft=(Mt+this.numVert)*Pt,Qt=Math.floor(Ft),Vt=Ft-Qt,Dt=this.oldPositions[3*Qt+0]*(1-Vt)+this.oldPositions[3*(Qt+1)+0]*Vt,qt=this.oldPositions[3*Qt+1]*(1-Vt)+this.oldPositions[3*(Qt+1)+1]*Vt;this.positions2[3*Mt+0]=this.positions2[3*Mt+0]*bt+Dt*xt,this.positions2[3*Mt+1]=this.positions2[3*Mt+1]*bt+qt*xt,this.positions2[3*Mt+2]=0}}else if(7===c){for(var kt=this.numVert/2,zt=(this.oldNumVert-1)/kt,Nt=0;Nt<kt;Nt++){var Xt=Nt*zt,Ot=Math.floor(Xt),Gt=Xt-Ot,Yt=this.oldPositions[3*Ot+0]*(1-Gt)+this.oldPositions[3*(Ot+1)+0]*Gt,Wt=this.oldPositions[3*Ot+1]*(1-Gt)+this.oldPositions[3*(Ot+1)+1]*Gt;this.positions[3*Nt+0]=this.positions[3*Nt+0]*bt+Yt*xt,this.positions[3*Nt+1]=this.positions[3*Nt+1]*bt+Wt*xt,this.positions[3*Nt+2]=0}for(var jt=0;jt<kt;jt++){var Jt=jt*zt,Kt=Math.floor(Jt),Ht=Jt-Kt,Zt=this.oldPositions2[3*Kt+0]*(1-Ht)+this.oldPositions2[3*(Kt+1)+0]*Ht,$t=this.oldPositions2[3*Kt+1]*(1-Ht)+this.oldPositions2[3*(Kt+1)+1]*Ht;this.positions2[3*jt+0]=this.positions[3*(jt+kt)+0]*bt+Zt*xt,this.positions2[3*jt+1]=this.positions[3*(jt+kt)+1]*bt+$t*xt,this.positions2[3*jt+2]=0}}else for(var te=(this.oldNumVert-1)/this.numVert,ee=0;ee<this.numVert;ee++){var ie=ee*te,se=Math.floor(ie),re=ie-se,ae=this.oldPositions[3*se+0]*(1-re)+this.oldPositions[3*(se+1)+0]*re,oe=this.oldPositions[3*se+1]*(1-re)+this.oldPositions[3*(se+1)+1]*re;this.positions[3*ee+0]=this.positions[3*ee+0]*bt+ae*xt,this.positions[3*ee+1]=this.positions[3*ee+1]*bt+oe*xt,this.positions[3*ee+2]=0}for(var ne=0;ne<this.numVert;ne++)this.positions[3*ne+1]=-this.positions[3*ne+1];if(this.smoothedNumVert=2*this.numVert-1,q.smoothWave(this.positions,this.smoothedPositions,this.numVert),7===l||7===c){for(var he=0;he<this.numVert;he++)this.positions2[3*he+1]=-this.positions2[3*he+1];q.smoothWave(this.positions2,this.smoothedPositions2,this.numVert)}return!0}return!1}},{key:"drawBasicWaveform",value:function(t,e,i,s,r){if(this.generateWaveform(t,e,i,s,r)){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.smoothedPositions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc),this.gl.uniform4fv(this.colorLoc,this.color);var a=1;0===r.wave_thick&&0===r.wave_dots||(a=4),0!==r.additivewave?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE):this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);for(var o=0!==r.wave_dots?this.gl.POINTS:this.gl.LINE_STRIP,n=0;n<a;n++){0===n?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):1===n?this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,0]):2===n?this.gl.uniform2fv(this.thickOffsetLoc,[0,2/this.texsizeY]):3===n&&this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,2/this.texsizeY]),this.gl.drawArrays(o,0,this.smoothedNumVert)}if(7===Math.floor(r.wave_mode)%8){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.smoothedPositions2,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc);for(var h=0;h<a;h++){0===h?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):1===h?this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,0]):2===h?this.gl.uniform2fv(this.thickOffsetLoc,[0,2/this.texsizeY]):3===h&&this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,2/this.texsizeY]),this.gl.drawArrays(o,0,this.smoothedNumVert)}}}}}],[{key:"processWaveform",value:function(t,e){var i=[],s=e.wave_scale/128,r=e.wave_smoothing,a=s*(1-r);i.push(t[0]*s);for(var o=1;o<t.length;o++)i.push(t[o]*a+i[o-1]*r);return i}}]),t}(),z=function(){function t(e,i,s){r()(this,t),this.index=e,this.gl=i;this.pointsData=[new Float32Array(512),new Float32Array(512)],this.positions=new Float32Array(1536),this.colors=new Float32Array(2048),this.smoothedPositions=new Float32Array(3069),this.smoothedColors=new Float32Array(4092),this.texsizeX=s.texsizeX,this.texsizeY=s.texsizeY,this.mesh_width=s.mesh_width,this.mesh_height=s.mesh_height,this.aspectx=s.aspectx,this.aspecty=s.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.positionVertexBuf=this.gl.createBuffer(),this.colorVertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      uniform float uSize;\n      uniform vec2 thickOffset;\n      in vec3 aPos;\n      in vec4 aColor;\n      out vec4 vColor;\n      void main(void) {\n        vColor = aColor;\n        gl_PointSize = uSize;\n        gl_Position = vec4(aPos + vec3(thickOffset, 0.0), 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      in vec4 vColor;\n      out vec4 fragColor;\n      void main(void) {\n        fragColor = vColor;\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.aPosLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.aColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.sizeLoc=this.gl.getUniformLocation(this.shaderProgram,"uSize"),this.thickOffsetLoc=this.gl.getUniformLocation(this.shaderProgram,"thickOffset")}},{key:"generateWaveform",value:function(t,e,i,s,r,a,o,n){if(0!==o.baseVals.enabled&&t.length>0){var h;if(a.preset.useWASM)h=a.runWaveFrameEquations(this.index,r);else{var A=Object.assign({},a.mdVSWaves[this.index],a.mdVSFrameMapWaves[this.index],a.mdVSQAfterFrame,a.mdVSTWaveInits[this.index],r);h=a.runWaveFrameEquations(this.index,A)}Object.prototype.hasOwnProperty.call(h,"samples")?this.samples=h.samples:this.samples=512,this.samples>512&&(this.samples=512),this.samples=Math.floor(this.samples);var l=a.preset.waves[this.index].baseVals,c=Math.floor(h.sep),u=h.scaling,g=h.spectrum,m=h.smoothing,f=l.usedots,p=h.r,d=h.g,v=h.b,_=h.a,E=a.preset.baseVals.wave_scale;if(this.samples-=c,this.samples>=2||0!==f&&this.samples>=1){var b=0!==g,x=(b?.15:.004)*u*E,y=b?i:t,T=b?s:e,w=b?0:Math.floor((512-this.samples)/2-c/2),S=b?0:Math.floor((512-this.samples)/2+c/2),P=b?(512-c)/this.samples:1,I=Math.pow(.98*m,.5),R=1-I;this.pointsData[0][0]=y[w],this.pointsData[1][0]=T[S];for(var B=1;B<this.samples;B++){var L=y[Math.floor(B*P+w)],C=T[Math.floor(B*P+S)];this.pointsData[0][B]=L*R+this.pointsData[0][B-1]*I,this.pointsData[1][B]=C*R+this.pointsData[1][B-1]*I}for(var M=this.samples-2;M>=0;M--)this.pointsData[0][M]=this.pointsData[0][M]*R+this.pointsData[0][M+1]*I,this.pointsData[1][M]=this.pointsData[1][M]*R+this.pointsData[1][M+1]*I;for(var F=0;F<this.samples;F++)this.pointsData[0][F]*=x,this.pointsData[1][F]*=x;if(a.preset.useWASM)for(var Q=a.preset.globalPools["wavePerFrame".concat(this.index)],V=0;V<this.samples;V++){var D=this.pointsData[0][V],k=this.pointsData[1][V];Q.sample.value=V/(this.samples-1),Q.value1.value=D,Q.value2.value=k,Q.x.value=.5+D,Q.y.value=.5+k,Q.r.value=p,Q.g.value=d,Q.b.value=v,Q.a.value=_,o.point_eqs&&a.preset.waves[this.index].point_eqs();var z=(2*Q.x.value-1)*this.invAspectx,N=(-2*Q.y.value+1)*this.invAspecty,X=Q.r.value,O=Q.g.value,G=Q.b.value,Y=Q.a.value;this.positions[3*V+0]=z,this.positions[3*V+1]=N,this.positions[3*V+2]=0,this.colors[4*V+0]=X,this.colors[4*V+1]=O,this.colors[4*V+2]=G,this.colors[4*V+3]=Y*n}else for(var W=0;W<this.samples;W++){var j=this.pointsData[0][W],J=this.pointsData[1][W];h.sample=W/(this.samples-1),h.value1=j,h.value2=J,h.x=.5+j,h.y=.5+J,h.r=p,h.g=d,h.b=v,h.a=_,""!==o.point_eqs&&(h=a.runWavePointEquations(this.index,h));var K=(2*h.x-1)*this.invAspectx,H=(-2*h.y+1)*this.invAspecty,Z=h.r,$=h.g,tt=h.b,et=h.a;this.positions[3*W+0]=K,this.positions[3*W+1]=H,this.positions[3*W+2]=0,this.colors[4*W+0]=Z,this.colors[4*W+1]=$,this.colors[4*W+2]=tt,this.colors[4*W+3]=et*n}if(a.preset.useWASM)h.usedots=f,h.thick=l.thick,h.additive=l.additive;else{var it=a.mdVSUserKeysWaves[this.index],st=U.pick(h,it);a.mdVSFrameMapWaves[this.index]=st}return this.mdVSWaveFrame=h,0===f&&q.smoothWaveAndColor(this.positions,this.colors,this.smoothedPositions,this.smoothedColors,this.samples),!0}}return!1}},{key:"drawCustomWaveform",value:function(t,e,i,s,r,a,o,n){if(n&&this.generateWaveform(e,i,s,r,a,o,n,t)){this.gl.useProgram(this.shaderProgram);var h,A,l,c=0!==this.mdVSWaveFrame.usedots,u=0!==this.mdVSWaveFrame.thick,g=0!==this.mdVSWaveFrame.additive;c?(h=this.positions,A=this.colors,l=this.samples):(h=this.smoothedPositions,A=this.smoothedColors,l=2*this.samples-1),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,h,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,A,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation);var m=1;c?u?this.gl.uniform1f(this.sizeLoc,2+(this.texsizeX>=1024?1:0)):this.gl.uniform1f(this.sizeLoc,1+(this.texsizeX>=1024?1:0)):(this.gl.uniform1f(this.sizeLoc,1),u&&(m=4)),g?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE):this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);for(var f=c?this.gl.POINTS:this.gl.LINE_STRIP,p=0;p<m;p++){0===p?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):1===p?this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,0]):2===p?this.gl.uniform2fv(this.thickOffsetLoc,[0,2/this.texsizeY]):3===p&&this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,2/this.texsizeY]),this.gl.drawArrays(f,0,l)}}}}]),t}(),N=function(){function t(e,i,s){r()(this,t),this.index=e,this.gl=i;this.positions=new Float32Array(309),this.colors=new Float32Array(412),this.uvs=new Float32Array(206),this.borderPositions=new Float32Array(306),this.texsizeX=s.texsizeX,this.texsizeY=s.texsizeY,this.mesh_width=s.mesh_width,this.mesh_height=s.mesh_height,this.aspectx=s.aspectx,this.aspecty=s.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.positionVertexBuf=this.gl.createBuffer(),this.colorVertexBuf=this.gl.createBuffer(),this.uvVertexBuf=this.gl.createBuffer(),this.borderPositionVertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader(),this.createBorderShader(),this.mainSampler=this.gl.createSampler(),i.samplerParameteri(this.mainSampler,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.samplerParameteri(this.mainSampler,i.TEXTURE_MAG_FILTER,i.LINEAR),i.samplerParameteri(this.mainSampler,i.TEXTURE_WRAP_S,i.REPEAT),i.samplerParameteri(this.mainSampler,i.TEXTURE_WRAP_T,i.REPEAT)}return o()(t,[{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      in vec3 aPos;\n      in vec4 aColor;\n      in vec2 aUv;\n      out vec4 vColor;\n      out vec2 vUv;\n      void main(void) {\n        vColor = aColor;\n        vUv = aUv;\n        gl_Position = vec4(aPos, 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      uniform sampler2D uTexture;\n      uniform float uTextured;\n      in vec4 vColor;\n      in vec2 vUv;\n      out vec4 fragColor;\n      void main(void) {\n        if (uTextured != 0.0) {\n          fragColor = texture(uTexture, vUv) * vColor;\n        } else {\n          fragColor = vColor;\n        }\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.aPosLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.aColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.aUvLocation=this.gl.getAttribLocation(this.shaderProgram,"aUv"),this.texturedLoc=this.gl.getUniformLocation(this.shaderProgram,"uTextured"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture")}},{key:"createBorderShader",value:function(){this.borderShaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      in vec3 aBorderPos;\n      uniform vec2 thickOffset;\n      void main(void) {\n        gl_Position = vec4(aBorderPos +\n                            vec3(thickOffset, 0.0), 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      out vec4 fragColor;\n      uniform vec4 uBorderColor;\n      void main(void) {\n        fragColor = uBorderColor;\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.borderShaderProgram,t),this.gl.attachShader(this.borderShaderProgram,e),this.gl.linkProgram(this.borderShaderProgram),this.aBorderPosLoc=this.gl.getAttribLocation(this.borderShaderProgram,"aBorderPos"),this.uBorderColorLoc=this.gl.getUniformLocation(this.borderShaderProgram,"uBorderColor"),this.thickOffsetLoc=this.gl.getUniformLocation(this.shaderProgram,"thickOffset")}},{key:"drawCustomShape",value:function(t,e,i,s,r){if(0!==s.baseVals.enabled)if(i.preset.useWASM){this.setupShapeBuffers(i.preset.globalPools.perFrame.wrap.value);var a=i.preset.shapes[this.index].baseVals,o=i.preset.globalPools["shapePerFrame".concat(this.index)];U.setWasm(o,e,i.globalKeys),i.preset.shapes[this.index].frame_eqs||i.preset.restore_qs(),U.setWasm(o,i.mdVSTShapeInits[this.index],i.ts),i.preset.save_ts(),o.x.value=a.x,o.y.value=a.y,o.rad.value=a.rad,o.ang.value=a.ang,o.r.value=a.r,o.g.value=a.g,o.b.value=a.b,o.a.value=a.a,o.r2.value=a.r2,o.g2.value=a.g2,o.b2.value=a.b2,o.a2.value=a.a2,o.border_r.value=a.border_r,o.border_g.value=a.border_g,o.border_b.value=a.border_b,o.border_a.value=a.border_a,o.thickoutline.value=a.thickoutline,o.textured.value=a.textured,o.tex_zoom.value=a.tex_zoom,o.tex_ang.value=a.tex_ang,o.additive.value=a.additive,i.preset.shapes[this.index].frame_eqs_save();for(var n=Math.clamp(a.num_inst,1,1024),h=0;h<n;h++){o.instance.value=h,i.preset.shapes[this.index].frame_eqs&&(i.preset.shapes[this.index].frame_eqs_restore(),i.preset.restore_qs(),i.preset.restore_ts(),i.preset.shapes[this.index].frame_eqs());var A=o.sides.value;A=Math.clamp(A,3,100),A=Math.floor(A);var l=o.rad.value,c=o.ang.value,u=2*o.x.value-1,g=-2*o.y.value+1,m=o.r.value,f=o.g.value,p=o.b.value,d=o.a.value,v=o.r2.value,_=o.g2.value,E=o.b2.value,b=o.a2.value,x=o.border_r.value,y=o.border_g.value,T=o.border_b.value,w=o.border_a.value;this.borderColor=[x,y,T,w*t];var S=o.thickoutline.value,P=o.textured.value,I=o.tex_zoom.value,R=o.tex_ang.value,B=o.additive.value,L=this.borderColor[3]>0,C=Math.abs(P)>=1,M=Math.abs(S)>=1,F=Math.abs(B)>=1;this.positions[0]=u,this.positions[1]=g,this.positions[2]=0,this.colors[0]=m,this.colors[1]=f,this.colors[2]=p,this.colors[3]=d*t,C&&(this.uvs[0]=.5,this.uvs[1]=.5);for(var Q=.25*Math.PI,V=1;V<=A+1;V++){var D=2*((V-1)/A)*Math.PI,q=D+c+Q;if(this.positions[3*V+0]=u+l*Math.cos(q)*this.aspecty,this.positions[3*V+1]=g+l*Math.sin(q),this.positions[3*V+2]=0,this.colors[4*V+0]=v,this.colors[4*V+1]=_,this.colors[4*V+2]=E,this.colors[4*V+3]=b*t,C){var k=D+R+Q;this.uvs[2*V+0]=.5+.5*Math.cos(k)/I*this.aspecty,this.uvs[2*V+1]=.5+.5*Math.sin(k)/I}L&&(this.borderPositions[3*(V-1)+0]=this.positions[3*V+0],this.borderPositions[3*(V-1)+1]=this.positions[3*V+1],this.borderPositions[3*(V-1)+2]=this.positions[3*V+2])}this.drawCustomShapeInstance(r,A,C,L,M,F)}}else{this.setupShapeBuffers(i.mdVSFrame.wrap);var z=Object.assign({},i.mdVSShapes[this.index],i.mdVSFrameMapShapes[this.index],e);""===i.preset.shapes[this.index].frame_eqs_str&&(z=Object.assign(z,i.mdVSQAfterFrame,i.mdVSTShapeInits[this.index]));for(var N=i.preset.shapes[this.index].baseVals,X=Math.clamp(N.num_inst,1,1024),O=0;O<X;O++){z.instance=O,z.x=N.x,z.y=N.y,z.rad=N.rad,z.ang=N.ang,z.r=N.r,z.g=N.g,z.b=N.b,z.a=N.a,z.r2=N.r2,z.g2=N.g2,z.b2=N.b2,z.a2=N.a2,z.border_r=N.border_r,z.border_g=N.border_g,z.border_b=N.border_b,z.border_a=N.border_a,z.thickoutline=N.thickoutline,z.textured=N.textured,z.tex_zoom=N.tex_zoom,z.tex_ang=N.tex_ang,z.additive=N.additive;var G=void 0;""!==i.preset.shapes[this.index].frame_eqs_str?(z=Object.assign(z,i.mdVSQAfterFrame,i.mdVSTShapeInits[this.index]),G=i.runShapeFrameEquations(this.index,z)):G=z;var Y=G.sides;Y=Math.clamp(Y,3,100),Y=Math.floor(Y);var W=G.rad,j=G.ang,J=2*G.x-1,K=-2*G.y+1,H=G.r,Z=G.g,$=G.b,tt=G.a,et=G.r2,it=G.g2,st=G.b2,rt=G.a2,at=G.border_r,ot=G.border_g,nt=G.border_b,ht=G.border_a;this.borderColor=[at,ot,nt,ht*t];var At=G.thickoutline,lt=G.textured,ct=G.tex_zoom,ut=G.tex_ang,gt=G.additive,mt=this.borderColor[3]>0,ft=Math.abs(lt)>=1,pt=Math.abs(At)>=1,dt=Math.abs(gt)>=1;this.positions[0]=J,this.positions[1]=K,this.positions[2]=0,this.colors[0]=H,this.colors[1]=Z,this.colors[2]=$,this.colors[3]=tt*t,ft&&(this.uvs[0]=.5,this.uvs[1]=.5);for(var vt=.25*Math.PI,_t=1;_t<=Y+1;_t++){var Et=2*((_t-1)/Y)*Math.PI,bt=Et+j+vt;if(this.positions[3*_t+0]=J+W*Math.cos(bt)*this.aspecty,this.positions[3*_t+1]=K+W*Math.sin(bt),this.positions[3*_t+2]=0,this.colors[4*_t+0]=et,this.colors[4*_t+1]=it,this.colors[4*_t+2]=st,this.colors[4*_t+3]=rt*t,ft){var xt=Et+ut+vt;this.uvs[2*_t+0]=.5+.5*Math.cos(xt)/ct*this.aspecty,this.uvs[2*_t+1]=.5+.5*Math.sin(xt)/ct}mt&&(this.borderPositions[3*(_t-1)+0]=this.positions[3*_t+0],this.borderPositions[3*(_t-1)+1]=this.positions[3*_t+1],this.borderPositions[3*(_t-1)+2]=this.positions[3*_t+2])}this.mdVSShapeFrame=G,this.drawCustomShapeInstance(r,Y,ft,mt,pt,dt)}var yt=i.mdVSUserKeysShapes[this.index],Tt=U.pick(this.mdVSShapeFrame,yt);i.mdVSFrameMapShapes[this.index]=Tt}}},{key:"setupShapeBuffers",value:function(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.colors,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.uvs,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aUvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aUvLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.borderPositionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.borderPositions,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aBorderPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aBorderPosLoc);var e=0!==t?this.gl.REPEAT:this.gl.CLAMP_TO_EDGE;this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_S,e),this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_T,e)}},{key:"drawCustomShapeInstance",value:function(t,e,i,s,r,a){if(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.positions,0,3*(e+2)),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.colors,0,4*(e+2)),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation),i&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.uvs,0,2*(e+2)),this.gl.vertexAttribPointer(this.aUvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aUvLocation)),this.gl.uniform1f(this.texturedLoc,i?1:0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.bindSampler(0,this.mainSampler),this.gl.uniform1i(this.textureLoc,0),a?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE):this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,e+2),s){this.gl.useProgram(this.borderShaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.borderPositionVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.borderPositions,0,3*(e+1)),this.gl.vertexAttribPointer(this.aBorderPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aBorderPosLoc),this.gl.uniform4fv(this.uBorderColorLoc,this.borderColor);for(var o=r?4:1,n=0;n<o;n++){0===n?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):1===n?this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,0]):2===n?this.gl.uniform2fv(this.thickOffsetLoc,[0,2/this.texsizeY]):3===n&&this.gl.uniform2fv(this.thickOffsetLoc,[2/this.texsizeX,2/this.texsizeY]),this.gl.drawArrays(this.gl.LINE_STRIP,0,e+1)}}}}]),t}(),X=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r()(this,t),this.gl=e,this.positions=new Float32Array(72),this.aspectx=i.aspectx,this.aspecty=i.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader(),this.vertexBuf=this.gl.createBuffer()}return o()(t,[{key:"updateGlobals",value:function(t){this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      in vec3 aPos;\n      void main(void) {\n        gl_Position = vec4(aPos, 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      out vec4 fragColor;\n      uniform vec4 u_color;\n      void main(void) {\n        fragColor = u_color;\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.aPosLoc=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.colorLoc=this.gl.getUniformLocation(this.shaderProgram,"u_color")}},{key:"addTriangle",value:function(t,e,i,s){this.positions[t+0]=e[0],this.positions[t+1]=e[1],this.positions[t+2]=e[2],this.positions[t+3]=i[0],this.positions[t+4]=i[1],this.positions[t+5]=i[2],this.positions[t+6]=s[0],this.positions[t+7]=s[1],this.positions[t+8]=s[2]}},{key:"generateBorder",value:function(t,e,i){if(e>0&&t[3]>0){var s=i/2,r=e/2+s,a=2*s,o=2*s,n=2*r,h=2*r,A=[-1+a,-1+h,0],l=[-1+a,1-h,0],c=[-1+n,1-h,0],u=[-1+n,-1+h,0];return this.addTriangle(0,u,l,A),this.addTriangle(9,u,c,l),A=[1-a,-1+h,0],l=[1-a,1-h,0],c=[1-n,1-h,0],u=[1-n,-1+h,0],this.addTriangle(18,A,l,u),this.addTriangle(27,l,c,u),A=[-1+a,-1+o,0],l=[-1+a,h-1,0],c=[1-a,h-1,0],u=[1-a,-1+o,0],this.addTriangle(36,u,l,A),this.addTriangle(45,u,c,l),A=[-1+a,1-o,0],l=[-1+a,1-h,0],c=[1-a,1-h,0],u=[1-a,1-o,0],this.addTriangle(54,A,l,u),this.addTriangle(63,l,c,u),!0}return!1}},{key:"drawBorder",value:function(t,e,i){this.generateBorder(t,e,i)&&(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc),this.gl.uniform4fv(this.colorLoc,t),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLES,0,this.positions.length/3))}}]),t}(),O=function(){function t(e,i){r()(this,t),this.gl=e,this.aspectx=i.aspectx,this.aspecty=i.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.generatePositions(),this.colors=new Float32Array([0,0,0,3/32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.positionVertexBuf=this.gl.createBuffer(),this.colorVertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"updateGlobals",value:function(t){this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.generatePositions()}},{key:"generatePositions",value:function(){this.positions=new Float32Array([0,0,0,-.05*this.aspecty,0,0,0,-.05,0,.05*this.aspecty,0,0,0,.05,0,-.05*this.aspecty,0,0])}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      in vec3 aPos;\n      in vec4 aColor;\n      out vec4 vColor;\n      void main(void) {\n        vColor = aColor;\n        gl_Position = vec4(aPos, 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      in vec4 vColor;\n      out vec4 fragColor;\n      void main(void) {\n        fragColor = vColor;\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.aPosLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.aColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aColor")}},{key:"drawDarkenCenter",value:function(t){0!==t.darken_center&&(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.colors,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,this.positions.length/3))}}]),t}(),G=function(){function t(e,i){r()(this,t),this.gl=e,this.maxX=64,this.maxY=48,this.positions=new Float32Array(this.maxX*this.maxY*2*3),this.texsizeX=i.texsizeX,this.texsizeY=i.texsizeY,this.mesh_width=i.mesh_width,this.mesh_height=i.mesh_height,this.positionVertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      in vec3 aPos;\n      void main(void) {\n        gl_Position = vec4(aPos, 1.0);\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      out vec4 fragColor;\n      uniform vec4 u_color;\n      void main(void) {\n        fragColor = u_color;\n      }\n      ").trim()),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.aPosLoc=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.colorLoc=this.gl.getUniformLocation(this.shaderProgram,"u_color")}},{key:"getMotionDir",value:function(t,e,i){var s,r,a=Math.floor(i*this.mesh_height),o=i*this.mesh_height-a,n=Math.floor(e*this.mesh_width),h=e*this.mesh_width-n,A=n+1,l=a+1,c=this.mesh_width+1;return s=t[2*(a*c+n)+0]*(1-h)*(1-o),r=t[2*(a*c+n)+1]*(1-h)*(1-o),s+=t[2*(a*c+A)+0]*h*(1-o),r+=t[2*(a*c+A)+1]*h*(1-o),s+=t[2*(l*c+n)+0]*(1-h)*o,r+=t[2*(l*c+n)+1]*(1-h)*o,[s+=t[2*(l*c+A)+0]*h*o,1-(r+=t[2*(l*c+A)+1]*h*o)]}},{key:"generateMotionVectors",value:function(t,e){var i=0===t.bmotionvectorson?0:t.mv_a,s=Math.floor(t.mv_x),r=Math.floor(t.mv_y);if(i>.001&&s>0&&r>0){var a=t.mv_x-s,o=t.mv_y-r;s>this.maxX&&(s=this.maxX,a=0),r>this.maxY&&(r=this.maxY,o=0);var n=t.mv_dx,h=t.mv_dy,A=t.mv_l,l=1/this.texsizeX;this.numVecVerts=0;for(var c=0;c<r;c++){var u=(c+.25)/(r+o+.25-1);if((u-=h)>1e-4&&u<.9999)for(var g=0;g<s;g++){var m=(g+.25)/(s+a+.25-1);if((m+=n)>1e-4&&m<.9999){var f=this.getMotionDir(e,m,u),p=f[0],d=f[1],v=p-m,_=d-u;v*=A,_*=A;var E=Math.sqrt(v*v+_*_);E<l&&E>1e-8?(v*=E=l/E,_*=E):(v=l,v=l);var b=2*m-1,x=2*u-1,y=2*(p=m+v)-1,T=2*(d=u+_)-1;this.positions[3*this.numVecVerts+0]=b,this.positions[3*this.numVecVerts+1]=x,this.positions[3*this.numVecVerts+2]=0,this.positions[3*(this.numVecVerts+1)+0]=y,this.positions[3*(this.numVecVerts+1)+1]=T,this.positions[3*(this.numVecVerts+1)+2]=0,this.numVecVerts+=2}}}if(this.numVecVerts>0)return this.color=[t.mv_r,t.mv_g,t.mv_b,i],!0}return!1}},{key:"drawMotionVectors",value:function(t,e){this.generateMotionVectors(t,e)&&(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc),this.gl.uniform4fv(this.colorLoc,this.color),this.gl.lineWidth(1),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.LINES,0,this.numVecVerts))}}]),t}(),Y=function(){function t(e,i,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r()(this,t),this.gl=e,this.noise=i,this.image=s,this.texsizeX=a.texsizeX,this.texsizeY=a.texsizeY,this.mesh_width=a.mesh_width,this.mesh_height=a.mesh_height,this.aspectx=a.aspectx,this.aspecty=a.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions(),this.indexBuf=e.createBuffer(),this.positionVertexBuf=this.gl.createBuffer(),this.warpUvVertexBuf=this.gl.createBuffer(),this.warpColorVertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader(),this.mainSampler=this.gl.createSampler(),this.mainSamplerFW=this.gl.createSampler(),this.mainSamplerFC=this.gl.createSampler(),this.mainSamplerPW=this.gl.createSampler(),this.mainSamplerPC=this.gl.createSampler(),e.samplerParameteri(this.mainSampler,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.samplerParameteri(this.mainSampler,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.mainSampler,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.mainSampler,e.TEXTURE_WRAP_T,e.REPEAT),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_WRAP_T,e.REPEAT),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_MAG_FILTER,e.NEAREST),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_WRAP_T,e.REPEAT),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_MAG_FILTER,e.NEAREST),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}return o()(t,[{key:"buildPositions",value:function(){for(var t=this.mesh_width,e=this.mesh_height,i=t+1,s=e+1,r=2/t,a=2/e,o=[],n=0;n<s;n++)for(var h=n*a-1,A=0;A<i;A++){var l=A*r-1;o.push(l,-h,0)}for(var c=[],u=0;u<e;u++)for(var g=0;g<t;g++){var m=g+i*u,f=g+i*(u+1),p=g+1+i*(u+1),d=g+1+i*u;c.push(m,f,d),c.push(f,p,d)}this.vertices=new Float32Array(o),this.indices=new Uint16Array(c)}},{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions()}},{key:"createShader",value:function(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(0===i.length)t="ret = texture(sampler_main, uv).rgb * decay;",e="";else{var s=D.getShaderParts(i);e=s[0],t=s[1]}t=(t=t.replace(/texture2D/g,"texture")).replace(/texture3D/g,"texture"),this.userTextures=D.getUserSamplers(e),this.shaderProgram=this.gl.createProgram();var r=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(r,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      const vec2 halfmad = vec2(0.5);\n      in vec2 aPos;\n      in vec2 aWarpUv;\n      in vec4 aWarpColor;\n      out vec2 uv;\n      out vec2 uv_orig;\n      out vec4 vColor;\n      void main(void) {\n        gl_Position = vec4(aPos, 0.0, 1.0);\n        uv_orig = aPos * halfmad + halfmad;\n        uv = aWarpUv;\n        vColor = aWarpColor;\n      }\n      ").trim()),this.gl.compileShader(r);var a=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(a,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      precision mediump sampler3D;\n\n      in vec2 uv;\n      in vec2 uv_orig;\n      in vec4 vColor;\n      out vec4 fragColor;\n      uniform sampler2D sampler_main;\n      uniform sampler2D sampler_fw_main;\n      uniform sampler2D sampler_fc_main;\n      uniform sampler2D sampler_pw_main;\n      uniform sampler2D sampler_pc_main;\n      uniform sampler2D sampler_blur1;\n      uniform sampler2D sampler_blur2;\n      uniform sampler2D sampler_blur3;\n      uniform sampler2D sampler_noise_lq;\n      uniform sampler2D sampler_noise_lq_lite;\n      uniform sampler2D sampler_noise_mq;\n      uniform sampler2D sampler_noise_hq;\n      uniform sampler2D sampler_pw_noise_lq;\n      uniform sampler3D sampler_noisevol_lq;\n      uniform sampler3D sampler_noisevol_hq;\n      uniform float time;\n      uniform float decay;\n      uniform vec2 resolution;\n      uniform vec4 aspect;\n      uniform vec4 texsize;\n      uniform vec4 texsize_noise_lq;\n      uniform vec4 texsize_noise_mq;\n      uniform vec4 texsize_noise_hq;\n      uniform vec4 texsize_noise_lq_lite;\n      uniform vec4 texsize_noisevol_lq;\n      uniform vec4 texsize_noisevol_hq;\n\n      uniform float bass;\n      uniform float mid;\n      uniform float treb;\n      uniform float vol;\n      uniform float bass_att;\n      uniform float mid_att;\n      uniform float treb_att;\n      uniform float vol_att;\n\n      uniform float frame;\n      uniform float fps;\n\n      uniform vec4 _qa;\n      uniform vec4 _qb;\n      uniform vec4 _qc;\n      uniform vec4 _qd;\n      uniform vec4 _qe;\n      uniform vec4 _qf;\n      uniform vec4 _qg;\n      uniform vec4 _qh;\n\n      #define q1 _qa.x\n      #define q2 _qa.y\n      #define q3 _qa.z\n      #define q4 _qa.w\n      #define q5 _qb.x\n      #define q6 _qb.y\n      #define q7 _qb.z\n      #define q8 _qb.w\n      #define q9 _qc.x\n      #define q10 _qc.y\n      #define q11 _qc.z\n      #define q12 _qc.w\n      #define q13 _qd.x\n      #define q14 _qd.y\n      #define q15 _qd.z\n      #define q16 _qd.w\n      #define q17 _qe.x\n      #define q18 _qe.y\n      #define q19 _qe.z\n      #define q20 _qe.w\n      #define q21 _qf.x\n      #define q22 _qf.y\n      #define q23 _qf.z\n      #define q24 _qf.w\n      #define q25 _qg.x\n      #define q26 _qg.y\n      #define q27 _qg.z\n      #define q28 _qg.w\n      #define q29 _qh.x\n      #define q30 _qh.y\n      #define q31 _qh.z\n      #define q32 _qh.w\n\n      uniform vec4 slow_roam_cos;\n      uniform vec4 roam_cos;\n      uniform vec4 slow_roam_sin;\n      uniform vec4 roam_sin;\n\n      uniform float blur1_min;\n      uniform float blur1_max;\n      uniform float blur2_min;\n      uniform float blur2_max;\n      uniform float blur3_min;\n      uniform float blur3_max;\n\n      uniform float scale1;\n      uniform float scale2;\n      uniform float scale3;\n      uniform float bias1;\n      uniform float bias2;\n      uniform float bias3;\n\n      uniform vec4 rand_frame;\n      uniform vec4 rand_preset;\n\n      float PI = ").concat(Math.PI,";\n\n      ").concat(e,"\n\n      void main(void) {\n        vec3 ret;\n        float rad = length(uv_orig - 0.5);\n        float ang = atan(uv_orig.x - 0.5, uv_orig.y - 0.5);\n\n        ").concat(t,"\n\n        fragColor = vec4(ret, 1.0) * vColor;\n      }\n      ").trim()),this.gl.compileShader(a),this.gl.attachShader(this.shaderProgram,r),this.gl.attachShader(this.shaderProgram,a),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.warpUvLocation=this.gl.getAttribLocation(this.shaderProgram,"aWarpUv"),this.warpColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aWarpColor"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_main"),this.textureFWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fw_main"),this.textureFCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fc_main"),this.texturePWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_main"),this.texturePCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pc_main"),this.blurTexture1Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur1"),this.blurTexture2Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur2"),this.blurTexture3Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur3"),this.noiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq"),this.noiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_mq"),this.noiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_hq"),this.noiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq_lite"),this.noisePointLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_noise_lq"),this.noiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_lq"),this.noiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_hq"),this.decayLoc=this.gl.getUniformLocation(this.shaderProgram,"decay"),this.texsizeLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.texsizeNoiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq"),this.texsizeNoiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_mq"),this.texsizeNoiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_hq"),this.texsizeNoiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq_lite"),this.texsizeNoiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_lq"),this.texsizeNoiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_hq"),this.resolutionLoc=this.gl.getUniformLocation(this.shaderProgram,"resolution"),this.aspectLoc=this.gl.getUniformLocation(this.shaderProgram,"aspect"),this.bassLoc=this.gl.getUniformLocation(this.shaderProgram,"bass"),this.midLoc=this.gl.getUniformLocation(this.shaderProgram,"mid"),this.trebLoc=this.gl.getUniformLocation(this.shaderProgram,"treb"),this.volLoc=this.gl.getUniformLocation(this.shaderProgram,"vol"),this.bassAttLoc=this.gl.getUniformLocation(this.shaderProgram,"bass_att"),this.midAttLoc=this.gl.getUniformLocation(this.shaderProgram,"mid_att"),this.trebAttLoc=this.gl.getUniformLocation(this.shaderProgram,"treb_att"),this.volAttLoc=this.gl.getUniformLocation(this.shaderProgram,"vol_att"),this.timeLoc=this.gl.getUniformLocation(this.shaderProgram,"time"),this.frameLoc=this.gl.getUniformLocation(this.shaderProgram,"frame"),this.fpsLoc=this.gl.getUniformLocation(this.shaderProgram,"fps"),this.blur1MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_min"),this.blur1MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_max"),this.blur2MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_min"),this.blur2MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_max"),this.blur3MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_min"),this.blur3MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_max"),this.scale1Loc=this.gl.getUniformLocation(this.shaderProgram,"scale1"),this.scale2Loc=this.gl.getUniformLocation(this.shaderProgram,"scale2"),this.scale3Loc=this.gl.getUniformLocation(this.shaderProgram,"scale3"),this.bias1Loc=this.gl.getUniformLocation(this.shaderProgram,"bias1"),this.bias2Loc=this.gl.getUniformLocation(this.shaderProgram,"bias2"),this.bias3Loc=this.gl.getUniformLocation(this.shaderProgram,"bias3"),this.randPresetLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_preset"),this.randFrameLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_frame"),this.qaLoc=this.gl.getUniformLocation(this.shaderProgram,"_qa"),this.qbLoc=this.gl.getUniformLocation(this.shaderProgram,"_qb"),this.qcLoc=this.gl.getUniformLocation(this.shaderProgram,"_qc"),this.qdLoc=this.gl.getUniformLocation(this.shaderProgram,"_qd"),this.qeLoc=this.gl.getUniformLocation(this.shaderProgram,"_qe"),this.qfLoc=this.gl.getUniformLocation(this.shaderProgram,"_qf"),this.qgLoc=this.gl.getUniformLocation(this.shaderProgram,"_qg"),this.qhLoc=this.gl.getUniformLocation(this.shaderProgram,"_qh"),this.slowRoamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_cos"),this.roamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_cos"),this.slowRoamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_sin"),this.roamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_sin");for(var o=0;o<this.userTextures.length;o++){var n=this.userTextures[o];n.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_".concat(n.sampler))}}},{key:"updateShader",value:function(t){this.createShader(t)}},{key:"bindBlurVals",value:function(t,e){var i=t[0],s=t[1],r=t[2],a=e[0],o=e[1],n=e[2],h=a-i,A=i,l=o-s,c=s,u=n-r,g=r;this.gl.uniform1f(this.blur1MinLoc,i),this.gl.uniform1f(this.blur1MaxLoc,a),this.gl.uniform1f(this.blur2MinLoc,s),this.gl.uniform1f(this.blur2MaxLoc,o),this.gl.uniform1f(this.blur3MinLoc,r),this.gl.uniform1f(this.blur3MaxLoc,n),this.gl.uniform1f(this.scale1Loc,h),this.gl.uniform1f(this.scale2Loc,l),this.gl.uniform1f(this.scale3Loc,u),this.gl.uniform1f(this.bias1Loc,A),this.gl.uniform1f(this.bias2Loc,c),this.gl.uniform1f(this.bias3Loc,g)}},{key:"renderQuadTexture",value:function(t,e,i,s,r,a,o,n,h,A,l){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuf),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.warpUvVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,A,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.warpUvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.warpUvLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.warpColorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.warpColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.warpColorLocation);var c=0!==n.wrap?this.gl.REPEAT:this.gl.CLAMP_TO_EDGE;this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_S,c),this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_T,c),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(0,this.mainSampler),this.gl.uniform1i(this.textureLoc,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(1,this.mainSamplerFW),this.gl.uniform1i(this.textureFWLoc,1),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(2,this.mainSamplerFC),this.gl.uniform1i(this.textureFCLoc,2),this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(3,this.mainSamplerPW),this.gl.uniform1i(this.texturePWLoc,3),this.gl.activeTexture(this.gl.TEXTURE4),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(4,this.mainSamplerPC),this.gl.uniform1i(this.texturePCLoc,4),this.gl.activeTexture(this.gl.TEXTURE5),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.uniform1i(this.blurTexture1Loc,5),this.gl.activeTexture(this.gl.TEXTURE6),this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.uniform1i(this.blurTexture2Loc,6),this.gl.activeTexture(this.gl.TEXTURE7),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.uniform1i(this.blurTexture3Loc,7),this.gl.activeTexture(this.gl.TEXTURE8),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.uniform1i(this.noiseLQLoc,8),this.gl.activeTexture(this.gl.TEXTURE9),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexMQ),this.gl.uniform1i(this.noiseMQLoc,9),this.gl.activeTexture(this.gl.TEXTURE10),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexHQ),this.gl.uniform1i(this.noiseHQLoc,10),this.gl.activeTexture(this.gl.TEXTURE11),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQLite),this.gl.uniform1i(this.noiseLQLiteLoc,11),this.gl.activeTexture(this.gl.TEXTURE12),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.bindSampler(12,this.noise.noiseTexPointLQ),this.gl.uniform1i(this.noisePointLQLoc,12),this.gl.activeTexture(this.gl.TEXTURE13),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolLQ),this.gl.uniform1i(this.noiseVolLQLoc,13),this.gl.activeTexture(this.gl.TEXTURE14),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolHQ),this.gl.uniform1i(this.noiseVolHQLoc,14);for(var u=0;u<this.userTextures.length;u++){var g=this.userTextures[u];this.gl.activeTexture(this.gl.TEXTURE15+u),this.gl.bindTexture(this.gl.TEXTURE_2D,this.image.getTexture(g.sampler)),this.gl.uniform1i(g.textureLoc,15+u)}this.gl.uniform1f(this.decayLoc,n.decay),this.gl.uniform2fv(this.resolutionLoc,[this.texsizeX,this.texsizeY]),this.gl.uniform4fv(this.aspectLoc,[this.aspectx,this.aspecty,this.invAspectx,this.invAspecty]),this.gl.uniform4fv(this.texsizeLoc,[this.texsizeX,this.texsizeY,1/this.texsizeX,1/this.texsizeY]),this.gl.uniform4fv(this.texsizeNoiseLQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseMQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseHQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseLQLiteLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolLQLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolHQLoc,[32,32,1/32,1/32]),this.gl.uniform1f(this.bassLoc,n.bass),this.gl.uniform1f(this.midLoc,n.mid),this.gl.uniform1f(this.trebLoc,n.treb),this.gl.uniform1f(this.volLoc,(n.bass+n.mid+n.treb)/3),this.gl.uniform1f(this.bassAttLoc,n.bass_att),this.gl.uniform1f(this.midAttLoc,n.mid_att),this.gl.uniform1f(this.trebAttLoc,n.treb_att),this.gl.uniform1f(this.volAttLoc,(n.bass_att+n.mid_att+n.treb_att)/3),this.gl.uniform1f(this.timeLoc,n.time),this.gl.uniform1f(this.frameLoc,n.frame),this.gl.uniform1f(this.fpsLoc,n.fps),this.gl.uniform4fv(this.randPresetLoc,n.rand_preset),this.gl.uniform4fv(this.randFrameLoc,new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()])),this.gl.uniform4fv(this.qaLoc,new Float32Array([h.q1||0,h.q2||0,h.q3||0,h.q4||0])),this.gl.uniform4fv(this.qbLoc,new Float32Array([h.q5||0,h.q6||0,h.q7||0,h.q8||0])),this.gl.uniform4fv(this.qcLoc,new Float32Array([h.q9||0,h.q10||0,h.q11||0,h.q12||0])),this.gl.uniform4fv(this.qdLoc,new Float32Array([h.q13||0,h.q14||0,h.q15||0,h.q16||0])),this.gl.uniform4fv(this.qeLoc,new Float32Array([h.q17||0,h.q18||0,h.q19||0,h.q20||0])),this.gl.uniform4fv(this.qfLoc,new Float32Array([h.q21||0,h.q22||0,h.q23||0,h.q24||0])),this.gl.uniform4fv(this.qgLoc,new Float32Array([h.q25||0,h.q26||0,h.q27||0,h.q28||0])),this.gl.uniform4fv(this.qhLoc,new Float32Array([h.q29||0,h.q30||0,h.q31||0,h.q32||0])),this.gl.uniform4fv(this.slowRoamCosLoc,[.5+.5*Math.cos(.005*n.time),.5+.5*Math.cos(.008*n.time),.5+.5*Math.cos(.013*n.time),.5+.5*Math.cos(.022*n.time)]),this.gl.uniform4fv(this.roamCosLoc,[.5+.5*Math.cos(.3*n.time),.5+.5*Math.cos(1.3*n.time),.5+.5*Math.cos(5*n.time),.5+.5*Math.cos(20*n.time)]),this.gl.uniform4fv(this.slowRoamSinLoc,[.5+.5*Math.sin(.005*n.time),.5+.5*Math.sin(.008*n.time),.5+.5*Math.sin(.013*n.time),.5+.5*Math.sin(.022*n.time)]),this.gl.uniform4fv(this.roamSinLoc,[.5+.5*Math.sin(.3*n.time),.5+.5*Math.sin(1.3*n.time),.5+.5*Math.sin(5*n.time),.5+.5*Math.sin(20*n.time)]),this.bindBlurVals(a,o),t?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.disable(this.gl.BLEND),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0),t||this.gl.enable(this.gl.BLEND)}}]),t}(),W=function(){function t(e,i,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r()(this,t),this.gl=e,this.noise=i,this.image=s,this.mesh_width=a.mesh_width,this.mesh_height=a.mesh_height,this.texsizeX=a.texsizeX,this.texsizeY=a.texsizeY,this.aspectx=a.aspectx,this.aspecty=a.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.compWidth=32,this.compHeight=24,this.buildPositions(),this.indexBuf=e.createBuffer(),this.positionVertexBuf=this.gl.createBuffer(),this.compColorVertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader(),this.mainSampler=this.gl.createSampler(),this.mainSamplerFW=this.gl.createSampler(),this.mainSamplerFC=this.gl.createSampler(),this.mainSamplerPW=this.gl.createSampler(),this.mainSamplerPC=this.gl.createSampler(),e.samplerParameteri(this.mainSampler,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.samplerParameteri(this.mainSampler,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.mainSampler,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.mainSampler,e.TEXTURE_WRAP_T,e.REPEAT),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.mainSamplerFW,e.TEXTURE_WRAP_T,e.REPEAT),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.samplerParameteri(this.mainSamplerFC,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_MAG_FILTER,e.NEAREST),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.mainSamplerPW,e.TEXTURE_WRAP_T,e.REPEAT),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_MAG_FILTER,e.NEAREST),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.samplerParameteri(this.mainSamplerPC,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}return o()(t,[{key:"buildPositions",value:function(){for(var t=this.compWidth,e=this.compHeight,i=t+1,s=e+1,r=2/t,a=2/e,o=[],n=0;n<s;n++)for(var h=n*a-1,A=0;A<i;A++){var l=A*r-1;o.push(l,-h,0)}for(var c=[],u=0;u<e;u++)for(var g=0;g<t;g++){var m=g+i*u,f=g+i*(u+1),p=g+1+i*(u+1),d=g+1+i*u;c.push(m,f,d),c.push(f,p,d)}this.vertices=new Float32Array(o),this.indices=new Uint16Array(c)}},{key:"updateGlobals",value:function(t){this.mesh_width=t.mesh_width,this.mesh_height=t.mesh_height,this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions()}},{key:"createShader",value:function(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(0===i.length)t="float orient_horiz = mod(echo_orientation, 2.0);\n                        float orient_x = (orient_horiz != 0.0) ? -1.0 : 1.0;\n                        float orient_y = (echo_orientation >= 2.0) ? -1.0 : 1.0;\n                        vec2 uv_echo = ((uv - 0.5) *\n                                        (1.0 / echo_zoom) *\n                                        vec2(orient_x, orient_y)) + 0.5;\n\n                        ret = mix(texture(sampler_main, uv).rgb,\n                                  texture(sampler_main, uv_echo).rgb,\n                                  echo_alpha);\n\n                        ret *= gammaAdj;\n\n                        if(fShader >= 1.0) {\n                          ret *= hue_shader;\n                        } else if(fShader > 0.001) {\n                          ret *= (1.0 - fShader) + (fShader * hue_shader);\n                        }\n\n                        if(brighten != 0) ret = sqrt(ret);\n                        if(darken != 0) ret = ret*ret;\n                        if(solarize != 0) ret = ret * (1.0 - ret) * 4.0;\n                        if(invert != 0) ret = 1.0 - ret;",e="";else{var s=D.getShaderParts(i);e=s[0],t=s[1]}t=(t=t.replace(/texture2D/g,"texture")).replace(/texture3D/g,"texture"),this.userTextures=D.getUserSamplers(e),this.shaderProgram=this.gl.createProgram();var r=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(r,"\n      #version 300 es\n      const vec2 halfmad = vec2(0.5);\n      in vec2 aPos;\n      in vec4 aCompColor;\n      out vec2 vUv;\n      out vec4 vColor;\n      void main(void) {\n        gl_Position = vec4(aPos, 0.0, 1.0);\n        vUv = aPos * halfmad + halfmad;\n        vColor = aCompColor;\n      }\n      ".trim()),this.gl.compileShader(r);var a=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(a,"\n      #version 300 es\n      precision ".concat(this.floatPrecision," float;\n      precision highp int;\n      precision mediump sampler2D;\n      precision mediump sampler3D;\n\n      vec3 lum(vec3 v){\n          return vec3(dot(v, vec3(0.32,0.49,0.29)));\n      }\n\n      in vec2 vUv;\n      in vec4 vColor;\n      out vec4 fragColor;\n      uniform sampler2D sampler_main;\n      uniform sampler2D sampler_fw_main;\n      uniform sampler2D sampler_fc_main;\n      uniform sampler2D sampler_pw_main;\n      uniform sampler2D sampler_pc_main;\n      uniform sampler2D sampler_blur1;\n      uniform sampler2D sampler_blur2;\n      uniform sampler2D sampler_blur3;\n      uniform sampler2D sampler_noise_lq;\n      uniform sampler2D sampler_noise_lq_lite;\n      uniform sampler2D sampler_noise_mq;\n      uniform sampler2D sampler_noise_hq;\n      uniform sampler2D sampler_pw_noise_lq;\n      uniform sampler3D sampler_noisevol_lq;\n      uniform sampler3D sampler_noisevol_hq;\n\n      uniform float time;\n      uniform float gammaAdj;\n      uniform float echo_zoom;\n      uniform float echo_alpha;\n      uniform float echo_orientation;\n      uniform int invert;\n      uniform int brighten;\n      uniform int darken;\n      uniform int solarize;\n      uniform vec2 resolution;\n      uniform vec4 aspect;\n      uniform vec4 texsize;\n      uniform vec4 texsize_noise_lq;\n      uniform vec4 texsize_noise_mq;\n      uniform vec4 texsize_noise_hq;\n      uniform vec4 texsize_noise_lq_lite;\n      uniform vec4 texsize_noisevol_lq;\n      uniform vec4 texsize_noisevol_hq;\n\n      uniform float bass;\n      uniform float mid;\n      uniform float treb;\n      uniform float vol;\n      uniform float bass_att;\n      uniform float mid_att;\n      uniform float treb_att;\n      uniform float vol_att;\n\n      uniform float frame;\n      uniform float fps;\n\n      uniform vec4 _qa;\n      uniform vec4 _qb;\n      uniform vec4 _qc;\n      uniform vec4 _qd;\n      uniform vec4 _qe;\n      uniform vec4 _qf;\n      uniform vec4 _qg;\n      uniform vec4 _qh;\n\n      #define q1 _qa.x\n      #define q2 _qa.y\n      #define q3 _qa.z\n      #define q4 _qa.w\n      #define q5 _qb.x\n      #define q6 _qb.y\n      #define q7 _qb.z\n      #define q8 _qb.w\n      #define q9 _qc.x\n      #define q10 _qc.y\n      #define q11 _qc.z\n      #define q12 _qc.w\n      #define q13 _qd.x\n      #define q14 _qd.y\n      #define q15 _qd.z\n      #define q16 _qd.w\n      #define q17 _qe.x\n      #define q18 _qe.y\n      #define q19 _qe.z\n      #define q20 _qe.w\n      #define q21 _qf.x\n      #define q22 _qf.y\n      #define q23 _qf.z\n      #define q24 _qf.w\n      #define q25 _qg.x\n      #define q26 _qg.y\n      #define q27 _qg.z\n      #define q28 _qg.w\n      #define q29 _qh.x\n      #define q30 _qh.y\n      #define q31 _qh.z\n      #define q32 _qh.w\n\n      uniform vec4 slow_roam_cos;\n      uniform vec4 roam_cos;\n      uniform vec4 slow_roam_sin;\n      uniform vec4 roam_sin;\n\n      uniform float blur1_min;\n      uniform float blur1_max;\n      uniform float blur2_min;\n      uniform float blur2_max;\n      uniform float blur3_min;\n      uniform float blur3_max;\n\n      uniform float scale1;\n      uniform float scale2;\n      uniform float scale3;\n      uniform float bias1;\n      uniform float bias2;\n      uniform float bias3;\n\n      uniform vec4 rand_frame;\n      uniform vec4 rand_preset;\n\n      uniform float fShader;\n\n      float PI = ").concat(Math.PI,";\n\n      ").concat(e,"\n\n      void main(void) {\n        vec3 ret;\n        vec2 uv = vUv;\n        vec2 uv_orig = vUv;\n        uv.y = 1.0 - uv.y;\n        uv_orig.y = 1.0 - uv_orig.y;\n        float rad = length(uv - 0.5);\n        float ang = atan(uv.x - 0.5, uv.y - 0.5);\n        vec3 hue_shader = vColor.rgb;\n\n        ").concat(t,"\n\n        fragColor = vec4(ret, vColor.a);\n      }\n      ").trim()),this.gl.compileShader(a),this.gl.attachShader(this.shaderProgram,r),this.gl.attachShader(this.shaderProgram,a),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.compColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aCompColor"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_main"),this.textureFWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fw_main"),this.textureFCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fc_main"),this.texturePWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_main"),this.texturePCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pc_main"),this.blurTexture1Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur1"),this.blurTexture2Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur2"),this.blurTexture3Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur3"),this.noiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq"),this.noiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_mq"),this.noiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_hq"),this.noiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq_lite"),this.noisePointLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_noise_lq"),this.noiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_lq"),this.noiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_hq"),this.timeLoc=this.gl.getUniformLocation(this.shaderProgram,"time"),this.gammaAdjLoc=this.gl.getUniformLocation(this.shaderProgram,"gammaAdj"),this.echoZoomLoc=this.gl.getUniformLocation(this.shaderProgram,"echo_zoom"),this.echoAlphaLoc=this.gl.getUniformLocation(this.shaderProgram,"echo_alpha"),this.echoOrientationLoc=this.gl.getUniformLocation(this.shaderProgram,"echo_orientation"),this.invertLoc=this.gl.getUniformLocation(this.shaderProgram,"invert"),this.brightenLoc=this.gl.getUniformLocation(this.shaderProgram,"brighten"),this.darkenLoc=this.gl.getUniformLocation(this.shaderProgram,"darken"),this.solarizeLoc=this.gl.getUniformLocation(this.shaderProgram,"solarize"),this.texsizeLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.texsizeNoiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq"),this.texsizeNoiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_mq"),this.texsizeNoiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_hq"),this.texsizeNoiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq_lite"),this.texsizeNoiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_lq"),this.texsizeNoiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_hq"),this.resolutionLoc=this.gl.getUniformLocation(this.shaderProgram,"resolution"),this.aspectLoc=this.gl.getUniformLocation(this.shaderProgram,"aspect"),this.bassLoc=this.gl.getUniformLocation(this.shaderProgram,"bass"),this.midLoc=this.gl.getUniformLocation(this.shaderProgram,"mid"),this.trebLoc=this.gl.getUniformLocation(this.shaderProgram,"treb"),this.volLoc=this.gl.getUniformLocation(this.shaderProgram,"vol"),this.bassAttLoc=this.gl.getUniformLocation(this.shaderProgram,"bass_att"),this.midAttLoc=this.gl.getUniformLocation(this.shaderProgram,"mid_att"),this.trebAttLoc=this.gl.getUniformLocation(this.shaderProgram,"treb_att"),this.volAttLoc=this.gl.getUniformLocation(this.shaderProgram,"vol_att"),this.frameLoc=this.gl.getUniformLocation(this.shaderProgram,"frame"),this.fpsLoc=this.gl.getUniformLocation(this.shaderProgram,"fps"),this.blur1MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_min"),this.blur1MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_max"),this.blur2MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_min"),this.blur2MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_max"),this.blur3MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_min"),this.blur3MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_max"),this.scale1Loc=this.gl.getUniformLocation(this.shaderProgram,"scale1"),this.scale2Loc=this.gl.getUniformLocation(this.shaderProgram,"scale2"),this.scale3Loc=this.gl.getUniformLocation(this.shaderProgram,"scale3"),this.bias1Loc=this.gl.getUniformLocation(this.shaderProgram,"bias1"),this.bias2Loc=this.gl.getUniformLocation(this.shaderProgram,"bias2"),this.bias3Loc=this.gl.getUniformLocation(this.shaderProgram,"bias3"),this.randPresetLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_preset"),this.randFrameLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_frame"),this.fShaderLoc=this.gl.getUniformLocation(this.shaderProgram,"fShader"),this.qaLoc=this.gl.getUniformLocation(this.shaderProgram,"_qa"),this.qbLoc=this.gl.getUniformLocation(this.shaderProgram,"_qb"),this.qcLoc=this.gl.getUniformLocation(this.shaderProgram,"_qc"),this.qdLoc=this.gl.getUniformLocation(this.shaderProgram,"_qd"),this.qeLoc=this.gl.getUniformLocation(this.shaderProgram,"_qe"),this.qfLoc=this.gl.getUniformLocation(this.shaderProgram,"_qf"),this.qgLoc=this.gl.getUniformLocation(this.shaderProgram,"_qg"),this.qhLoc=this.gl.getUniformLocation(this.shaderProgram,"_qh"),this.slowRoamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_cos"),this.roamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_cos"),this.slowRoamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_sin"),this.roamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_sin");for(var o=0;o<this.userTextures.length;o++){var n=this.userTextures[o];n.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_".concat(n.sampler))}}},{key:"updateShader",value:function(t){this.createShader(t)}},{key:"bindBlurVals",value:function(t,e){var i=t[0],s=t[1],r=t[2],a=e[0],o=e[1],n=e[2],h=a-i,A=i,l=o-s,c=s,u=n-r,g=r;this.gl.uniform1f(this.blur1MinLoc,i),this.gl.uniform1f(this.blur1MaxLoc,a),this.gl.uniform1f(this.blur2MinLoc,s),this.gl.uniform1f(this.blur2MaxLoc,o),this.gl.uniform1f(this.blur3MinLoc,r),this.gl.uniform1f(this.blur3MaxLoc,n),this.gl.uniform1f(this.scale1Loc,h),this.gl.uniform1f(this.scale2Loc,l),this.gl.uniform1f(this.scale3Loc,u),this.gl.uniform1f(this.bias1Loc,A),this.gl.uniform1f(this.bias2Loc,c),this.gl.uniform1f(this.bias3Loc,g)}},{key:"generateCompColors",value:function(e,i,s){for(var r=t.generateHueBase(i),a=this.compWidth+1,o=this.compHeight+1,n=new Float32Array(a*o*4),h=0,A=0;A<o;A++)for(var l=0;l<a;l++){for(var c=l/this.compWidth,u=A/this.compHeight,g=[1,1,1],m=0;m<3;m++)g[m]=r[0+m]*c*u+r[3+m]*(1-c)*u+r[6+m]*c*(1-u)+r[9+m]*(1-c)*(1-u);var f=1;if(e){c*=this.mesh_width+1,u*=this.mesh_height+1,c=Math.clamp(c,0,this.mesh_width-1),u=Math.clamp(u,0,this.mesh_height-1);var p=Math.floor(c),d=Math.floor(u),v=c-p,_=u-d;f=s[4*(d*(this.mesh_width+1)+p)+3]*(1-v)*(1-_)+s[4*(d*(this.mesh_width+1)+(p+1))+3]*v*(1-_)+s[4*((d+1)*(this.mesh_width+1)+p)+3]*(1-v)*_+s[4*((d+1)*(this.mesh_width+1)+(p+1))+3]*v*_}n[h+0]=g[0],n[h+1]=g[1],n[h+2]=g[2],n[h+3]=f,h+=4}return n}},{key:"renderQuadTexture",value:function(t,e,i,s,r,a,o,n,h,A){var l=this.generateCompColors(t,n,A);this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuf),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.compColorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.compColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.compColorLocation);var c=0!==n.wrap?this.gl.REPEAT:this.gl.CLAMP_TO_EDGE;this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_S,c),this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_T,c),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(0,this.mainSampler),this.gl.uniform1i(this.textureLoc,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(1,this.mainSamplerFW),this.gl.uniform1i(this.textureFWLoc,1),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(2,this.mainSamplerFC),this.gl.uniform1i(this.textureFCLoc,2),this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(3,this.mainSamplerPW),this.gl.uniform1i(this.texturePWLoc,3),this.gl.activeTexture(this.gl.TEXTURE4),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.bindSampler(4,this.mainSamplerPC),this.gl.uniform1i(this.texturePCLoc,4),this.gl.activeTexture(this.gl.TEXTURE5),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.uniform1i(this.blurTexture1Loc,5),this.gl.activeTexture(this.gl.TEXTURE6),this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.uniform1i(this.blurTexture2Loc,6),this.gl.activeTexture(this.gl.TEXTURE7),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.uniform1i(this.blurTexture3Loc,7),this.gl.activeTexture(this.gl.TEXTURE8),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.uniform1i(this.noiseLQLoc,8),this.gl.activeTexture(this.gl.TEXTURE9),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexMQ),this.gl.uniform1i(this.noiseMQLoc,9),this.gl.activeTexture(this.gl.TEXTURE10),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexHQ),this.gl.uniform1i(this.noiseHQLoc,10),this.gl.activeTexture(this.gl.TEXTURE11),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQLite),this.gl.uniform1i(this.noiseLQLiteLoc,11),this.gl.activeTexture(this.gl.TEXTURE12),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.bindSampler(12,this.noise.noiseTexPointLQ),this.gl.uniform1i(this.noisePointLQLoc,12),this.gl.activeTexture(this.gl.TEXTURE13),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolLQ),this.gl.uniform1i(this.noiseVolLQLoc,13),this.gl.activeTexture(this.gl.TEXTURE14),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolHQ),this.gl.uniform1i(this.noiseVolHQLoc,14);for(var u=0;u<this.userTextures.length;u++){var g=this.userTextures[u];this.gl.activeTexture(this.gl.TEXTURE15+u),this.gl.bindTexture(this.gl.TEXTURE_2D,this.image.getTexture(g.sampler)),this.gl.uniform1i(g.textureLoc,15+u)}this.gl.uniform1f(this.timeLoc,n.time),this.gl.uniform1f(this.gammaAdjLoc,n.gammaadj),this.gl.uniform1f(this.echoZoomLoc,n.echo_zoom),this.gl.uniform1f(this.echoAlphaLoc,n.echo_alpha),this.gl.uniform1f(this.echoOrientationLoc,n.echo_orient),this.gl.uniform1i(this.invertLoc,n.invert),this.gl.uniform1i(this.brightenLoc,n.brighten),this.gl.uniform1i(this.darkenLoc,n.darken),this.gl.uniform1i(this.solarizeLoc,n.solarize),this.gl.uniform2fv(this.resolutionLoc,[this.texsizeX,this.texsizeY]),this.gl.uniform4fv(this.aspectLoc,[this.aspectx,this.aspecty,this.invAspectx,this.invAspecty]),this.gl.uniform4fv(this.texsizeLoc,new Float32Array([this.texsizeX,this.texsizeY,1/this.texsizeX,1/this.texsizeY])),this.gl.uniform4fv(this.texsizeNoiseLQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseMQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseHQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseLQLiteLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolLQLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolHQLoc,[32,32,1/32,1/32]),this.gl.uniform1f(this.bassLoc,n.bass),this.gl.uniform1f(this.midLoc,n.mid),this.gl.uniform1f(this.trebLoc,n.treb),this.gl.uniform1f(this.volLoc,(n.bass+n.mid+n.treb)/3),this.gl.uniform1f(this.bassAttLoc,n.bass_att),this.gl.uniform1f(this.midAttLoc,n.mid_att),this.gl.uniform1f(this.trebAttLoc,n.treb_att),this.gl.uniform1f(this.volAttLoc,(n.bass_att+n.mid_att+n.treb_att)/3),this.gl.uniform1f(this.frameLoc,n.frame),this.gl.uniform1f(this.fpsLoc,n.fps),this.gl.uniform4fv(this.randPresetLoc,n.rand_preset),this.gl.uniform4fv(this.randFrameLoc,new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()])),this.gl.uniform1f(this.fShaderLoc,n.fshader),this.gl.uniform4fv(this.qaLoc,new Float32Array([h.q1||0,h.q2||0,h.q3||0,h.q4||0])),this.gl.uniform4fv(this.qbLoc,new Float32Array([h.q5||0,h.q6||0,h.q7||0,h.q8||0])),this.gl.uniform4fv(this.qcLoc,new Float32Array([h.q9||0,h.q10||0,h.q11||0,h.q12||0])),this.gl.uniform4fv(this.qdLoc,new Float32Array([h.q13||0,h.q14||0,h.q15||0,h.q16||0])),this.gl.uniform4fv(this.qeLoc,new Float32Array([h.q17||0,h.q18||0,h.q19||0,h.q20||0])),this.gl.uniform4fv(this.qfLoc,new Float32Array([h.q21||0,h.q22||0,h.q23||0,h.q24||0])),this.gl.uniform4fv(this.qgLoc,new Float32Array([h.q25||0,h.q26||0,h.q27||0,h.q28||0])),this.gl.uniform4fv(this.qhLoc,new Float32Array([h.q29||0,h.q30||0,h.q31||0,h.q32||0])),this.gl.uniform4fv(this.slowRoamCosLoc,[.5+.5*Math.cos(.005*n.time),.5+.5*Math.cos(.008*n.time),.5+.5*Math.cos(.013*n.time),.5+.5*Math.cos(.022*n.time)]),this.gl.uniform4fv(this.roamCosLoc,[.5+.5*Math.cos(.3*n.time),.5+.5*Math.cos(1.3*n.time),.5+.5*Math.cos(5*n.time),.5+.5*Math.cos(20*n.time)]),this.gl.uniform4fv(this.slowRoamSinLoc,[.5+.5*Math.sin(.005*n.time),.5+.5*Math.sin(.008*n.time),.5+.5*Math.sin(.013*n.time),.5+.5*Math.sin(.022*n.time)]),this.gl.uniform4fv(this.roamSinLoc,[.5+.5*Math.sin(.3*n.time),.5+.5*Math.sin(1.3*n.time),.5+.5*Math.sin(5*n.time),.5+.5*Math.sin(20*n.time)]),this.bindBlurVals(a,o),t?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.disable(this.gl.BLEND),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0),t||this.gl.enable(this.gl.BLEND)}}],[{key:"generateHueBase",value:function(t){for(var e=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1]),i=0;i<4;i++){e[3*i+0]=.6+.3*Math.sin(30*t.time*.0143+3+21*i+t.rand_start[3]),e[3*i+1]=.6+.3*Math.sin(30*t.time*.0107+1+13*i+t.rand_start[1]),e[3*i+2]=.6+.3*Math.sin(30*t.time*.0129+6+9*i+t.rand_start[2]);for(var s=Math.max(e[3*i],e[3*i+1],e[3*i+2]),r=0;r<3;r++)e[3*i+r]=e[3*i+r]/s,e[3*i+r]=.5+.5*e[3*i+r]}return e}}]),t}(),j=function(){function t(e,i){r()(this,t),this.gl=e,this.textureRatio=i.textureRatio,this.texsizeX=i.texsizeX,this.texsizeY=i.texsizeY,this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.useFXAA()?this.createFXAAShader():this.createShader()}return o()(t,[{key:"useFXAA",value:function(){return this.textureRatio<=1}},{key:"updateGlobals",value:function(t){this.textureRatio=t.textureRatio,this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.gl.deleteProgram(this.shaderProgram),this.useFXAA()?this.createFXAAShader():this.createShader()}},{key:"createFXAAShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"#version 300 es\n       const vec2 halfmad = vec2(0.5);\n       in vec2 aPos;\n       out vec2 v_rgbM;\n       out vec2 v_rgbNW;\n       out vec2 v_rgbNE;\n       out vec2 v_rgbSW;\n       out vec2 v_rgbSE;\n       uniform vec4 texsize;\n       void main(void) {\n         gl_Position = vec4(aPos, 0.0, 1.0);\n\n         v_rgbM = aPos * halfmad + halfmad;\n         v_rgbNW = v_rgbM + (vec2(-1.0, -1.0) * texsize.zx);\n         v_rgbNE = v_rgbM + (vec2(1.0, -1.0) * texsize.zx);\n         v_rgbSW = v_rgbM + (vec2(-1.0, 1.0) * texsize.zx);\n         v_rgbSE = v_rgbM + (vec2(1.0, 1.0) * texsize.zx);\n       }"),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"#version 300 es\n       precision ".concat(this.floatPrecision," float;\n       precision highp int;\n       precision mediump sampler2D;\n\n       in vec2 v_rgbM;\n       in vec2 v_rgbNW;\n       in vec2 v_rgbNE;\n       in vec2 v_rgbSW;\n       in vec2 v_rgbSE;\n       out vec4 fragColor;\n       uniform vec4 texsize;\n       uniform sampler2D uTexture;\n\n       #ifndef FXAA_REDUCE_MIN\n         #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n       #endif\n       #ifndef FXAA_REDUCE_MUL\n         #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n       #endif\n       #ifndef FXAA_SPAN_MAX\n         #define FXAA_SPAN_MAX     8.0\n       #endif\n\n       void main(void) {\n         vec4 color;\n         vec3 rgbNW = textureLod(uTexture, v_rgbNW, 0.0).xyz;\n         vec3 rgbNE = textureLod(uTexture, v_rgbNE, 0.0).xyz;\n         vec3 rgbSW = textureLod(uTexture, v_rgbSW, 0.0).xyz;\n         vec3 rgbSE = textureLod(uTexture, v_rgbSE, 0.0).xyz;\n         vec3 rgbM  = textureLod(uTexture, v_rgbM, 0.0).xyz;\n         vec3 luma = vec3(0.299, 0.587, 0.114);\n         float lumaNW = dot(rgbNW, luma);\n         float lumaNE = dot(rgbNE, luma);\n         float lumaSW = dot(rgbSW, luma);\n         float lumaSE = dot(rgbSE, luma);\n         float lumaM  = dot(rgbM,  luma);\n         float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n         float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n         mediump vec2 dir;\n         dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n         dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n         float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                               (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n         float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n         dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n                   max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                   dir * rcpDirMin)) * texsize.zw;\n\n         vec3 rgbA = 0.5 * (\n             textureLod(uTexture, v_rgbM + dir * (1.0 / 3.0 - 0.5), 0.0).xyz +\n             textureLod(uTexture, v_rgbM + dir * (2.0 / 3.0 - 0.5), 0.0).xyz);\n         vec3 rgbB = rgbA * 0.5 + 0.25 * (\n             textureLod(uTexture, v_rgbM + dir * -0.5, 0.0).xyz +\n             textureLod(uTexture, v_rgbM + dir * 0.5, 0.0).xyz);\n\n         float lumaB = dot(rgbB, luma);\n         if ((lumaB < lumaMin) || (lumaB > lumaMax))\n           color = vec4(rgbA, 1.0);\n         else\n           color = vec4(rgbB, 1.0);\n\n         fragColor = color;\n       }")),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.texsizeLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize")}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"#version 300 es\n       const vec2 halfmad = vec2(0.5);\n       in vec2 aPos;\n       out vec2 uv;\n       void main(void) {\n         gl_Position = vec4(aPos, 0.0, 1.0);\n         uv = aPos * halfmad + halfmad;\n       }"),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"#version 300 es\n       precision ".concat(this.floatPrecision," float;\n       precision highp int;\n       precision mediump sampler2D;\n\n       in vec2 uv;\n       out vec4 fragColor;\n       uniform sampler2D uTexture;\n\n       void main(void) {\n         fragColor = vec4(texture(uTexture, uv).rgb, 1.0);\n       }")),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture")}},{key:"renderQuadTexture",value:function(t){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(this.textureLoc,0),this.useFXAA()&&this.gl.uniform4fv(this.texsizeLoc,new Float32Array([this.texsizeX,this.texsizeY,1/this.texsizeX,1/this.texsizeY])),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),t}(),J=function(){function t(e){r()(this,t),this.gl=e,this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"#version 300 es\n       const vec2 halfmad = vec2(0.5);\n       in vec2 aPos;\n       out vec2 uv;\n       void main(void) {\n         gl_Position = vec4(aPos, 0.0, 1.0);\n         uv = aPos * halfmad + halfmad;\n       }"),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"#version 300 es\n       precision ".concat(this.floatPrecision," float;\n       precision highp int;\n       precision mediump sampler2D;\n\n       in vec2 uv;\n       out vec4 fragColor;\n       uniform sampler2D uTexture;\n\n       void main(void) {\n         fragColor = vec4(texture(uTexture, uv).rgb, 1.0);\n       }")),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture")}},{key:"renderQuadTexture",value:function(t){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.uniform1i(this.textureLoc,0),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),t}(),K=function(){function t(e,i){r()(this,t),this.gl=e,this.blurLevel=i;var s=[4,3.8,3.5,2.9,1.9,1.2,.7,.3],a=s[0]+s[1]+s[2]+s[3],o=s[4]+s[5]+s[6]+s[7],n=0+(s[2]+s[3])/a*2,h=2+(s[6]+s[7])/o*2;this.wds=new Float32Array([a,o,n,h]),this.wDiv=1/(2*(a+o)),this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      const vec2 halfmad = vec2(0.5);\n      in vec2 aPos;\n      out vec2 uv;\n      void main(void) {\n        gl_Position = vec4(aPos, 0.0, 1.0);\n        uv = aPos * halfmad + halfmad;\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"#version 300 es\n       precision ".concat(this.floatPrecision," float;\n       precision highp int;\n       precision mediump sampler2D;\n\n       in vec2 uv;\n       out vec4 fragColor;\n       uniform sampler2D uTexture;\n       uniform vec4 texsize;\n       uniform float ed1;\n       uniform float ed2;\n       uniform float ed3;\n       uniform vec4 wds;\n       uniform float wdiv;\n\n       void main(void) {\n         float w1 = wds[0];\n         float w2 = wds[1];\n         float d1 = wds[2];\n         float d2 = wds[3];\n\n         vec2 uv2 = uv.xy;\n\n         vec3 blur =\n           ( texture(uTexture, uv2 + vec2(0.0, d1 * texsize.w) ).xyz\n           + texture(uTexture, uv2 + vec2(0.0,-d1 * texsize.w) ).xyz) * w1 +\n           ( texture(uTexture, uv2 + vec2(0.0, d2 * texsize.w) ).xyz\n           + texture(uTexture, uv2 + vec2(0.0,-d2 * texsize.w) ).xyz) * w2;\n\n         blur.xyz *= wdiv;\n\n         float t = min(min(uv.x, uv.y), 1.0 - max(uv.x, uv.y));\n         t = sqrt(t);\n         t = ed1 + ed2 * clamp(t * ed3, 0.0, 1.0);\n         blur.xyz *= t;\n\n         fragColor = vec4(blur, 1.0);\n       }")),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.texsizeLocation=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.ed1Loc=this.gl.getUniformLocation(this.shaderProgram,"ed1"),this.ed2Loc=this.gl.getUniformLocation(this.shaderProgram,"ed2"),this.ed3Loc=this.gl.getUniformLocation(this.shaderProgram,"ed3"),this.wdsLocation=this.gl.getUniformLocation(this.shaderProgram,"wds"),this.wdivLoc=this.gl.getUniformLocation(this.shaderProgram,"wdiv")}},{key:"renderQuadTexture",value:function(t,e,i){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(this.textureLoc,0);var s=0===this.blurLevel?e.b1ed:0;this.gl.uniform4fv(this.texsizeLocation,[i[0],i[1],1/i[0],1/i[1]]),this.gl.uniform1f(this.ed1Loc,1-s),this.gl.uniform1f(this.ed2Loc,s),this.gl.uniform1f(this.ed3Loc,5),this.gl.uniform4fv(this.wdsLocation,this.wds),this.gl.uniform1f(this.wdivLoc,this.wDiv),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),t}(),H=function(){function t(e,i){r()(this,t),this.gl=e,this.blurLevel=i;var s=[4,3.8,3.5,2.9,1.9,1.2,.7,.3],a=s[0]+s[1],o=s[2]+s[3],n=s[4]+s[5],h=s[6]+s[7],A=0+2*s[1]/a,l=2+2*s[3]/o,c=4+2*s[5]/n,u=6+2*s[7]/h;this.ws=new Float32Array([a,o,n,h]),this.ds=new Float32Array([A,l,c,u]),this.wDiv=.5/(a+o+n+h),this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"\n      #version 300 es\n      const vec2 halfmad = vec2(0.5);\n      in vec2 aPos;\n      out vec2 uv;\n      void main(void) {\n        gl_Position = vec4(aPos, 0.0, 1.0);\n        uv = aPos * halfmad + halfmad;\n      }\n      ".trim()),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"#version 300 es\n       precision ".concat(this.floatPrecision," float;\n       precision highp int;\n       precision mediump sampler2D;\n\n       in vec2 uv;\n       out vec4 fragColor;\n       uniform sampler2D uTexture;\n       uniform vec4 texsize;\n       uniform float scale;\n       uniform float bias;\n       uniform vec4 ws;\n       uniform vec4 ds;\n       uniform float wdiv;\n\n       void main(void) {\n         float w1 = ws[0];\n         float w2 = ws[1];\n         float w3 = ws[2];\n         float w4 = ws[3];\n         float d1 = ds[0];\n         float d2 = ds[1];\n         float d3 = ds[2];\n         float d4 = ds[3];\n\n         vec2 uv2 = uv.xy;\n\n         vec3 blur =\n           ( texture(uTexture, uv2 + vec2( d1 * texsize.z,0.0) ).xyz\n           + texture(uTexture, uv2 + vec2(-d1 * texsize.z,0.0) ).xyz) * w1 +\n           ( texture(uTexture, uv2 + vec2( d2 * texsize.z,0.0) ).xyz\n           + texture(uTexture, uv2 + vec2(-d2 * texsize.z,0.0) ).xyz) * w2 +\n           ( texture(uTexture, uv2 + vec2( d3 * texsize.z,0.0) ).xyz\n           + texture(uTexture, uv2 + vec2(-d3 * texsize.z,0.0) ).xyz) * w3 +\n           ( texture(uTexture, uv2 + vec2( d4 * texsize.z,0.0) ).xyz\n           + texture(uTexture, uv2 + vec2(-d4 * texsize.z,0.0) ).xyz) * w4;\n\n         blur.xyz *= wdiv;\n         blur.xyz = blur.xyz * scale + bias;\n\n         fragColor = vec4(blur, 1.0);\n       }")),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.texsizeLocation=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.scaleLoc=this.gl.getUniformLocation(this.shaderProgram,"scale"),this.biasLoc=this.gl.getUniformLocation(this.shaderProgram,"bias"),this.wsLoc=this.gl.getUniformLocation(this.shaderProgram,"ws"),this.dsLocation=this.gl.getUniformLocation(this.shaderProgram,"ds"),this.wdivLoc=this.gl.getUniformLocation(this.shaderProgram,"wdiv")}},{key:"getScaleAndBias",value:function(t,e){var i,s,r=[1,1,1],a=[0,0,0];return r[0]=1/(e[0]-t[0]),a[0]=-t[0]*r[0],i=(t[1]-t[0])/(e[0]-t[0]),s=(e[1]-t[0])/(e[0]-t[0]),r[1]=1/(s-i),a[1]=-i*r[1],i=(t[2]-t[1])/(e[1]-t[1]),s=(e[2]-t[1])/(e[1]-t[1]),r[2]=1/(s-i),a[2]=-i*r[2],{scale:r[this.blurLevel],bias:a[this.blurLevel]}}},{key:"renderQuadTexture",value:function(t,e,i,s,r){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(this.textureLoc,0);var a=this.getScaleAndBias(i,s),o=a.scale,n=a.bias;this.gl.uniform4fv(this.texsizeLocation,[r[0],r[1],1/r[0],1/r[1]]),this.gl.uniform1f(this.scaleLoc,o),this.gl.uniform1f(this.biasLoc,n),this.gl.uniform4fv(this.wsLoc,this.ws),this.gl.uniform4fv(this.dsLocation,this.ds),this.gl.uniform1f(this.wdivLoc,this.wDiv),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),t}(),Z=function(){function t(e,i,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r()(this,t),this.blurLevel=e,this.blurRatios=i,this.gl=s,this.texsizeX=a.texsizeX,this.texsizeY=a.texsizeY,this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.blurHorizontalFrameBuffer=this.gl.createFramebuffer(),this.blurVerticalFrameBuffer=this.gl.createFramebuffer(),this.blurHorizontalTexture=this.gl.createTexture(),this.blurVerticalTexture=this.gl.createTexture(),this.setupFrameBufferTextures(),this.blurHorizontal=new H(s,this.blurLevel,a),this.blurVertical=new K(s,this.blurLevel,a)}return o()(t,[{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.setupFrameBufferTextures()}},{key:"getTextureSize",value:function(t){var e=Math.max(this.texsizeX*t,16);e=16*Math.floor((e+3)/16);var i=Math.max(this.texsizeY*t,16);return[e,i=4*Math.floor((i+3)/4)]}},{key:"setupFrameBufferTextures",value:function(){var t=this.blurLevel>0?this.blurRatios[this.blurLevel-1]:[1,1],e=this.blurRatios[this.blurLevel],i=this.getTextureSize(t[1]),s=this.getTextureSize(e[0]);this.bindFrameBufferTexture(this.blurHorizontalFrameBuffer,this.blurHorizontalTexture,s);var r=s,a=this.getTextureSize(e[1]);this.bindFrameBufferTexture(this.blurVerticalFrameBuffer,this.blurVerticalTexture,a),this.horizontalTexsizes=[i,s],this.verticalTexsizes=[r,a]}},{key:"bindFrambufferAndSetViewport",value:function(t,e){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.viewport(0,0,e[0],e[1])}},{key:"bindFrameBufferTexture",value:function(t,e,i){if(this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,i[0],i[1],0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(i[0]*i[1]*4)),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var s=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,s)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0)}},{key:"renderBlurTexture",value:function(t,e,i,s){this.bindFrambufferAndSetViewport(this.blurHorizontalFrameBuffer,this.horizontalTexsizes[1]),this.blurHorizontal.renderQuadTexture(t,e,i,s,this.horizontalTexsizes[0]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.blurHorizontalTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.bindFrambufferAndSetViewport(this.blurVerticalFrameBuffer,this.verticalTexsizes[1]),this.blurVertical.renderQuadTexture(this.blurHorizontalTexture,e,this.verticalTexsizes[0]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.blurVerticalTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D)}}]),t}(),$=function(){function t(e){r()(this,t),this.gl=e,this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.noiseTexLQ=this.gl.createTexture(),this.noiseTexLQLite=this.gl.createTexture(),this.noiseTexMQ=this.gl.createTexture(),this.noiseTexHQ=this.gl.createTexture(),this.noiseTexVolLQ=this.gl.createTexture(),this.noiseTexVolHQ=this.gl.createTexture(),this.nTexArrLQ=t.createNoiseTex(256,1),this.nTexArrLQLite=t.createNoiseTex(32,1),this.nTexArrMQ=t.createNoiseTex(256,4),this.nTexArrHQ=t.createNoiseTex(256,8),this.nTexArrVolLQ=t.createNoiseVolTex(32,1),this.nTexArrVolHQ=t.createNoiseVolTex(32,4),this.bindTexture(this.noiseTexLQ,this.nTexArrLQ,256,256),this.bindTexture(this.noiseTexLQLite,this.nTexArrLQLite,32,32),this.bindTexture(this.noiseTexMQ,this.nTexArrMQ,256,256),this.bindTexture(this.noiseTexHQ,this.nTexArrHQ,256,256),this.bindTexture3D(this.noiseTexVolLQ,this.nTexArrVolLQ,32,32,32),this.bindTexture3D(this.noiseTexVolHQ,this.nTexArrVolHQ,32,32,32),this.noiseTexPointLQ=this.gl.createSampler(),e.samplerParameteri(this.noiseTexPointLQ,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST),e.samplerParameteri(this.noiseTexPointLQ,e.TEXTURE_MAG_FILTER,e.NEAREST),e.samplerParameteri(this.noiseTexPointLQ,e.TEXTURE_WRAP_S,e.REPEAT),e.samplerParameteri(this.noiseTexPointLQ,e.TEXTURE_WRAP_T,e.REPEAT)}return o()(t,[{key:"bindTexture",value:function(t,e,i,s){if(this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,i,s,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var r=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,r)}}},{key:"bindTexture3D",value:function(t,e,i,s,r){if(this.gl.bindTexture(this.gl.TEXTURE_3D,t),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage3D(this.gl.TEXTURE_3D,0,this.gl.RGBA,i,s,r,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.generateMipmap(this.gl.TEXTURE_3D),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_R,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var a=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_3D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,a)}}}],[{key:"fCubicInterpolate",value:function(t,e,i,s,r){var a=r*r,o=s-i-t+e;return o*(r*a)+(t-e-o)*a+(i-t)*r+e}},{key:"dwCubicInterpolate",value:function(e,i,s,r,a){for(var o=[],n=0;n<4;n++){var h=t.fCubicInterpolate(e[n]/255,i[n]/255,s[n]/255,r[n]/255,a);h=Math.clamp(h,0,1),o[n]=255*h}return o}},{key:"createNoiseVolTex",value:function(e,i){for(var s=e*e*e,r=new Uint8Array(4*s),a=i>1?216:256,o=.5*a,n=0;n<s;n++)r[4*n+0]=Math.floor(Math.random()*a+o),r[4*n+1]=Math.floor(Math.random()*a+o),r[4*n+2]=Math.floor(Math.random()*a+o),r[4*n+3]=Math.floor(Math.random()*a+o);var h=e*e,A=e;if(i>1){for(var l=0;l<e;l+=i)for(var c=0;c<e;c+=i)for(var u=0;u<e;u++)if(u%i!=0){for(var g=Math.floor(u/i)*i+e,m=l*h+c*A,f=[],p=[],d=[],v=[],_=0;_<4;_++)f[_]=r[4*m+(g-i)%e*4+_],p[_]=r[4*m+g%e*4+_],d[_]=r[4*m+(g+i)%e*4+_],v[_]=r[4*m+(g+2*i)%e*4+_];for(var E=u%i/i,b=t.dwCubicInterpolate(f,p,d,v,E),x=0;x<4;x++){r[l*h*4+c*A*4+(4*u+x)]=b[x]}}for(var y=0;y<e;y+=i)for(var T=0;T<e;T++)for(var w=0;w<e;w++)if(w%i!=0){for(var S=Math.floor(w/i)*i+e,P=y*h,I=[],R=[],B=[],L=[],C=0;C<4;C++){var U=4*T+4*P+C;I[C]=r[(S-i)%e*A*4+U],R[C]=r[S%e*A*4+U],B[C]=r[(S+i)%e*A*4+U],L[C]=r[(S+2*i)%e*A*4+U]}for(var M=w%i/i,F=t.dwCubicInterpolate(I,R,B,L,M),Q=0;Q<4;Q++){r[w*A*4+(4*T+4*P+Q)]=F[Q]}}for(var V=0;V<e;V++)for(var D=0;D<e;D++)for(var q=0;q<e;q++)if(q%i!=0){for(var k=D*A,z=Math.floor(q/i)*i+e,N=[],X=[],O=[],G=[],Y=0;Y<4;Y++){var W=4*V+4*k+Y;N[Y]=r[(z-i)%e*h*4+W],X[Y]=r[z%e*h*4+W],O[Y]=r[(z+i)%e*h*4+W],G[Y]=r[(z+2*i)%e*h*4+W]}for(var j=D%i/i,J=t.dwCubicInterpolate(N,X,O,G,j),K=0;K<4;K++){r[q*h*4+(4*V+4*k+K)]=J[K]}}}return r}},{key:"createNoiseTex",value:function(e,i){for(var s=e*e,r=new Uint8Array(4*s),a=i>1?216:256,o=.5*a,n=0;n<s;n++)r[4*n+0]=Math.floor(Math.random()*a+o),r[4*n+1]=Math.floor(Math.random()*a+o),r[4*n+2]=Math.floor(Math.random()*a+o),r[4*n+3]=Math.floor(Math.random()*a+o);if(i>1){for(var h=0;h<e;h+=i)for(var A=0;A<e;A++)if(A%i!=0){for(var l=Math.floor(A/i)*i+e,c=h*e,u=[],g=[],m=[],f=[],p=0;p<4;p++)u[p]=r[4*c+(l-i)%e*4+p],g[p]=r[4*c+l%e*4+p],m[p]=r[4*c+(l+i)%e*4+p],f[p]=r[4*c+(l+2*i)%e*4+p];for(var d=A%i/i,v=t.dwCubicInterpolate(u,g,m,f,d),_=0;_<4;_++)r[h*e*4+4*A+_]=v[_]}for(var E=0;E<e;E++)for(var b=0;b<e;b++)if(b%i!=0){for(var x=Math.floor(b/i)*i+e,y=[],T=[],w=[],S=[],P=0;P<4;P++)y[P]=r[(x-i)%e*e*4+4*E+P],T[P]=r[x%e*e*4+4*E+P],w[P]=r[(x+i)%e*e*4+4*E+P],S[P]=r[(x+2*i)%e*e*4+4*E+P];for(var I=b%i/i,R=t.dwCubicInterpolate(y,T,w,S,I),B=0;B<4;B++)r[b*e*4+4*E+B]=R[B]}}return r}}]),t}(),tt=function(){function t(e){var i=this;r()(this,t),this.gl=e,this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.samplers={},this.clouds2Image=new Image,this.clouds2Image.onload=function(){i.samplers.clouds2=i.gl.createTexture(),i.bindTexture(i.samplers.clouds2,i.clouds2Image,128,128)},this.clouds2Image.src="data:image/jpeg;base64,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",this.emptyImage=new Image,this.emptyImage.onload=function(){i.samplers.empty=i.gl.createTexture(),i.bindTexture(i.samplers.empty,i.emptyImage,1,1)},this.emptyImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="}return o()(t,[{key:"bindTexture",value:function(t,e,i,s){if(this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,i,s,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var r=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,r)}}},{key:"loadExtraImages",value:function(t){var e=this;Object.keys(t).forEach((function(i){var s=t[i],r=s.data,a=s.width,o=s.height;if(!e.samplers[i]){var n=new Image;n.onload=function(){e.samplers[i]=e.gl.createTexture(),e.bindTexture(e.samplers[i],n,a,o)},n.src=r}}))}},{key:"getTexture",value:function(t){var e=this.samplers[t];return e||this.samplers.clouds2}}]),t}(),et=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r()(this,t),this.gl=e,this.texsizeX=i.texsizeX,this.texsizeY=i.texsizeY,this.aspectx=i.aspectx,this.aspecty=i.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions(),this.textTexture=this.gl.createTexture(),this.indexBuf=e.createBuffer(),this.positionVertexBuf=this.gl.createBuffer(),this.vertexBuf=this.gl.createBuffer(),this.canvas=document.createElement("canvas"),this.canvas.width=this.texsizeX,this.canvas.height=this.texsizeY,this.context2D=this.canvas.getContext("2d"),this.floatPrecision=D.getFragmentFloatPrecision(this.gl),this.createShader()}return o()(t,[{key:"generateTitleTexture",value:function(t){this.context2D.clearRect(0,0,this.texsizeX,this.texsizeY),this.fontSize=Math.floor(this.texsizeX/256*16),this.fontSize=Math.max(this.fontSize,6),this.context2D.font="italic ".concat(this.fontSize,"px Times New Roman");var e=t,i=this.context2D.measureText(e).width;if(i>this.texsizeX){var s=this.texsizeX/i*.91;e="".concat(e.substring(0,Math.floor(e.length*s)),"..."),i=this.context2D.measureText(e).width}this.context2D.fillStyle="#FFFFFF",this.context2D.fillText(e,(this.texsizeX-i)/2,this.texsizeY/2);var r=new Uint8Array(this.context2D.getImageData(0,0,this.texsizeX,this.texsizeY).data.buffer);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.texsizeX,this.texsizeY,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},{key:"updateGlobals",value:function(t){this.texsizeX=t.texsizeX,this.texsizeY=t.texsizeY,this.aspectx=t.aspectx,this.aspecty=t.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.canvas.width=this.texsizeX,this.canvas.height=this.texsizeY}},{key:"buildPositions",value:function(){for(var t=[],e=0;e<8;e++)for(var i=e*(2/7)-1,s=0;s<16;s++){var r=s*(2/15)-1;t.push(r,-i,0)}for(var a=[],o=0;o<7;o++)for(var n=0;n<15;n++){var h=n+16*o,A=n+16*(o+1),l=n+1+16*(o+1),c=n+1+16*o;a.push(h,A,c),a.push(A,l,c)}this.vertices=new Float32Array(t),this.indices=new Uint16Array(a)}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var t=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(t,"#version 300 es\n       const vec2 halfmad = vec2(0.5);\n       in vec2 aPos;\n       in vec2 aUv;\n       out vec2 uv_orig;\n       out vec2 uv;\n       void main(void) {\n         gl_Position = vec4(aPos, 0.0, 1.0);\n         uv_orig = aPos * halfmad + halfmad;\n         uv = aUv;\n       }"),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,"#version 300 es\n       precision ".concat(this.floatPrecision," float;\n       precision highp int;\n       precision mediump sampler2D;\n\n       in vec2 uv_orig;\n       in vec2 uv;\n       out vec4 fragColor;\n       uniform sampler2D uTexture;\n       uniform float textColor;\n\n       void main(void) {\n         fragColor = texture(uTexture, uv) * vec4(textColor);\n       }")),this.gl.compileShader(e),this.gl.attachShader(this.shaderProgram,t),this.gl.attachShader(this.shaderProgram,e),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.uvLocation=this.gl.getAttribLocation(this.shaderProgram,"aUv"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.textColorLoc=this.gl.getUniformLocation(this.shaderProgram,"textColor")}},{key:"generateUvs",value:function(t,e,i){for(var s=[],r=0;r<8;r++)for(var a=0;a<16;a++){var o=2*(a/15)-1,n=2*(.75*(r/7-.5)+.5)-1;t>=1&&(n+=1/this.texsizeY),s.push(o,e?n:-n)}for(var h=Math.max(0,1-1.5*t),A=1.3*Math.pow(h,1.8),l=0;l<8;l++)for(var c=0;c<16;c++){var u=16*l+c;s[u]+=.07*A*Math.sin(.31*i.time+.39*s[u]-1.94*s[u+1]),s[u]+=.044*A*Math.sin(.81*i.time-1.91*s[u]+.27*s[u+1]),s[u]+=.061*A*Math.sin(1.31*i.time+.61*s[u]+.74*s[u+1]),s[u+1]+=.061*A*Math.sin(.37*i.time+1.83*s[u]+.69*s[u+1]),s[u+1]+=.07*A*Math.sin(.67*i.time+.42*s[u]-1.39*s[u+1]),s[u+1]+=.087*A*Math.sin(1.07*i.time+3.55*s[u]+.89*s[u+1])}for(var g=1.01/(Math.pow(t,.21)+.01),m=0;m<s.length/2;m++)s[2*m]*=g,s[2*m+1]*=g*this.invAspecty,s[2*m]=(s[2*m]+1)/2,s[2*m+1]=(s[2*m+1]+1)/2;return new Float32Array(s)}},{key:"renderTitle",value:function(t,e,i){this.gl.useProgram(this.shaderProgram);var s=this.generateUvs(t,e,i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuf),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.uvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.uvLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.uniform1i(this.textureLoc,0),this.gl.uniform1f(this.textColorLoc,Math.pow(t,.3)),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0)}}]),t}(),it=function(){function t(e){r()(this,t),this.mesh_width=e.mesh_width,this.mesh_height=e.mesh_height,this.aspectx=e.aspectx,this.aspecty=e.aspecty,this.vertInfoA=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)),this.vertInfoC=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)),this.createBlendPattern()}return o()(t,[{key:"updateGlobals",value:function(e){var i=this.mesh_width,s=this.mesh_height;this.mesh_width=e.mesh_width,this.mesh_height=e.mesh_height,this.aspectx=e.aspectx,this.aspecty=e.aspecty,this.mesh_width===i&&this.mesh_height===s||(this.vertInfoA=t.resizeMatrixValues(this.vertInfoA,i,s,this.mesh_width,this.mesh_height),this.vertInfoC=t.resizeMatrixValues(this.vertInfoC,i,s,this.mesh_width,this.mesh_height))}},{key:"genPlasma",value:function(t,e,i,s,r){var a=Math.floor((t+e)/2),o=Math.floor((i+s)/2),n=this.vertInfoC[i*(this.mesh_width+1)+t],h=this.vertInfoC[i*(this.mesh_width+1)+e],A=this.vertInfoC[s*(this.mesh_width+1)+t],l=this.vertInfoC[s*(this.mesh_width+1)+e];s-i>=2&&(0===t&&(this.vertInfoC[o*(this.mesh_width+1)+t]=.5*(n+A)+(2*Math.random()-1)*r*this.aspecty),this.vertInfoC[o*(this.mesh_width+1)+e]=.5*(h+l)+(2*Math.random()-1)*r*this.aspecty),e-t>=2&&(0===i&&(this.vertInfoC[i*(this.mesh_width+1)+a]=.5*(n+h)+(2*Math.random()-1)*r*this.aspectx),this.vertInfoC[s*(this.mesh_width+1)+a]=.5*(A+l)+(2*Math.random()-1)*r*this.aspectx),s-i>=2&&e-t>=2&&(n=this.vertInfoC[o*(this.mesh_width+1)+t],h=this.vertInfoC[o*(this.mesh_width+1)+e],A=this.vertInfoC[i*(this.mesh_width+1)+a],l=this.vertInfoC[s*(this.mesh_width+1)+a],this.vertInfoC[o*(this.mesh_width+1)+a]=.25*(A+l+n+h)+(2*Math.random()-1)*r,this.genPlasma(t,a,i,o,.5*r),this.genPlasma(a,e,i,o,.5*r),this.genPlasma(t,a,o,s,.5*r),this.genPlasma(a,e,o,s,.5*r))}},{key:"createBlendPattern",value:function(){var t=1+Math.floor(3*Math.random());if(0===t)for(var e=0,i=0;i<=this.mesh_height;i++)for(var s=0;s<=this.mesh_width;s++)this.vertInfoA[e]=1,this.vertInfoC[e]=0,e+=1;else if(1===t)for(var r=6.28*Math.random(),a=Math.cos(r),o=Math.sin(r),n=.1+.2*Math.random(),h=1/n,A=0,l=0;l<=this.mesh_height;l++)for(var c=l/this.mesh_height*this.aspecty,u=0;u<=this.mesh_width;u++){var g=(u/this.mesh_width*this.aspectx-.5)*a+(c-.5)*o+.5;g=(g-.5)/Math.sqrt(2)+.5,this.vertInfoA[A]=h*(1+n),this.vertInfoC[A]=h*g-h,A+=1}else if(2===t){var m=.12+.13*Math.random(),f=1/m;this.vertInfoC[0]=Math.random(),this.vertInfoC[this.mesh_width]=Math.random(),this.vertInfoC[this.mesh_height*(this.mesh_width+1)]=Math.random(),this.vertInfoC[this.mesh_height*(this.mesh_width+1)+this.mesh_width]=Math.random(),this.genPlasma(0,this.mesh_width,0,this.mesh_height,.25);for(var p=this.vertInfoC[0],d=this.vertInfoC[0],v=0,_=0;_<=this.mesh_height;_++)for(var E=0;E<=this.mesh_width;E++)p>this.vertInfoC[v]&&(p=this.vertInfoC[v]),d<this.vertInfoC[v]&&(d=this.vertInfoC[v]),v+=1;var b=1/(d-p);v=0;for(var x=0;x<=this.mesh_height;x++)for(var y=0;y<=this.mesh_width;y++){var T=(this.vertInfoC[v]-p)*b;this.vertInfoA[v]=f*(1+m),this.vertInfoC[v]=f*T-f,v+=1}}else if(3===t)for(var w=.02+.14*Math.random()+.34*Math.random(),S=1/w,P=2*Math.floor(2*Math.random())-1,I=0,R=0;R<=this.mesh_height;R++)for(var B=(R/this.mesh_height-.5)*this.aspecty,L=0;L<=this.mesh_width;L++){var C=(L/this.mesh_width-.5)*this.aspectx,U=1.41421*Math.sqrt(C*C+B*B);-1===P&&(U=1-U),this.vertInfoA[I]=S*(1+w),this.vertInfoC[I]=S*U-S,I+=1}}}],[{key:"resizeMatrixValues",value:function(t,e,i,s,r){for(var a=new Float32Array((s+1)*(r+1)),o=0,n=0;n<r+1;n++)for(var h=0;h<s+1;h++){var A=h/r,l=n/s;A*=e+1,l*=i+1,A=Math.clamp(A,0,e-1),l=Math.clamp(l,0,i-1);var c=Math.floor(A),u=Math.floor(l),g=A-c,m=l-u,f=t[u*(e+1)+c],p=t[u*(e+1)+(c+1)],d=t[(u+1)*(e+1)+c],v=t[(u+1)*(e+1)+(c+1)];a[o]=f*(1-g)*(1-m)+p*g*(1-m)+d*(1-g)*m+v*g*m,o+=1}return a}}]),t}(),st=function(){function t(e,i,s){r()(this,t),this.gl=e,this.audio=i,this.frameNum=0,this.fps=30,this.time=0,this.presetTime=0,this.lastTime=performance.now(),this.timeHist=[0],this.timeHistMax=120,this.blending=!1,this.blendStartTime=0,this.blendProgress=0,this.blendDuration=0,this.width=s.width||1200,this.height=s.height||900,this.mesh_width=s.meshWidth||48,this.mesh_height=s.meshHeight||36,this.pixelRatio=s.pixelRatio||window.devicePixelRatio||1,this.textureRatio=s.textureRatio||1,this.outputFXAA=s.outputFXAA||!1,this.texsizeX=this.width*this.pixelRatio*this.textureRatio,this.texsizeY=this.height*this.pixelRatio*this.textureRatio,this.aspectx=this.texsizeY>this.texsizeX?this.texsizeX/this.texsizeY:1,this.aspecty=this.texsizeX>this.texsizeY?this.texsizeY/this.texsizeX:1,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.qs=U.range(1,33).map((function(t){return"q".concat(t)})),this.ts=U.range(1,9).map((function(t){return"t".concat(t)})),this.regs=U.range(0,100).map((function(t){return t<10?"reg0".concat(t):"reg".concat(t)})),this.blurRatios=[[.5,.25],[.125,.125],[.0625,.0625]],this.audioLevels=new I(this.audio),this.prevFrameBuffer=this.gl.createFramebuffer(),this.targetFrameBuffer=this.gl.createFramebuffer(),this.prevTexture=this.gl.createTexture(),this.targetTexture=this.gl.createTexture(),this.compFrameBuffer=this.gl.createFramebuffer(),this.compTexture=this.gl.createTexture(),this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.bindFrameBufferTexture(this.prevFrameBuffer,this.prevTexture),this.bindFrameBufferTexture(this.targetFrameBuffer,this.targetTexture),this.bindFrameBufferTexture(this.compFrameBuffer,this.compTexture);var a={pixelRatio:this.pixelRatio,textureRatio:this.textureRatio,texsizeX:this.texsizeX,texsizeY:this.texsizeY,mesh_width:this.mesh_width,mesh_height:this.mesh_height,aspectx:this.aspectx,aspecty:this.aspecty};this.noise=new $(e),this.image=new tt(e),this.warpShader=new Y(e,this.noise,this.image,a),this.compShader=new W(e,this.noise,this.image,a),this.outputShader=new j(e,a),this.prevWarpShader=new Y(e,this.noise,this.image,a),this.prevCompShader=new W(e,this.noise,this.image,a),this.numBlurPasses=0,this.blurShader1=new Z(0,this.blurRatios,e,a),this.blurShader2=new Z(1,this.blurRatios,e,a),this.blurShader3=new Z(2,this.blurRatios,e,a),this.blurTexture1=this.blurShader1.blurVerticalTexture,this.blurTexture2=this.blurShader2.blurVerticalTexture,this.blurTexture3=this.blurShader3.blurVerticalTexture,this.basicWaveform=new k(e,a),this.customWaveforms=U.range(4).map((function(t){return new z(t,e,a)})),this.customShapes=U.range(4).map((function(t){return new N(t,e,a)})),this.prevCustomWaveforms=U.range(4).map((function(t){return new z(t,e,a)})),this.prevCustomShapes=U.range(4).map((function(t){return new N(t,e,a)})),this.darkenCenter=new O(e,a),this.innerBorder=new X(e,a),this.outerBorder=new X(e,a),this.motionVectors=new G(e,a),this.titleText=new et(e,a),this.blendPattern=new it(a),this.resampleShader=new J(e),this.supertext={startTime:-1},this.warpUVs=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*2),this.warpColor=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*4),this.gl.clearColor(0,0,0,1),this.blankPreset=B.a;var o={frame:0,time:0,fps:45,bass:1,bass_att:1,mid:1,mid_att:1,treb:1,treb_att:1};this.preset=B.a,this.prevPreset=this.preset,this.presetEquationRunner=new M(this.preset,o,a),this.prevPresetEquationRunner=new M(this.prevPreset,o,a),this.preset.useWASM||(this.regVars=this.presetEquationRunner.mdVSRegs)}return o()(t,[{key:"loadPreset",value:function(e,i){this.blendPattern.createBlendPattern(),this.blending=!0,this.blendStartTime=this.time,this.blendDuration=i,this.blendProgress=0,this.prevPresetEquationRunner=this.presetEquationRunner,this.prevPreset=this.preset,this.preset=e,this.presetTime=this.time;var s={frame:this.frameNum,time:this.time,fps:this.fps,bass:this.audioLevels.bass,bass_att:this.audioLevels.bass_att,mid:this.audioLevels.mid,mid_att:this.audioLevels.mid_att,treb:this.audioLevels.treb,treb_att:this.audioLevels.treb_att},r={pixelRatio:this.pixelRatio,textureRatio:this.textureRatio,texsizeX:this.texsizeX,texsizeY:this.texsizeY,mesh_width:this.mesh_width,mesh_height:this.mesh_height,aspectx:this.aspectx,aspecty:this.aspecty};e.useWASM?(this.preset.globalPools.perFrame.old_wave_mode.value=this.prevPreset.baseVals.wave_mode,this.preset.baseVals.old_wave_mode=this.prevPreset.baseVals.wave_mode,this.presetEquationRunner=new F(this.preset,s,r),this.preset.pixel_eqs_initialize_array&&this.preset.pixel_eqs_initialize_array(this.mesh_width,this.mesh_height)):(this.preset.baseVals.old_wave_mode=this.prevPreset.baseVals.wave_mode,this.presetEquationRunner=new M(this.preset,s,r),this.regVars=this.presetEquationRunner.mdVSRegs);var a=this.prevWarpShader;this.prevWarpShader=this.warpShader,this.warpShader=a;var o=this.prevCompShader;this.prevCompShader=this.compShader,this.compShader=o;var n=this.preset.warp.trim(),h=this.preset.comp.trim();this.warpShader.updateShader(n),this.compShader.updateShader(h),0===n.length?this.numBlurPasses=0:this.numBlurPasses=t.getHighestBlur(n),0!==h.length&&(this.numBlurPasses=Math.max(this.numBlurPasses,t.getHighestBlur(h)))}},{key:"loadExtraImages",value:function(t){this.image.loadExtraImages(t)}},{key:"setRendererSize",value:function(t,e,i){var s=this.texsizeX,r=this.texsizeY;if(this.width=t,this.height=e,this.mesh_width=i.meshWidth||this.mesh_width,this.mesh_height=i.meshHeight||this.mesh_height,this.pixelRatio=i.pixelRatio||this.pixelRatio,this.textureRatio=i.textureRatio||this.textureRatio,this.texsizeX=t*this.pixelRatio*this.textureRatio,this.texsizeY=e*this.pixelRatio*this.textureRatio,this.aspectx=this.texsizeY>this.texsizeX?this.texsizeX/this.texsizeY:1,this.aspecty=this.texsizeX>this.texsizeY?this.texsizeY/this.texsizeX:1,this.texsizeX!==s||this.texsizeY!==r){var a=this.gl.createTexture();this.bindFrameBufferTexture(this.targetFrameBuffer,a),this.bindFrambufferAndSetViewport(this.targetFrameBuffer,this.texsizeX,this.texsizeY),this.resampleShader.renderQuadTexture(this.targetTexture),this.targetTexture=a,this.bindFrameBufferTexture(this.prevFrameBuffer,this.prevTexture),this.bindFrameBufferTexture(this.compFrameBuffer,this.compTexture)}this.updateGlobals(),this.frameNum>0&&this.renderToScreen()}},{key:"setInternalMeshSize",value:function(t,e){this.mesh_width=t,this.mesh_height=e,this.updateGlobals()}},{key:"setOutputAA",value:function(t){this.outputFXAA=t}},{key:"updateGlobals",value:function(){var t={pixelRatio:this.pixelRatio,textureRatio:this.textureRatio,texsizeX:this.texsizeX,texsizeY:this.texsizeY,mesh_width:this.mesh_width,mesh_height:this.mesh_height,aspectx:this.aspectx,aspecty:this.aspecty};this.presetEquationRunner.updateGlobals(t),this.prevPresetEquationRunner.updateGlobals(t),this.warpShader.updateGlobals(t),this.prevWarpShader.updateGlobals(t),this.compShader.updateGlobals(t),this.prevCompShader.updateGlobals(t),this.outputShader.updateGlobals(t),this.blurShader1.updateGlobals(t),this.blurShader2.updateGlobals(t),this.blurShader3.updateGlobals(t),this.basicWaveform.updateGlobals(t),this.customWaveforms.forEach((function(e){return e.updateGlobals(t)})),this.customShapes.forEach((function(e){return e.updateGlobals(t)})),this.prevCustomWaveforms.forEach((function(e){return e.updateGlobals(t)})),this.prevCustomShapes.forEach((function(e){return e.updateGlobals(t)})),this.darkenCenter.updateGlobals(t),this.innerBorder.updateGlobals(t),this.outerBorder.updateGlobals(t),this.motionVectors.updateGlobals(t),this.titleText.updateGlobals(t),this.blendPattern.updateGlobals(t),this.warpUVs=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*2),this.warpColor=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*4),this.preset.pixel_eqs_initialize_array&&this.preset.pixel_eqs_initialize_array(this.mesh_width,this.mesh_height)}},{key:"calcTimeAndFPS",value:function(t){var e;if(t)e=t;else{var i=performance.now();((e=(i-this.lastTime)/1e3)>1||e<0||this.frame<2)&&(e=1/30),this.lastTime=i}this.time+=1/this.fps,this.blending&&(this.blendProgress=(this.time-this.blendStartTime)/this.blendDuration,this.blendProgress>1&&(this.blending=!1));var s=this.timeHist[this.timeHist.length-1]+e;this.timeHist.push(s),this.timeHist.length>this.timeHistMax&&this.timeHist.shift();var r=this.timeHist.length/(s-this.timeHist[0]);if(Math.abs(r-this.fps)>3&&this.frame>this.timeHistMax)this.fps=r;else{this.fps=.93*this.fps+(1-.93)*r}}},{key:"runPixelEquations",value:function(t,e,i,s){var r=this.mesh_width,a=this.mesh_height,o=r+1,n=a+1,h=this.time*e.warpanimspeed,A=1/e.warpscale,l=11.68+4*Math.cos(1.413*h+10),c=8.77+3*Math.cos(1.113*h+7),u=10.54+3*Math.cos(1.233*h+3),g=11.49+4*Math.cos(.933*h+5),m=0/this.texsizeX,f=0/this.texsizeY,p=this.aspectx,d=this.aspecty,v=0,_=0;if(t.preset.useWASM){var E=t.preset.globalPools.perVertex;if(U.setWasm(E,i,t.globalKeys),U.setWasm(E,t.mdVSQAfterFrame,t.qs),E.zoom.value=e.zoom,E.zoomexp.value=e.zoomexp,E.rot.value=e.rot,E.warp.value=e.warp,E.cx.value=e.cx,E.cy.value=e.cy,E.dx.value=e.dx,E.dy.value=e.dy,E.sx.value=e.sx,E.sy.value=e.sy,t.preset.pixel_eqs_wasm(t.runVertEQs,this.mesh_width,this.mesh_height,this.time,e.warpanimspeed,e.warpscale,this.aspectx,this.aspecty),s)for(var b=t.preset.pixel_eqs_get_array(),x=0,y=0,T=0;T<n;T++)for(var w=0;w<o;w++){var S=b[x],P=b[x+1],I=this.blendPattern.vertInfoA[x/2]*this.blendProgress+this.blendPattern.vertInfoC[x/2];I=Math.clamp(I,0,1),this.warpUVs[x]=this.warpUVs[x]*I+S*(1-I),this.warpUVs[x+1]=this.warpUVs[x+1]*I+P*(1-I),this.warpColor[y+0]=1,this.warpColor[y+1]=1,this.warpColor[y+2]=1,this.warpColor[y+3]=I,x+=2,y+=4}else this.warpUVs=t.preset.pixel_eqs_get_array(),this.warpColor.fill(1)}else{for(var R=U.cloneVars(e),B=R.warp,L=R.zoom,C=R.zoomexp,M=R.cx,F=R.cy,Q=R.sx,V=R.sy,D=R.dx,q=R.dy,k=R.rot,z=0;z<n;z++)for(var N=0;N<o;N++){var X=N/r*2-1,O=z/a*2-1,G=Math.sqrt(X*X*p*p+O*O*d*d);if(t.runVertEQs){var Y=void 0;Y=z===a/2&&N===r/2?0:U.atan2(O*d,X*p),R.x=.5*X*p+.5,R.y=-.5*O*d+.5,R.rad=G,R.ang=Y,R.zoom=e.zoom,R.zoomexp=e.zoomexp,R.rot=e.rot,R.warp=e.warp,R.cx=e.cx,R.cy=e.cy,R.dx=e.dx,R.dy=e.dy,R.sx=e.sx,R.sy=e.sy,B=(R=t.runPixelEquations(R)).warp,L=R.zoom,C=R.zoomexp,M=R.cx,F=R.cy,Q=R.sx,V=R.sy,D=R.dx,q=R.dy,k=R.rot}var W=1/Math.pow(L,Math.pow(C,2*G-1)),j=.5*X*p*W+.5,J=.5*-O*d*W+.5;j=(j-M)/Q+M,J=(J-F)/V+F,0!==B&&(j+=.0035*B*Math.sin(.333*h+A*(X*l-O*g)),J+=.0035*B*Math.cos(.375*h-A*(X*u+O*c)),j+=.0035*B*Math.cos(.753*h-A*(X*c-O*u)),J+=.0035*B*Math.sin(.825*h+A*(X*l+O*g)));var K=j-M,H=J-F,Z=Math.cos(k),$=Math.sin(k);if(j=K*Z-H*$+M,J=K*$+H*Z+F,j=((j-=D)-.5)/p+.5,J=((J-=q)-.5)/d+.5,j+=m,J+=f,s){var tt=this.blendPattern.vertInfoA[v/2]*this.blendProgress+this.blendPattern.vertInfoC[v/2];tt=Math.clamp(tt,0,1),this.warpUVs[v]=this.warpUVs[v]*tt+j*(1-tt),this.warpUVs[v+1]=this.warpUVs[v+1]*tt+J*(1-tt),this.warpColor[_+0]=1,this.warpColor[_+1]=1,this.warpColor[_+2]=1,this.warpColor[_+3]=tt}else this.warpUVs[v]=j,this.warpUVs[v+1]=J,this.warpColor[_+0]=1,this.warpColor[_+1]=1,this.warpColor[_+2]=1,this.warpColor[_+3]=1;v+=2,_+=4}this.mdVSVertex=R}}},{key:"bindFrambufferAndSetViewport",value:function(t,e,i){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.viewport(0,0,e,i)}},{key:"bindFrameBufferTexture",value:function(t,e){if(this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.texsizeX,this.texsizeY,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(this.texsizeX*this.texsizeY*4)),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var i=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,i)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0)}},{key:"render",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=i.audioLevels,r=i.elapsedTime,a={startTime:performance.now()};this.calcTimeAndFPS(r),this.frameNum+=1,a.calcFPS=performance.now(),s?this.audio.updateAudio(s.timeByteArray,s.timeByteArrayL,s.timeByteArrayR):this.audio.sampleAudio(),this.audioLevels.updateAudioLevels(this.fps,this.frameNum),a.updateAudioLevels=performance.now();var o={frame:this.frameNum,time:this.time,fps:this.fps,bass:this.audioLevels.bass,bass_att:this.audioLevels.bass_att,mid:this.audioLevels.mid,mid_att:this.audioLevels.mid_att,treb:this.audioLevels.treb,treb_att:this.audioLevels.treb_att,meshx:this.mesh_width,meshy:this.mesh_height,aspectx:this.invAspectx,aspecty:this.invAspecty,pixelsx:this.texsizeX,pixelsy:this.texsizeY},n=Object.assign({},o);this.prevPreset.useWASM||(n.gmegabuf=this.prevPresetEquationRunner.gmegabuf),this.preset.useWASM||(o.gmegabuf=this.presetEquationRunner.gmegabuf,Object.assign(o,this.regVars));var h,A=this.presetEquationRunner.runFrameEquations(o);a.runFrameEquations=performance.now(),this.runPixelEquations(this.presetEquationRunner,A,o,!1),this.preset.useWASM||(Object.assign(this.regVars,U.pick(this.mdVSVertex,this.regs)),Object.assign(o,this.regVars)),a.runPixelEquations=performance.now(),this.blending?(this.prevMDVSFrame=this.prevPresetEquationRunner.runFrameEquations(n),this.runPixelEquations(this.prevPresetEquationRunner,this.prevMDVSFrame,n,!0),h=t.mixFrameEquations(this.blendProgress,A,this.prevMDVSFrame)):h=A;var l=this.targetTexture;this.targetTexture=this.prevTexture,this.prevTexture=l;var c=this.targetFrameBuffer;this.targetFrameBuffer=this.prevFrameBuffer,this.prevFrameBuffer=c,this.gl.bindTexture(this.gl.TEXTURE_2D,this.prevTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.bindFrambufferAndSetViewport(this.targetFrameBuffer,this.texsizeX,this.texsizeY),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);var u=t.getBlurValues(h),g=u.blurMins,m=u.blurMaxs;a.getBlurValues=performance.now(),this.blending?(this.prevWarpShader.renderQuadTexture(!1,this.prevTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,g,m,this.prevMDVSFrame,this.prevPresetEquationRunner.mdVSQAfterFrame,this.warpUVs,this.warpColor),this.warpShader.renderQuadTexture(!0,this.prevTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,g,m,h,this.presetEquationRunner.mdVSQAfterFrame,this.warpUVs,this.warpColor)):this.warpShader.renderQuadTexture(!1,this.prevTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,g,m,A,this.presetEquationRunner.mdVSQAfterFrame,this.warpUVs,this.warpColor),a.warpShader=performance.now(),this.numBlurPasses>0&&(this.blurShader1.renderBlurTexture(this.targetTexture,A,g,m),this.numBlurPasses>1&&(this.blurShader2.renderBlurTexture(this.blurTexture1,A,g,m),this.numBlurPasses>2&&this.blurShader3.renderBlurTexture(this.blurTexture2,A,g,m)),this.bindFrambufferAndSetViewport(this.targetFrameBuffer,this.texsizeX,this.texsizeY)),a.renderBlurTexture=performance.now(),this.motionVectors.drawMotionVectors(h,this.warpUVs),a.drawMotionVectors=performance.now(),this.preset.shapes&&this.preset.shapes.length>0&&this.customShapes.forEach((function(t,i){t.drawCustomShape(e.blending?e.blendProgress:1,o,e.presetEquationRunner,e.preset.shapes[i],e.prevTexture)})),a.drawCustomShape=performance.now(),this.preset.waves&&this.preset.waves.length>0&&this.customWaveforms.forEach((function(t,i){t.drawCustomWaveform(e.blending?e.blendProgress:1,e.audio.timeArrayL,e.audio.timeArrayR,e.audio.freqArrayL,e.audio.freqArrayR,o,e.presetEquationRunner,e.preset.waves[i])})),a.drawCustomWaveform=performance.now(),this.blending&&(this.prevPreset.shapes&&this.prevPreset.shapes.length>0&&this.prevCustomShapes.forEach((function(t,i){t.drawCustomShape(1-e.blendProgress,n,e.prevPresetEquationRunner,e.prevPreset.shapes[i],e.prevTexture)})),this.prevPreset.waves&&this.prevPreset.waves.length>0&&this.prevCustomWaveforms.forEach((function(t,i){t.drawCustomWaveform(1-e.blendProgress,e.audio.timeArrayL,e.audio.timeArrayR,e.audio.freqArrayL,e.audio.freqArrayR,n,e.prevPresetEquationRunner,e.prevPreset.waves[i])}))),this.basicWaveform.drawBasicWaveform(this.blending,this.blendProgress,this.audio.timeArrayL,this.audio.timeArrayR,h),a.drawBasicWaveform=performance.now(),this.darkenCenter.drawDarkenCenter(h);var f=[h.ob_r,h.ob_g,h.ob_b,h.ob_a];this.outerBorder.drawBorder(f,h.ob_size,0);var p=[h.ib_r,h.ib_g,h.ib_b,h.ib_a];if(this.innerBorder.drawBorder(p,h.ib_size,h.ob_size),a.drawBorderAndCenter=performance.now(),this.supertext.startTime>=0){var d=(this.time-this.supertext.startTime)/this.supertext.duration;d>=1&&this.titleText.renderTitle(d,!0,o)}return this.globalVars=o,this.mdVSFrame=A,this.mdVSFrameMixed=h,this.renderToScreen(),a.renderToScreen=performance.now(),a}},{key:"renderToScreen",value:function(){this.outputFXAA?this.bindFrambufferAndSetViewport(this.compFrameBuffer,this.texsizeX,this.texsizeY):this.bindFrambufferAndSetViewport(null,this.width,this.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);var e=t.getBlurValues(this.mdVSFrameMixed),i=e.blurMins,s=e.blurMaxs;if(this.blending?(this.prevCompShader.renderQuadTexture(!1,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,i,s,this.prevMDVSFrame,this.prevPresetEquationRunner.mdVSQAfterFrame,this.warpColor),this.compShader.renderQuadTexture(!0,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,i,s,this.mdVSFrameMixed,this.presetEquationRunner.mdVSQAfterFrame,this.warpColor)):this.compShader.renderQuadTexture(!1,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,i,s,this.mdVSFrame,this.presetEquationRunner.mdVSQAfterFrame,this.warpColor),this.supertext.startTime>=0){var r=(this.time-this.supertext.startTime)/this.supertext.duration;this.titleText.renderTitle(r,!1,this.globalVars),r>=1&&(this.supertext.startTime=-1)}this.outputFXAA&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.compTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.bindFrambufferAndSetViewport(null,this.width,this.height),this.outputShader.renderQuadTexture(this.compTexture))}},{key:"launchSongTitleAnim",value:function(t){this.supertext={startTime:this.time,duration:1.7},this.titleText.generateTitleTexture(t)}},{key:"toDataURL",value:function(){var e=this,i=new Uint8Array(this.texsizeX*this.texsizeY*4),s=this.gl.createFramebuffer(),r=this.gl.createTexture();this.bindFrameBufferTexture(s,r);var a=t.getBlurValues(this.mdVSFrameMixed),o=a.blurMins,n=a.blurMaxs;this.compShader.renderQuadTexture(!1,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,o,n,this.mdVSFrame,this.presetEquationRunner.mdVSQAfterFrame,this.warpColor),this.gl.readPixels(0,0,this.texsizeX,this.texsizeY,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),Array.from({length:this.texsizeY},(function(t,s){return i.slice(s*e.texsizeX*4,(s+1)*e.texsizeX*4)})).forEach((function(t,s){return i.set(t,(e.texsizeY-s-1)*e.texsizeX*4)}));var h=document.createElement("canvas");h.width=this.texsizeX,h.height=this.texsizeY;var A=h.getContext("2d"),l=A.createImageData(this.texsizeX,this.texsizeY);return l.data.set(i),A.putImageData(l,0,0),this.gl.deleteTexture(r),this.gl.deleteFramebuffer(s),h.toDataURL()}},{key:"warpBufferToDataURL",value:function(){var t=new Uint8Array(this.texsizeX*this.texsizeY*4);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.targetFrameBuffer),this.gl.readPixels(0,0,this.texsizeX,this.texsizeY,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t);var e=document.createElement("canvas");e.width=this.texsizeX,e.height=this.texsizeY;var i=e.getContext("2d"),s=i.createImageData(this.texsizeX,this.texsizeY);return s.data.set(t),i.putImageData(s,0,0),e.toDataURL()}}],[{key:"getHighestBlur",value:function(t){return/sampler_blur3/.test(t)?3:/sampler_blur2/.test(t)?2:/sampler_blur1/.test(t)?1:0}},{key:"mixFrameEquations",value:function(t,e,i){var s=.5-.5*Math.cos(t*Math.PI),r=1-s,a=U.cloneVars(e);return a.decay=s*e.decay+r*i.decay,a.wave_a=s*e.wave_a+r*i.wave_a,a.wave_r=s*e.wave_r+r*i.wave_r,a.wave_g=s*e.wave_g+r*i.wave_g,a.wave_b=s*e.wave_b+r*i.wave_b,a.wave_x=s*e.wave_x+r*i.wave_x,a.wave_y=s*e.wave_y+r*i.wave_y,a.wave_mystery=s*e.wave_mystery+r*i.wave_mystery,a.ob_size=s*e.ob_size+r*i.ob_size,a.ob_r=s*e.ob_r+r*i.ob_r,a.ob_g=s*e.ob_g+r*i.ob_g,a.ob_b=s*e.ob_b+r*i.ob_b,a.ob_a=s*e.ob_a+r*i.ob_a,a.ib_size=s*e.ib_size+r*i.ib_size,a.ib_r=s*e.ib_r+r*i.ib_r,a.ib_g=s*e.ib_g+r*i.ib_g,a.ib_b=s*e.ib_b+r*i.ib_b,a.ib_a=s*e.ib_a+r*i.ib_a,a.mv_x=s*e.mv_x+r*i.mv_x,a.mv_y=s*e.mv_y+r*i.mv_y,a.mv_dx=s*e.mv_dx+r*i.mv_dx,a.mv_dy=s*e.mv_dy+r*i.mv_dy,a.mv_l=s*e.mv_l+r*i.mv_l,a.mv_r=s*e.mv_r+r*i.mv_r,a.mv_g=s*e.mv_g+r*i.mv_g,a.mv_b=s*e.mv_b+r*i.mv_b,a.mv_a=s*e.mv_a+r*i.mv_a,a.echo_zoom=s*e.echo_zoom+r*i.echo_zoom,a.echo_alpha=s*e.echo_alpha+r*i.echo_alpha,a.echo_orient=s*e.echo_orient+r*i.echo_orient,a.wave_dots=s<.5?i.wave_dots:e.wave_dots,a.wave_thick=s<.5?i.wave_thick:e.wave_thick,a.additivewave=s<.5?i.additivewave:e.additivewave,a.wave_brighten=s<.5?i.wave_brighten:e.wave_brighten,a.darken_center=s<.5?i.darken_center:e.darken_center,a.gammaadj=s<.5?i.gammaadj:e.gammaadj,a.wrap=s<.5?i.wrap:e.wrap,a.invert=s<.5?i.invert:e.invert,a.brighten=s<.5?i.brighten:e.brighten,a.darken=s<.5?i.darken:e.darken,a.solarize=s<.5?i.brighten:e.solarize,a.b1n=s*e.b1n+r*i.b1n,a.b2n=s*e.b2n+r*i.b2n,a.b3n=s*e.b3n+r*i.b3n,a.b1x=s*e.b1x+r*i.b1x,a.b2x=s*e.b2x+r*i.b2x,a.b3x=s*e.b3x+r*i.b3x,a.b1ed=s*e.b1ed+r*i.b1ed,a}},{key:"getBlurValues",value:function(t){var e=t.b1n,i=t.b2n,s=t.b3n,r=t.b1x,a=t.b2x,o=t.b3x;if(r-e<.1){var n=.5*(e+r);e=n-.05,r=n-.05}if((a=Math.min(r,a))-(i=Math.max(e,i))<.1){var h=.5*(i+a);i=h-.05,a=h-.05}if((o=Math.min(a,o))-(s=Math.max(i,s))<.1){var A=.5*(s+o);s=A-.05,o=A-.05}return{blurMins:[e,i,s],blurMaxs:[r,a,o]}}}]),t}(),rt=i(17),at=i.n(rt);function ot(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function nt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(i),!0).forEach((function(e){h()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ot(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var ht=function(){function t(e,i,s){r()(this,t),this.opts=s,this.audio=new P(e),this.gl=i.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,stencil:!1,premultipliedAlpha:!1}),this.baseValsDefaults={decay:.98,gammaadj:2,echo_zoom:2,echo_alpha:0,echo_orient:0,red_blue:0,brighten:0,darken:0,wrap:1,darken_center:0,solarize:0,invert:0,bmotionvectorson:1,fshader:0,b1n:0,b2n:0,b3n:0,b1x:1,b2x:1,b3x:1,b1ed:.25,wave_mode:0,additivewave:0,wave_dots:0,wave_thick:0,wave_a:.8,wave_scale:1,wave_smoothing:.75,wave_mystery:0,modwavealphabyvolume:0,modwavealphastart:.75,modwavealphaend:.95,wave_r:1,wave_g:1,wave_b:1,wave_x:.5,wave_y:.5,wave_brighten:1,mv_x:12,mv_y:9,mv_dx:0,mv_dy:0,mv_l:.9,mv_r:1,mv_g:1,mv_b:1,mv_a:1,warpanimspeed:1,warpscale:1,zoomexp:1,zoom:1,rot:0,cx:.5,cy:.5,dx:0,dy:0,warp:1,sx:1,sy:1,ob_size:.01,ob_r:0,ob_g:0,ob_b:0,ob_a:0,ib_size:.01,ib_r:.25,ib_g:.25,ib_b:.25,ib_a:0},this.shapeBaseValsDefaults={enabled:0,sides:4,additive:0,thickoutline:0,textured:0,num_inst:1,tex_zoom:1,tex_ang:0,x:.5,y:.5,rad:.1,ang:0,r:1,g:0,b:0,a:1,r2:0,g2:1,b2:0,a2:0,border_r:1,border_g:1,border_b:1,border_a:.1},this.waveBaseValsDefaults={enabled:0,samples:512,sep:0,scaling:1,smoothing:.5,r:1,g:1,b:1,a:1,spectrum:0,usedots:0,thick:0,additive:0},this.qs=U.range(1,33).map((function(t){return"q".concat(t)})),this.ts=U.range(1,9).map((function(t){return"t".concat(t)})),this.globalPerFrameVars=["old_wave_mode","frame","time","fps","bass","bass_att","mid","mid_att","treb","treb_att","meshx","meshy","aspectx","aspecty","pixelsx","pixelsy","rand_start","rand_preset"],this.globalPerPixelVars=["frame","time","fps","bass","bass_att","mid","mid_att","treb","treb_att","meshx","meshy","aspectx","aspecty","pixelsx","pixelsy","rand_start","rand_preset","x","y","rad","ang"],this.globalShapeVars=["frame","time","fps","bass","bass_att","mid","mid_att","treb","treb_att","meshx","meshy","aspectx","aspecty","pixelsx","pixelsy","rand_start","rand_preset","instance"],this.shapeBaseVars=["x","y","rad","ang","r","g","b","a","r2","g2","b2","a2","border_r","border_g","border_b","border_a","thickoutline","textured","tex_zoom","tex_ang","additive"],this.globalWaveVars=["frame","time","fps","bass","bass_att","mid","mid_att","treb","treb_att","meshx","meshy","aspectx","aspecty","pixelsx","pixelsy","rand_start","rand_preset","x","y","sample","value1","value2"],this.renderer=new st(this.gl,this.audio,s)}var e,i;return o()(t,[{key:"loseGLContext",value:function(){this.gl.getExtension("WEBGL_lose_context").loseContext()}},{key:"connectAudio",value:function(t){this.audioNode=t,this.audio.connectAudio(t)}},{key:"disconnectAudio",value:function(t){this.audio.disconnectAudio(t)}},{key:"createQVars",value:function(){var t={};return this.qs.forEach((function(e){t[e]=new WebAssembly.Global({value:"f64",mutable:!0},0)})),t}},{key:"createTVars",value:function(){var t={};return this.ts.forEach((function(e){t[e]=new WebAssembly.Global({value:"f64",mutable:!0},0)})),t}},{key:"createPerFramePool",value:function(t){var e={};return Object.keys(this.baseValsDefaults).forEach((function(i){e[i]=new WebAssembly.Global({value:"f64",mutable:!0},t[i])})),this.globalPerFrameVars.forEach((function(t){e[t]=new WebAssembly.Global({value:"f64",mutable:!0},0)})),e}},{key:"createPerPixelPool",value:function(t){var e={};return Object.keys(this.baseValsDefaults).forEach((function(i){e[i]=new WebAssembly.Global({value:"f64",mutable:!0},t[i])})),this.globalPerPixelVars.forEach((function(t){e[t]=new WebAssembly.Global({value:"f64",mutable:!0},0)})),e}},{key:"createCustomShapePerFramePool",value:function(t){var e={};return Object.keys(this.shapeBaseValsDefaults).forEach((function(i){e[i]=new WebAssembly.Global({value:"f64",mutable:!0},t[i])})),this.globalShapeVars.forEach((function(t){e[t]=new WebAssembly.Global({value:"f64",mutable:!0},0)})),e}},{key:"createCustomWavePerFramePool",value:function(t){var e={};return Object.keys(this.waveBaseValsDefaults).forEach((function(i){e[i]=new WebAssembly.Global({value:"f64",mutable:!0},t[i])})),this.globalWaveVars.forEach((function(t){e[t]=new WebAssembly.Global({value:"f64",mutable:!0},0)})),e}},{key:"loadPreset",value:(i=u()(l.a.mark((function e(i){var s,r,a,o,n,h=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=h.length>1&&void 0!==h[1]?h[1]:0,(r=JSON.parse(JSON.stringify(i))).baseVals=t.overrideDefaultVars(this.baseValsDefaults,r.baseVals),a=0;a<r.shapes.length;a++)r.shapes[a].baseVals=t.overrideDefaultVars(this.shapeBaseValsDefaults,r.shapes[a].baseVals);for(o=0;o<r.waves.length;o++)r.waves[o].baseVals=t.overrideDefaultVars(this.waveBaseValsDefaults,r.waves[o].baseVals);if(n=r.useJS&&!this.opts.onlyUseWASM,!Object.prototype.hasOwnProperty.call(r,"init_eqs_eel")||n){e.next=12;break}return r.useWASM=!0,e.next=10,this.loadWASMPreset(r,s);case 10:e.next=13;break;case 12:this.opts.onlyUseWASM?console.warn("Tried to load a preset that doesn't support WASM with onlyUseWASM on"):Object.prototype.hasOwnProperty.call(r,"init_eqs_str")?this.loadJSPreset(r,s):console.warn("Tried to load a JS preset that doesn't have converted strings");case 13:case"end":return e.stop()}}),e,this)}))),function(t){return i.apply(this,arguments)})},{key:"loadWASMPreset",value:(e=u()(l.a.mark((function e(i,s){var r,a,o,n,h,A,c,u,m,f,p,d,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this.createQVars(),a=this.createTVars(),o={perFrame:nt(nt({},r),this.createPerFramePool(i.baseVals)),perVertex:nt(nt({},r),this.createPerPixelPool(i.baseVals))},n={presetInit:{pool:"perFrame",code:i.init_eqs_eel},perFrame:{pool:"perFrame",code:i.frame_eqs_eel}},""!==i.pixel_eqs_eel&&(n.perPixel={pool:"perVertex",code:i.pixel_eqs_eel}),h=0;h<i.shapes.length;h++)o["shapePerFrame".concat(h)]=nt(nt(nt({},r),a),this.createCustomShapePerFramePool(i.shapes[h].baseVals)),0!==i.shapes[h].baseVals.enabled&&(n["shapes_".concat(h,"_init_eqs")]={pool:"shapePerFrame".concat(h),code:i.shapes[h].init_eqs_eel},n["shapes_".concat(h,"_frame_eqs")]={pool:"shapePerFrame".concat(h),code:i.shapes[h].frame_eqs_eel});for(A=0;A<i.waves.length;A++)0!==i.waves[A].baseVals.enabled&&(o["wavePerFrame".concat(A)]=nt(nt(nt({},r),a),this.createCustomWavePerFramePool(i.waves[A].baseVals)),n["waves_".concat(A,"_init_eqs")]={pool:"wavePerFrame".concat(A),code:i.waves[A].init_eqs_eel},n["waves_".concat(A,"_frame_eqs")]={pool:"wavePerFrame".concat(A),code:i.waves[A].frame_eqs_eel},i.waves[A].point_eqs_eel&&""!==i.waves[A].point_eqs_eel&&(n["waves_".concat(A,"_point_eqs")]={pool:"wavePerFrame".concat(A),code:i.waves[A].point_eqs_eel}));return e.next=9,Object(g.loadModule)({pools:o,functions:n,eelVersion:i.version||2});case 9:return c=e.sent,u=function(t){return t||function(){}},e.next=13,w.instantiate(t.base64ToArrayBuffer(at()()),{pixelEqs:{perPixelEqs:u(c.exports.perPixel)},pixelVarPool:{warp:o.perVertex.warp,zoom:o.perVertex.zoom,zoomexp:o.perVertex.zoomexp,cx:o.perVertex.cx,cy:o.perVertex.cy,sx:o.perVertex.sx,sy:o.perVertex.sy,dx:o.perVertex.dx,dy:o.perVertex.dy,rot:o.perVertex.rot,x:o.perVertex.x,y:o.perVertex.y,ang:o.perVertex.ang,rad:o.perVertex.rad},qVarPool:r,tVarPool:a,shapePool0:t.makeShapeResetPool(o.shapePerFrame0,this.shapeBaseVars,0),shapePool1:t.makeShapeResetPool(o.shapePerFrame1,this.shapeBaseVars,1),shapePool2:t.makeShapeResetPool(o.shapePerFrame2,this.shapeBaseVars,2),shapePool3:t.makeShapeResetPool(o.shapePerFrame3,this.shapeBaseVars,3),console:{logi:function(t){console.log("logi: "+t)},logf:function(t){console.log("logf: "+t)}},env:{abort:function(){}}});case 13:for(m=e.sent,i.globalPools=o,i.init_eqs=u(c.exports.presetInit),i.frame_eqs=u(c.exports.perFrame),i.save_qs=m.exports.saveQs,i.restore_qs=m.exports.restoreQs,i.save_ts=m.exports.saveTs,i.restore_ts=m.exports.restoreTs,c.exports.perPixel&&(i.pixel_eqs=c.exports.perPixel),i.pixel_eqs_initialize_array=function(t,e){var s=m.exports.createFloat32Array((t+1)*(e+1)*2);i.pixel_eqs_array=s},i.pixel_eqs_get_array=function(){return m.exports.__getFloat32ArrayView(i.pixel_eqs_array)},i.pixel_eqs_wasm=function(){for(var t,e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return(t=m.exports).runPixelEquations.apply(t,[i.pixel_eqs_array].concat(s))},f=function(t){0!==i.shapes[t].baseVals.enabled&&(i.shapes[t].init_eqs=u(c.exports["shapes_".concat(t,"_init_eqs")]),i.shapes[t].frame_eqs=c.exports["shapes_".concat(t,"_frame_eqs")],i.shapes[t].frame_eqs_save=function(){return m.exports["shape".concat(t,"_save")]()},i.shapes[t].frame_eqs_restore=function(){return m.exports["shape".concat(t,"_restore")]()})},p=0;p<i.shapes.length;p++)f(p);for(d=0;d<i.waves.length;d++)0!==i.waves[d].baseVals.enabled&&(v={init_eqs:u(c.exports["waves_".concat(d,"_init_eqs")]),frame_eqs:u(c.exports["waves_".concat(d,"_frame_eqs")])},i.waves[d].point_eqs_eel&&""!==i.waves[d].point_eqs_eel?v.point_eqs=c.exports["waves_".concat(d,"_point_eqs")]:v.point_eqs="",i.waves[d]=Object.assign({},i.waves[d],v));this.renderer.loadPreset(i,s);case 29:case"end":return e.stop()}}),e,this)}))),function(t,i){return e.apply(this,arguments)})},{key:"loadJSPreset",value:function(t,e){if("function"!=typeof t.init_eqs){t.init_eqs=new Function("a","".concat(t.init_eqs_str," return a;")),t.frame_eqs=new Function("a","".concat(t.frame_eqs_str," return a;")),t.pixel_eqs_str&&""!==t.pixel_eqs_str?t.pixel_eqs=new Function("a","".concat(t.pixel_eqs_str," return a;")):t.pixel_eqs="";for(var i=0;i<t.shapes.length;i++)0!==t.shapes[i].baseVals.enabled&&(t.shapes[i]=Object.assign({},t.shapes[i],{init_eqs:new Function("a","".concat(t.shapes[i].init_eqs_str," return a;")),frame_eqs:new Function("a","".concat(t.shapes[i].frame_eqs_str," return a;"))}));for(var s=0;s<t.waves.length;s++)if(0!==t.waves[s].baseVals.enabled){var r={init_eqs:new Function("a","".concat(t.waves[s].init_eqs_str," return a;")),frame_eqs:new Function("a","".concat(t.waves[s].frame_eqs_str," return a;"))};t.waves[s].point_eqs_str&&""!==t.waves[s].point_eqs_str?r.point_eqs=new Function("a","".concat(t.waves[s].point_eqs_str," return a;")):r.point_eqs="",t.waves[s]=Object.assign({},t.waves[s],r)}}this.renderer.loadPreset(t,e)}},{key:"loadExtraImages",value:function(t){this.renderer.loadExtraImages(t)}},{key:"setRendererSize",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.renderer.setRendererSize(t,e,i)}},{key:"setInternalMeshSize",value:function(t,e){this.renderer.setInternalMeshSize(t,e)}},{key:"setOutputAA",value:function(t){this.renderer.setOutputAA(t)}},{key:"render",value:function(t){return this.renderer.render(t)}},{key:"launchSongTitleAnim",value:function(t){this.renderer.launchSongTitleAnim(t)}},{key:"toDataURL",value:function(){return this.renderer.toDataURL()}},{key:"warpBufferToDataURL",value:function(){return this.renderer.warpBufferToDataURL()}}],[{key:"overrideDefaultVars",value:function(t,e){var i={};return Object.keys(t).forEach((function(s){Object.prototype.hasOwnProperty.call(e,s)?i[s]=e[s]:i[s]=t[s]})),i}},{key:"makeShapeResetPool",value:function(t,e,i){return e.reduce((function(e,s){return nt(nt({},e),{},h()({},"".concat(s,"_").concat(i),t[s]))}),{})}},{key:"base64ToArrayBuffer",value:function(t){for(var e=window.atob(t),i=e.length,s=new Uint8Array(i),r=0;r<i;r++)s[r]=e.charCodeAt(r);return s.buffer}}]),t}(),At=function(){function t(){r()(this,t)}return o()(t,null,[{key:"createVisualizer",value:function(t,e,i){return new ht(t,e,i)}}]),t}()}])}));
//# sourceMappingURL=butterchurn.min.js.map